\subsubsection{Bootstrapping basics: fit results}

To fit the simulated data, a set of fitting parameters were defined in (magnitude, phase) form. In this case, the parameter set was simply defined from the input matrix elements, including symmetry relations, resulting in 6 complex radial matrix elements defining the problem (this equates to $2n-1$ parameters to determine in magnitude-phase form, where the -1 arises since the phases are relative, and one phase must be defined as a reference, either pre or post fit); in general this step in the protocol may require manual configuration for the problem at hand, based on the symmetry of the system. 

The PEMtk fitting matrix element fitting routine makes use of the lmfit package [REF, https://lmfit.github.io/lmfit-py/, https://dx.doi.org/10.5281/zenodo.11813], which implements a range of fitting routines and options. In the current case a standard Levenberg-Marquardt minimization was used, and all (12) parameters were allowed to float freely. To gain insight into the efficiency of the fitting routine, and the uniqueness of the fit results [REF], 1000 fits were performed on the same dataset, each seeded with randomised parameter values. This methodology amounts to a statistical sampling of the solution hyperspace, which may be expected to contain some local minima in general high-dimensional cases [REF]. Convergence criteria were set as .... Running in parallel on 20 (logical) cores of an AMD Threadripper 2950X based workstation, this required ~5GB of RAM and took on the order of 2 hours (note that the time per fit cycle had large variance, since convergence time depends on the start parameters); further benchmarks for the current codebase can be found at [REF].

TODO: add table of results and remap param names back to QNs.

Results are summarised broadly in Fig. \ref{509194}, which shows the best fit results over the fits. A few (tentative) conclusions can be quickly drawn from this:

\begin{enumerate}
\item The results appear to indicate a well-defined, single global minima was found, with $\chi^2 = 2.291\times10^{-3}$. 
\item There are additional close-lying bands with $\chi^2 < 2.3\times10^{-3}$. In the test case, 349 fits obtained this region of the fitting space. These results may be due to local minima, or simply fits which didn't quite converge for numerical reasons (e.g. reached the upper limit of iterations in fitting protocol); identifying whether these sub-sets of parameters are significantly different is therefore required.
\item There are multiple bands of fits which converged to higher $\chi^2$; since there is a large step to the first of these ($\chi^2 = 2.312\times10^{-3}$), and they appear with much lower frequency, these are most likely indicative of local minima.

% \item Not all fits that converged - as defined by the criteria above - provided the reference matrix elements. This illustrates the importance of statistical sample of the solution hyperspace, and/or the use of further tests of the fit results [REF] in order to determine their veracity in general.
% \item In this case, the lowest $\chi^2$ does correspond to the reference matrix elements. Further, in the noise-free case, the minima found in these cases is orders of magnitude lower than the next best parameter set, although this may not hold in general depending on the quality of the data (see Sect. XX), and the complexity of the parameter-set.
% \item For the free floating parameter case, the results are shown in both raw form and with a reference phase set in Figs. XX and XX. This illustrates the phase sensitivity of the fitting, and also that this is a \textit{relative} phase. In a similar fashion to statistically sampling the parameter space with the seed parameters, allowing unconstrained parameters also helps to ensure that the full hyperspace is probed; however, it is not apparent that a viable solution set (or sets) have been found until a reference phase is set. (Similar considerations may apply to the magnitudes, depending on whether these are chosen to be normalised and/or if $\beta_{0,0}$ values are included in the fitting.)
% \item Uncertainties on the parameters here are estimated from the fit using a standard approach of testing the curvature of the $\chi^2$ hypersurface with respect to each parameter; in this case this routine is implemented by the lmfit library. Uncertainties may also be estimated by repeated fits to different sub-sets of the data - a statistical bootstrapping methodology - which is investigated in Sect. XX [TODO].
\end{enumerate}


To drill down into the results, the values and clustering of the retrieved parameter sets can be investigated, as well as the overall quality of the fitting. Fig. \ref{494229} illustrates the spread in retrieved parameters over the best fit region, and Fig. [XX] shows the overall quality of the fits in this region. For the purposes of discussion, eacAgain, some tentative conclusions can be drawn:

\begin{enumerate}
\item The results for the magnitudes show very little difference within each $chi^2$ cluster, and closer inspection reveals that values between clusters are typically within 5\%, with the exception of the [PU,3,1] case which shows a larger spread. This indicates a good agreement in all results.
\item The phase results broadly fall into two classes, (a) cases which show good agreement within a $chi^2$ cluster, and (b) cases which have two values per $chi^2$ cluster
\end{enumerate}

% \subsubsection{Bootstrapping basics: 10-point fit}

% As an initial test of the method, noise-free data was used, and 10 temporal points over the main revival feature were randomly selected. To fit the data, a set of fitting parameters were defined in (magnitude, phase) form. In this case, the parameter set was simply defined from the input matrix elements, including symmetry relations, resulting in 6 complex radial matrix elements defining the problem (this equates to 2n-1 parameters to determine in magnitude-phase form, where the -1 arises since the phases are relative, and one phase must be defined as a reference, either pre or post fit); in general this step in the protocol may require manual configuration for the problem at hand [MORE ON THIS? MATRIX METHOD TOO]. 

% The PEMtk fitting matrix element fitting routine wraps the lmfit package [REF, https://lmfit.github.io/lmfit-py/, https://dx.doi.org/10.5281/zenodo.11813], in this case a standard Levenberg-Marquardt minimization was used, and all (12) parameters allowed to float freely. To gain insight into the efficiency of the fitting routine, and the uniqueness of the fit results [REF], 1000 fits were performed on the same dataset, each seeded with randomised parameter values. (This methodology amounts to a statistical sampling of the solution hyperspace, which may be expected to contain some local minima in general high-dimensional cases. [REF]) Convergence criteria were set as .... Running in parallel on 20 (logical) cores of an AMD Threadripper 2950X based workstation, this required ~5GB of RAM and took on the order of 20 minutes per 100 fits (albeit with large variance, since convergence time depends on the start parameters); further benchmarks for the current codebase can be found at [REF].



% Results are summarised in Figs. XX. A few conclusions from this case study:

% \begin{enumerate}
% \item Not all fits that converged - as defined by the criteria above - provided the reference matrix elements. This illustrates the importance of statistical sample of the solution hyperspace, and/or the use of further tests of the fit results [REF] in order to determine their veracity in general.
% \item In this case, the lowest $\chi^2$ does correspond to the reference matrix elements. Further, in the noise-free case, the minima found in these cases is orders of magnitude lower than the next best parameter set, although this may not hold in general depending on the quality of the data (see Sect. XX), and the complexity of the parameter-set.
% \item For the free floating parameter case, the results are shown in both raw form and with a reference phase set in Figs. XX and XX. This illustrates the phase sensitivity of the fitting, and also that this is a \textit{relative} phase. In a similar fashion to statistically sampling the parameter space with the seed parameters, allowing unconstrained parameters also helps to ensure that the full hyperspace is probed; however, it is not apparent that a viable solution set (or sets) have been found until a reference phase is set. (Similar considerations may apply to the magnitudes, depending on whether these are chosen to be normalised and/or if $\beta_{0,0}$ values are included in the fitting.)
% \item Uncertainties on the parameters here are estimated from the fit using a standard approach of testing the curvature of the $\chi^2$ hypersurface with respect to each parameter; in this case this routine is implemented by the lmfit library. Uncertainties may also be estimated by repeated fits to different sub-sets of the data - a statistical bootstrapping methodology - which is investigated in Sect. XX [TODO].
% \end{enumerate}

% TO CONSIDER:

% - Level of detail here, words vs. just pointing at the notebook.
% - Plot style, types and export, see notes below (commented out)

% TODO: test HV HTML interactive export > Authorea, see https://holoviews.org/user_guide/Plots_and_Renderers.html

% Bokeh: https://docs.bokeh.org/en/latest/docs/user_guide/embed.html

% Authorea & Plotly: % https://support.authorea.com/en-us/article/inserting-an-interactive-figure-y32ne6/