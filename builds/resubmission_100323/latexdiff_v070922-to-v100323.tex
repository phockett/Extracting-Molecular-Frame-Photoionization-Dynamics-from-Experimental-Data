
%DIF LATEXDIFF DIFFERENCE FILE
%DIF DEL ../Extracting-Molecular-Frame-Photoionization-Dynamics-from-Experimental-Data/builds/submission_080922/authorea_article_flat_withPreamble_captionFix_figFix_absFix_ToC_070922.tex   Fri Sep  9 11:12:28 2022
%DIF ADD ../Extracting-Molecular-Frame-Photoionization-Dynamics-from-Experimental-Data/builds/overleaf_master_100323.tex                                                                     Fri Mar 10 16:45:36 2023
% Preamble as per Authorea export full_article.tex

\documentclass[10pt]{article}

\usepackage{fullpage}
\usepackage{setspace}
\usepackage{parskip}
\usepackage{titlesec}
\usepackage[section]{placeins}
\usepackage{xcolor}
\usepackage{breakcites}
\usepackage{lineno}
\usepackage{hyphenat}





\PassOptionsToPackage{hyphens}{url}
\usepackage[colorlinks = true,
            linkcolor = blue,
            urlcolor  = blue,
            citecolor = blue,
            anchorcolor = blue]{hyperref}
\usepackage{etoolbox}
\makeatletter
%DIF 28c28
%DIF < % \patchcmd\@combinedblfloats{\box\@outputbox}{\unvbox\@outputbox}{}{%
%DIF -------
%\patchcmd\@combinedblfloats{\box\@outputbox}{\unvbox\@outputbox}{}{% %DIF > 
%DIF -------
%  \errmessage{\noexpand\@combinedblfloats could not be patched}%
%DIF 30c30
%DIF < % }%
%DIF -------
%}% %DIF > 
%DIF -------
\makeatother


% \usepackage{natbib}




\renewenvironment{abstract}
  {{\bfseries\noindent{\abstractname}\par\nobreak}\footnotesize}
  {\bigskip}

\titlespacing{\section}{0pt}{*3}{*1}
\titlespacing{\subsection}{0pt}{*2}{*0.5}
\titlespacing{\subsubsection}{0pt}{*1.5}{0pt}


\usepackage{authblk}


\usepackage{graphicx}
\usepackage[space]{grffile}
\usepackage{latexsym}
\usepackage{textcomp}
\usepackage{longtable}
\usepackage{tabulary}
\usepackage{booktabs,array,multirow}
\usepackage{amsfonts,amsmath,amssymb}
\providecommand\citet{\cite}
\providecommand\citep{\cite}
\providecommand\citealt{\cite}
% You can conditionalize code for latexml or normal latex using this.
\newif\iflatexml\latexmlfalse
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}%

\AtBeginDocument{\DeclareGraphicsExtensions{.pdf,.PDF,.eps,.EPS,.png,.PNG,.tif,.TIF,.jpg,.JPG,.jpeg,.JPEG}}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}



\usepackage{float}

% Additional mods added manually.
\usepackage{bm}   % For math \bm
\usepackage{csquotes}

% \usepackage[numbers]{natbib}   % Update Natbib settings to numerical
% \bibliographystyle{unsrt}   % OK, but missing hyperlinks?
% \bibliographystyle{abbrvnat}  % Includes links/URLs as text, but not active.

% TODO: check usual bib styles here...!  Try also different Authorea exports...?

% PLUS TEST BIBLATEX (styles from last CV tests), see also https://www.overleaf.com/learn/latex/Bibliography_management_with_biblatex
% \RequirePackage[bibstyle=apa6,sorting=ymdnt,uniquename=init,defernumbers=true,apamaxprtauth=30]{biblatex}
% \RequirePackage[bibstyle=apa6,uniquename=init]{biblatex}
% \RequirePackage[defernumbers=true,uniquename=init]{biblatex}

% Numerical compact with no sorting (reference order)
\RequirePackage[style=numeric-comp,sorting=none]{biblatex}
\addbibresource{bibliography/MF_recon_manuscript_June2020.bib}
%DIF 93a93
\addbibresource{bibliography/new_refs_jpbreview_VM_020323.bib}  % For additional refs March 2023 %DIF > 
%DIF -------

% THIS IS WORKING WELL, except missing links for software entries - fixed this with style mod before...?
% NOW WITH UPDATED BIB FILES...
% \addbibresource{bibliography/MF_recon_manuscript_June2020_BBT-URLs.bib}  % URLs and DOIs with links printed.
% \addbibresource{bibliography/MF_recon_manuscript_June2020_BBT-DOIsPref.bib}  % DOI or URL, inc. "visited on". Also arxiv links?

% TODO: check usual bib styles here...!  Try also different Authorea exports...?

% Add ORCHID macro, see https://tex.stackexchange.com/a/478780
% Academicons - not compatible with pdflatex.
% Use fontawesome or orcidlink
% \usepackage{academicons}
% \newcommand{\orcid}[1]{\href{https://orcid.org/#1}{\textcolor[HTML]{A6CE39}{\aiOrcid}}}

\usepackage{orcidlink}


% Edit this header.tex file to include frontmatter definitions and global macros

% Add here any LaTeX packages you would like to load in all document blocks
% \usepackage{xspace}

% Add here any LaTeX macros you would like to load in all document blocks
% \def\example{This is an example macro.}

% Macros for Supplement/Appendix, from https://support.authorea.com/en-us/article/how-to-create-an-appendix-section-or-supplementary-information-1g25i5a/
\newcommand{\beginsupplement}{%
        \setcounter{table}{0}
        \renewcommand{\thetable}{A\arabic{table}}%
        \setcounter{figure}{0}
        \renewcommand{\thefigure}{A\arabic{figure}}%
     }

% -----

\iflatexml
% Add here any LaTeXML-specific commands

% -----

\else
% Add here any export style-specific LaTeX commands. These will only be loaded upon document export. 
% \paperfield{Subject domain of my document}
% \keywords{keyword1, keyword2}
% \corraddress{Author One PhD, Department, Institution, City, State or Province, Postal Code, Country}
% \fundinginfo{Funder One, Funder One Department, Grant/Award Number: 123456.}
\fi


% Bib if using BibLaTex, or set in preamble
% \addbibresource{bibliography/biblio}
%DIF PREAMBLE EXTENSION ADDED BY LATEXDIFF
%DIF UNDERLINE PREAMBLE %DIF PREAMBLE
\RequirePackage[normalem]{ulem} %DIF PREAMBLE
\RequirePackage{color}\definecolor{RED}{rgb}{1,0,0}\definecolor{BLUE}{rgb}{0,0,1} %DIF PREAMBLE
\providecommand{\DIFaddtex}[1]{{\protect\color{blue}\uwave{#1}}} %DIF PREAMBLE
\providecommand{\DIFdeltex}[1]{{\protect\color{red}\sout{#1}}}                      %DIF PREAMBLE
%DIF SAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddbegin}{} %DIF PREAMBLE
\providecommand{\DIFaddend}{} %DIF PREAMBLE
\providecommand{\DIFdelbegin}{} %DIF PREAMBLE
\providecommand{\DIFdelend}{} %DIF PREAMBLE
%DIF FLOATSAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddFL}[1]{\DIFadd{#1}} %DIF PREAMBLE
\providecommand{\DIFdelFL}[1]{\DIFdel{#1}} %DIF PREAMBLE
\providecommand{\DIFaddbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFaddendFL}{} %DIF PREAMBLE
\providecommand{\DIFdelbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFdelendFL}{} %DIF PREAMBLE
%DIF HYPERREF PREAMBLE %DIF PREAMBLE
\providecommand{\DIFadd}[1]{\texorpdfstring{\DIFaddtex{#1}}{#1}} %DIF PREAMBLE
\providecommand{\DIFdel}[1]{\texorpdfstring{\DIFdeltex{#1}}{}} %DIF PREAMBLE
\newcommand{\DIFscaledelfig}{0.5}
%DIF HIGHLIGHTGRAPHICS PREAMBLE %DIF PREAMBLE
\RequirePackage{settobox} %DIF PREAMBLE
\RequirePackage{letltxmacro} %DIF PREAMBLE
\newsavebox{\DIFdelgraphicsbox} %DIF PREAMBLE
\newlength{\DIFdelgraphicswidth} %DIF PREAMBLE
\newlength{\DIFdelgraphicsheight} %DIF PREAMBLE
% store original definition of \includegraphics %DIF PREAMBLE
\LetLtxMacro{\DIFOincludegraphics}{\includegraphics} %DIF PREAMBLE
\newcommand{\DIFaddincludegraphics}[2][]{{\color{blue}\fbox{\DIFOincludegraphics[#1]{#2}}}} %DIF PREAMBLE
\newcommand{\DIFdelincludegraphics}[2][]{% %DIF PREAMBLE
\sbox{\DIFdelgraphicsbox}{\DIFOincludegraphics[#1]{#2}}% %DIF PREAMBLE
\settoboxwidth{\DIFdelgraphicswidth}{\DIFdelgraphicsbox} %DIF PREAMBLE
\settoboxtotalheight{\DIFdelgraphicsheight}{\DIFdelgraphicsbox} %DIF PREAMBLE
\scalebox{\DIFscaledelfig}{% %DIF PREAMBLE
\parbox[b]{\DIFdelgraphicswidth}{\usebox{\DIFdelgraphicsbox}\\[-\baselineskip] \rule{\DIFdelgraphicswidth}{0em}}\llap{\resizebox{\DIFdelgraphicswidth}{\DIFdelgraphicsheight}{% %DIF PREAMBLE
\setlength{\unitlength}{\DIFdelgraphicswidth}% %DIF PREAMBLE
\begin{picture}(1,1)% %DIF PREAMBLE
\thicklines\linethickness{2pt} %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\framebox(1,1){}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,0){\line( 1,1){1}}}% %DIF PREAMBLE
{\color[rgb]{1,0,0}\put(0,1){\line(1,-1){1}}}% %DIF PREAMBLE
\end{picture}% %DIF PREAMBLE
}\hspace*{3pt}}} %DIF PREAMBLE
} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbegin}{\DIFaddbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddend}{\DIFaddend} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbegin}{\DIFdelbegin} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelend}{\DIFdelend} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbegin}{\DIFOaddbegin \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbegin}{\DIFOdelbegin \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelend}{\DIFOaddend \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddbeginFL}{\DIFaddbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOaddendFL}{\DIFaddendFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelbeginFL}{\DIFdelbeginFL} %DIF PREAMBLE
\LetLtxMacro{\DIFOdelendFL}{\DIFdelendFL} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddbeginFL}{\DIFOaddbeginFL \let\includegraphics\DIFaddincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFaddendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelbeginFL}{\DIFOdelbeginFL \let\includegraphics\DIFdelincludegraphics} %DIF PREAMBLE
\DeclareRobustCommand{\DIFdelendFL}{\DIFOaddendFL \let\includegraphics\DIFOincludegraphics} %DIF PREAMBLE
%DIF END PREAMBLE EXTENSION ADDED BY LATEXDIFF

\begin{document}

\title{% NOTE - manually created in this case, Authorea only generated HTML version.
Topical Review: Extracting Molecular Frame Photoionization Dynamics from Experimental Data
}
% Manually created for local builds

\author[1]{Paul Hockett\thanks{paul@femtolab.ca} \orcidlink{0000-0001-9561-8433}}%
\author[2]{Varun Makhija\thanks{vmakhija@umw.edu} \orcidlink{0000-0002-4975-4888}}
\affil[1]{National Research Council of Canada, 100 Sussex Drive, Ottawa, ON, K1A 0R6, Canada}%
\affil[2]{Department of Chemistry and Physics, University of Mary Washington, 1301 College Avenue, Fredericksburg VA, 22401.}%

\vspace{-1em}

\date{\today}


\begingroup
\let\center\flushleft
\let\endcenter\endflushleft
\maketitle
\endgroup

%DIF <  \tableofcontents
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend \begin{abstract}Methods for experimental reconstruction of molecular frame (MF) photoionization dynamics, and related properties - specifically MF photoelectron angular distributions (PADs) and continuum density matrices - are outlined and discussed. General concepts are introduced for the non-expert reader, and experimental and theoretical techniques are further outlined in some depth. Particular focus is placed on a detailed example of numerical reconstruction techniques for matrix-element retrieval from time-domain experimental measurements making use of rotational-wavepackets (i.e. aligned frame measurements) - the ``bootstrapping to the MF" methodology - and a matrix-inversion technique for direct MF-PAD recovery. Ongoing resources for interested researchers are also introduced, including sample data, reconstruction codes (the \textit{Photoelectron Metrology Toolkit}, written in python, and associated \textit{Quantum Metrology with Photoelectrons} platform/ecosystem), and literature via online repositories; it is hoped these resources will be of ongoing use to the community.\end{abstract}
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend \tableofcontents

%DIF >  (For PDF version via arXiv: \href{http://arxiv.org/abs/2209.04301}{http://arxiv.org/abs/2209.04301}, for other online resources see Sect. \ref{sec:resources}.)
\DIFaddbegin 

\DIFaddend % Authors manually created for local builds

% \author[1]{Paul Hockett\thanks{paul@femtolab.ca} \orcid{0000-0001-9561-8433}}%
% \author[2]{Varun Makhija\thanks{vmakhija@umw.edu} \orcid{0000-0002-4975-4888}}
% \affil[1]{National Research Council of Canada, 100 Sussex Drive, Ottawa, ON, K1A 0R6, Canada}%
% \affil[2]{Department of Chemistry and Physics, University of Mary Washington, 1301 College Avenue, Fredericksburg VA, 22401.}%

% \vspace{-1em}

% \date{\today}


% \begingroup
% \let\center\flushleft
% \let\endcenter\endflushleft
% \maketitle
% \endgroup

% \section{Abstract}

% Methods for experimental reconstruction of molecular frame (MF) photoionization dynamics, and related properties - specifically MF photoelectron angular distributions (PADs) and continuum density matrices - are outlined and discussed. General concepts are introduced for the non-expert reader, and experimental and theoretical techniques are further outlined in some depth; particular focus is placed on a detailed example of numerical reconstruction techniques for matrix-element retrieval from time-domain experimental measurements making use of rotational-wavepackets (aligned frame measurements). Ongoing resources for interested researchers are also introduced, including sample data, reconstruction codes (written in python) and associated platform, and literature via online repositories; it is hoped these resources will be of ongoing use to the community.


% \section*{Document history}
\DIFdelbegin %DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend %DIF > 
%DIF >  10th March 2023: updated text and figures per referee comments. Updated to GH, postSubmission branch, https://github.com/phockett/Extracting-Molecular-Frame-Photoionization-Dynamics-from-Experimental-Data/tree/postSubmissionUpdates
%DIF > 
% \begin{description}
% \item [{Status}] Submission in progress.
% \item [{05/09/22}] Current version more-or-less complete, updated on Github and also created Authorea fork.
% \item [{26/08/22}] 2nd Final pass in progress...
% \begin{itemize}
% \item TODO: finish Outlook (Sect. \ref{sec:summary-outlook}), tidy Sects. \ref{sec:Matrix-inversion-example} and \ref{app:mat-inversion}, decide on protocol diagrams (all vs. unified).
% \item Figures and notebooks updated.
% \item Sects. \ref{sec:MF-recon-expt} and \ref{sec:RWPs} added to better cover recon and RWPs.
% \item Sect. \ref{sec:recon-from-MFPADs} on recon from MF added following numerical tests.
% \end{itemize}
% \item [{12/06/22}] Final pass in progress...
% \begin{itemize}
% \item Online repos (Figshare, Zotero) configured, left empty.
% \item Some tidy up of Sects. \ref{sec:bootstrapping} and \ref{sec:Appendix-A} completed.
% \item TODO: finish demo notebooks \& final figures
% \begin{itemize}
% \item 27/07/22 Updated figures \& notebooks almost completed. Figs to doc, notebook to tidy then upload.
% \item 03/08/22 Tidied first half of text (including sub-sectioning) to Sect. 5, and Appendix. Broke references and PDF compilation? (Although HTML seems OK, and updating as sections edited.) Sect. 4 still needs some polishing. Most updated/final figs now in place.
% \end{itemize}
% \item TODO: tidy up intro sections. 05/08/22: now mostly done, MF experimental sections still needs some work though.
% \end{itemize}
% \item [{02/05/22}] Tidied up missing refs (OK on export, possibly not in HTML build?) \& intro sections (still needs quite a bit of work). Theory Sect 4.3 mostly fleshed-out.
% \item [{22/04/22}] Now (mostly) updated with interactive figs and mostly complete recon section.
% \item [{12/04/22}] Adding placeholder figures and notes from \href{https://pemtk.readthedocs.io/en/latest/fitting/PEMtk_analysis_demo_150621-tidy.html}{recon demo docs}.
% \item [{17/09/21}] Started actual recon section...
% \item [{03/09/21}] Revisiting and updating with recent progress \& results.
% \item [{07/07/20}] \href{https://github.com/phockett/Extracting-Molecular-Frame-Photoionization-Dynamics-from-Experimental-Data}{Pushed to Github}, use this for .bib management.
% \item [{03/05/20}] Outline/rough draft begun on Authorea, based on notes Dec. 2019.
% \end{description}


\section{Overview}

\subsection{Topical introduction}
The main aim of this topical review is to discuss the determination of molecular frame (MF) photoionization dynamics (and related properties) from laboratory frame (LF) measurements. This particular problem is a subset of the larger topic of determining quantum mechanical properties of molecules (and general quantum mechanical systems) which has been, of course, long at the heart of molecular physics, physical chemistry and related disciplines. Spectroscopy, in particular, has the underlying goal of the determination of atomic and molecular properties with high precision; the ``inverse” problem of transforming \textit{ab initio} (computational) results, which naturally start in the MF, to the LF (in order to compare with experimental measurements and phenomena), also has a long and storied history. In both cases the issue is, in very general terms, one of complexity and averaging over unobserved quantities/properties/degrees-of-freedom of the system; furthermore, in many cases, certain properties may be poorly understood, may fundamentally obscure other properties of interest, and/or may not be readily computed. These issues are particularly relevant for the specific case of photoionization dynamics, which is an inherently complicated scattering problem, and may be strongly coupled to other molecular properties, i.e. electronic, vibrational and rotational dynamics. 

While many of these issues are general in quantum state reconstruction problems~\cite{Fano1957}, photoionization dynamics is the focus of this review, and the determination of photoionization dynamics and correlated observables in the molecular frame the main topic of discussion. Historically this determination has been termed a ``complete" photoionization experiment, and has also recently been reframed in terms of quantum tomography and metrology, which has essentially the same aims of complete system reconstruction - in the photoionzation case the photoionization matrix elements fully describe the electron-molecule scattering event initiated by photo-absorption, hence the continuum state populated by photoionization or, equivalently, the continuum density matrix.

Herein, the problem of complexity is approached generally in terms of the dimensionality of the problem, and the information content of the measurement; examples are built-up and discussed in these terms. However, note that the aim here is not for a comprehensive review of the literature, but rather a topical introduction (Sect. \ref{sec:Framing}) and more detailed background (Sect. \ref{sec:Concepts}), including recent progress in this area, followed by a (reader-extensible) tutorial overview of concepts, grounded in numerical examples (Sect. \ref{sec:Recon}). Overall, the aims herein are to introduce new researchers to this interesting topic, present realistic case-studies, and (attempt to) build bridges between some historically disparate sub-topics/areas of the field, as well as emerging methods in related fields.

% \subsection{Review scope}
% As stated previously, this topical review aims to discuss and survey current methodologies for measuring, or otherwise obtaining, MF photoionization properties. The aim herein is not for a comprehensive literature review (for these, see, for example, refs. [....]), nor a thorough introduction to the core physics (for this, see, for example, refs. [...]), nor a re-tread of previously published materials. Instead, this review aims to present a (reader-extensible) tutorial overview of concepts, grounded in ab initio calculations (and open-science principles, with corresponding open-source code available online), and a survey of recent method development and experimental progress on the topic. In order to maintain relevance, and address any significant lacunae in the knowledge of the current authors,  a discussion group/wiki/Github repo [TBD] has also been created [ref/details....]. It is hoped that, in this way, this manuscript will become a living document, and a useful resource for interested researchers that will grow over time. It is also hoped that this manuscript, and especially the online discussions, will serve  to garner opinions from a cross-section of interested researchers, and help to bridge the gaps between the various, historically somewhat disparate, communities (e.g. spectroscopy, general AMO physics, quantum information etc.) intereseted in this topic.

In order to try and fulfill these aims, and to make a useful contribution to the community, this review aims to provide a number of supplementary resources for researches, and engender discussion on this topic. The numerical work follows open-science principles, with corresponding data and open-source code available online; the underlying \textit{Quantum Metrology with Photoelectrons} platform is introduced in Sect. \ref{sec:numerics-intro}, and a full list of relevant online resources is given in Sect. \ref{sec:resources}.
In particular the analysis routines demonstrated in Sect. \ref{sec:bootstrapping} - along with relevant data - are available online, as a set of Jupyter computational notebooks backed by open-source python libraries (Sect. \ref{sec:numerics-intro}).
It is hoped that, in this way, this manuscript will become a living document, and a useful resource for interested researchers that will grow over time. It is also hoped that this manuscript, and especially the online discussions, will serve  to garner opinions from a cross-section of interested researchers, and help to bridge the gaps between the various, historically somewhat disparate, communities (e.g. spectroscopy, general AMO physics, quantum information etc.) interested in quantum state reconstruction in various cases. With this in mind, references are only given sparingly in the main text, and mainly provided as lists in Sect. \ref{sec:Appendix-A}; the full bibliography is also available online (via \href{https://www.zotero.org/groups/4733878/molecular_frame_pads_measurements_and_reconstruction}{a Zotero group} \cite{hockettZoteroGroupsMolecular}) - this is very far from a comprehensive list: it is again hoped that this will be used, and grown, by interested researchers.

\subsection{Outline}

This topical review is structured as follows:

\begin{itemize}
\item Sect. \ref{sec:Framing}: general introduction and discussion of the topic in broad terms, suitable for a general reader.
\item Sect. \ref{sec:Concepts}: discussion of experimental techniques (Sect. \ref{sec:experimentalTechniques}), and a more detailed introduction to theory, specifically a tensor formulation  (Sect. \ref{sec:theoretical-techniques}) and associated numerical methods for MF retrieval (Sect. \ref{sec:recon-techniques-intro}).
\item Sect. \ref{sec:Recon}: worked examples for MF reconstruction for two retrieval protocols. This forms the main substance of the review, in particular Sect. \ref{sec:bootstrapping} provides a detailed case-study; note that figures are interactive in HTML versions of the manuscript and also available in the data repository for the manuscript \cite{hockett2022MFreconFigshare}.
\item Sect. \ref{sec:summary-outlook}: Summary \& outlook.
\item Sect. \ref{sec:resources}: additional resources, including codes, data and notebooks pertaining to Sect. \ref{sec:Recon}.
\item Sect. \ref{sec:Appendix-A}: further reading.
\item Sect. \ref{sec:Appendix-B}: extended theoretical details.
\end{itemize}

% \section{Introduction\label{sec:Introduction}}

% \begin{itemize}
% \item Complexity
% \item Direct vs. indirect; degrees of directness.
% \item Dimensionality.
% \item Photoionization, 
% \begin{itemize}
% \item lit review
% \item coupling to molecular properties.
% \end{itemize}
% \item New developments and methods.
% \item Laser vs. synchrotron vs. phys chem approaches? 
% \begin{itemize}
% \item Bridge building. 
% \item Some notes from paper reviews (atomic vs. molecular, complexity, physics
% vs. chem)
% \end{itemize}
% \end{itemize}

% \subsection{Outline}

% In this topical review

% \subsection{Outline and aims}

% As stated previously, this topical review aims to discuss and survey current methodologies for measuring, or otherwise obtaining, MF photoionization properties. The aim here is not for a comprehensive literature review (for these, see, for example, refs. [....]), nor a thorough introduction to the core physics (for this, see, for example, refs. [...]), nor a re-tread of previously published materials. Instead, this review aims to present a (reader-extensible) tutorial overview of concepts, grounded in ab initio calculations (and open-science principles, with corresponding open-source code available online), and a survey of recent method development and experimental progress on the topic. In order to maintain relevance, and address any significant lacunae in the knowledge of the current authors,  a discussion group/wiki/Github repo [TBD] has also been created [ref/details....]. It is hoped that, in this way, this manuscript will become a living document, and a useful resource for interested researchers that will grow over time. It is also hoped that this manuscript, and especially the online discussions, will serve  to garner opinions from a cross-section of interested researchers, and help to bridge the gaps between the various, historically somewhat disparate, communities (e.g. spectroscopy, general AMO physics, quantum information etc.) intereseted in this topic.
\section{Framing the problem\label{sec:Framing}}

In this section some general introduction and discussion is provided, in rather broad terms, suitable for a general reader. For a more detailed discussion of photoionization problems see Sect. \ref{sec:Concepts}.

\subsection{Molecular properties}
A very general problem in molecular physics is the determination of intrinsic molecular properties from experimental measurements, and comparing such measurements with theoretical predictions. The key difficulty is, usually, the averaging or integration over unobserved degrees-of-freedom (DOFs) in the measurements. The exact nature of the DOFs will, naturally, be system and problem dependent, as will the coupling strength of the unobserved DOFs to the system properties of interest. From a spectroscopic perspective, one usually considers the DOFs in terms of a Born-Oppenheimer \DIFaddbegin \DIFadd{(BO) }\DIFaddend separation of the full molecular wavefunction, i.e. in terms of electronic, vibrational and rotational DOFs\DIFdelbegin \DIFdel{, which may }\DIFdelend \DIFaddbegin \DIFadd{. These BO DOFs are useful, since they provide an intuitive separation of states, which can be regarded as uncoupled to a first approximation. These states may then }\DIFaddend approximately correlate with the choice of spectroscopic methodology applied \DIFaddbegin \DIFadd{(in terms of characteristic energy or time regimes)}\DIFaddend , and often provide a good approximation to the fully-coupled system. One can also consider this issue in terms of a general quantum mechanical language of eigenstates, wavefunctions, wavepackets (more appropriate for dynamical systems), density matrices and so forth. Framing the problem in this language perhaps highlights the generality of the molecular case as a many-body quantum mechanical matter system, to which certain formal DOF separations are often applicable - but, regardless of the language, the problem remains that many-body systems are analytically unsolvable and can be computationally intractable. 
\DIFaddbegin \DIFadd{(For a tutorial-style introduction to some of these issues in the time-resolved case, see Ref. \mbox{%DIFAUXCMD
\cite{wu2011TimeresolvedPhotoelectronSpectroscopy} }\hspace{0pt}%DIFAUXCMD
and references therein.) }\DIFaddend %rather complicated.

In favourable cases, careful experimental design can obviate the issue of DOF averaging in specific cases via, for instance, state-selection of the system prior to measurement to reduce the complexity of the problem at hand\DIFdelbegin \DIFdel{(}\DIFdelend \DIFaddbegin \DIFadd{. This is }\DIFaddend typical in frequency-resolved spectroscopy, \DIFaddbegin \DIFadd{see, }\DIFaddend e.g.\DIFaddbegin \DIFadd{, introductory spectroscopy textbooks }\DIFaddend \cite{bunkerMolSymm, herzberg1945molecular, hollasHighRes}\DIFdelbegin \DIFdel{) or }\DIFdelend \DIFaddbegin \DIFadd{. Similarly, }\DIFaddend preparing a specific ``zeroth-order" wavepacket\DIFdelbegin \DIFdel{(typical }\DIFdelend \DIFaddbegin \DIFadd{, viewed as a superposition of BO states, is the typical target case }\DIFaddend in time-resolved spectroscopy \DIFaddbegin \DIFadd{experiments, see}\DIFaddend , e.g.\DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{Tannor2007,Stolow2008,wu2011TimeresolvedPhotoelectronSpectroscopy}}\hspace{0pt}%DIFAUXCMD
); however}\DIFdelend \DIFaddbegin \DIFadd{, Refs. \mbox{%DIFAUXCMD
\cite{Tannor2007,Stolow2008,wu2011TimeresolvedPhotoelectronSpectroscopy}}\hspace{0pt}%DIFAUXCMD
. However}\DIFaddend , in many (\DIFdelbegin \DIFdel{most?}\DIFdelend \DIFaddbegin \DIFadd{perhaps most}\DIFaddend ) cases this is not feasible due to the inherent complexity of the system, and/or coupling (non-separability) of states, and/or experimental issues \DIFdelbegin \DIFdel{/}\DIFdelend \DIFaddbegin \DIFadd{or }\DIFaddend limitations. The problem becomes significantly worse for larger systems as the number of DOFs (hence density of states) increases, and/or if the DOFs are continuous \DIFdelbegin \DIFdel{, }\DIFdelend \DIFaddbegin \DIFadd{- }\DIFaddend rather than quantised \DIFdelbegin \DIFdel{, }\DIFdelend \DIFaddbegin \DIFadd{- }\DIFaddend properties, and/or if many states are populated. In general, then, this is a problem which must ideally be addressed at a high level, by a combination of experiment and theory. Happily, both are increasingly possible, and becoming more routine, as technology improves; of particular relevance to the photoionization case at hand is the advent of photoelectron imaging \cite{Whitaker2003}, advances in short laser pulses and control, and the ongoing march of available computational power and software.

In terms of photoionization studies, the aims can be viewed both in terms of control and in terms of measurement and reconstruction. For instance, a basic photoelectron imaging experiment may seek to measure photoelectron energy and lab-frame (LF) angular distributions from a given system. A more sophisticated experiment may seek to control these observables in some way, e.g. via state-preparation or ionizing pulse polarization, or may seek to use these measurements as a sensitive probe of some other DOF of interest, e.g. vibrational motion. A yet more sophisticated methodology may aim to directly obtain molecular frame information, or aim to obtain a ``complete" quantum mechanical description of the photoionization process from a set of measurements\DIFdelbegin \DIFdel{, which }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend may be an end in itself, or serve as a more sensitive probe of DOFs of interest. (For further discussion of experimental techniques, see Sect. \ref{sec:experimentalTechniques}; for further general discussion along these lines, see for example \DIFdelbegin \DIFdel{refs}\DIFdelend \DIFaddbegin \DIFadd{Refs}\DIFaddend . \cite{hockett2018QMP1, kleinpoppen2013perfect, Reid2012, Stolow2008}.)
\subsection{Molecular frame observables\label{sec:MF-intro}}

A very general issue, of fundamental interest, which falls in the latter categories - and lacks a general solution - is the measurement of observables which depend on the orientation of the molecular frame (MF). In general, this can be regarded as a geometric problem in the spatial (rotational) degrees of freedom, in which the intrinsic MF properties are averaged (or smeared out) in a given measurement. For instance, in a typical gas phase molecular spectroscopy measurement, the observables in the molecular frame  are averaged over all possible molecular orientations in a laboratory frame (LF) measurement. The inverse problem is also difficult, i.e. simulating specific experimental observables starting from \textit{ab initio} calculations in the molecular frame. In this case, to simulate LF results, knowledge of the degree and type of geometric averaging is \DIFdelbegin \DIFdel{required, and in some }\DIFdelend \DIFaddbegin \DIFadd{generally required. In more complex }\DIFaddend cases \textit{ab initio} calculations \DIFaddbegin \DIFadd{may }\DIFaddend need to be carried out for various molecular orientations\DIFaddbegin \DIFadd{, or coupled DOFs such as vibrational motions. Of particular interest in the current case will be the aligned frame (AF), which signifies a measurement frame with some degree of spatial preparation (alignment or orientation of the molecular axis ensemble) of the sample via, for instance, photon absorption (see Sect. \ref{sec:MF-control} for further discussion of the AF)}\DIFaddend .
%\textbf{, or in some cases ab initio calculations need to be carried out for various molecular orientations }. 

Despite, or perhaps because of, the inherent difficulties, obtaining  MF measurements remains a topic of great interest, and much progress in experimental methodologies has been made in recent decades \cite{Becker1998,Reid2003,Reid2012,kleinpoppen2013perfect,Yagishita2015,hockett2018QMP1}. 
%DIF < [JPB MFPADs special, check book refs.]. 
%DIF >  kleinpoppen2013perfect, Yagishita2015, hockett2018QuantumMetrologyPhotoelectrons}. %[JPB MFPADs special, check book refs.]. 
These methodologies can be classified, approximately, as \DIFaddbegin \DIFadd{sitting somewhere on the spectrum between }\DIFaddend (1) relatively direct \DIFdelbegin \DIFdel{, meaning that the methodologies seek to control or reconstruct }\DIFdelend \DIFaddbegin \DIFadd{and (2) indirect methodologies. In the limit of (1), the methodologies are designed to enable control and reconstruction of }\DIFaddend the MF, hence measure MF observables \DIFdelbegin \DIFdel{, }\DIFdelend (somewhat) directly, with minimal data processing requirements. Another avenue to MF observables is \DIFdelbegin \DIFdel{via what may be called }\DIFdelend \DIFaddbegin \DIFadd{the limiting case of indirect methodologies }\DIFaddend (2)\DIFdelbegin \DIFdel{indirect methodologies}\DIFdelend \DIFaddbegin \DIFadd{, which involve more simulation and have less stringent (or at least different) experimental requirements}\DIFaddend . In the current context, this can be defined as techniques which make use of detailed theory and analysis procedures to reconstruct MF properties from LF measurements. Broadly speaking, one can also consider indirect methods as a post-processing or analysis-based approach, with a significant theoretical and computational requirement (akin to computational imaging techniques, as well as many traditional energy-domain spectroscopy techniques)\DIFdelbegin \DIFdel{, while }\DIFdelend \DIFaddbegin \DIFadd{. In contrast, }\DIFaddend direct methods are, conceptually, closer to purely experimental methods, with more emphasis placed on detection techniques and capabilities, although significant numerical data analysis may still be required. 

There is, naturally, significant overlap between these extreme case definitions, and most methodologies and extant demonstrations fall somewhere on the spectrum between direct (``purely" experimental) and indirect. In particular, indirect approaches will typically still require some degree of (potentially sophisticated) experimental control, and a set of associated measurements, to be useful\DIFdelbegin \DIFdel{- for example, }\DIFdelend \DIFaddbegin \DIFadd{. For example, a set of }\DIFaddend LF measurements with different polarization geometries or with an optically-prepared \DIFdelbegin \DIFdel{ensemble; direct }\DIFdelend \DIFaddbegin \DIFadd{aligned ensemble may be required. Direct }\DIFaddend measurements usually require specific molecular behaviour(s) and/or preparation in order to measure suitable observables, due to experimental restrictions. \DIFdelbegin \DIFdel{Historically these }\DIFdelend \DIFaddbegin \DIFadd{A typical requirement in multi-particle coincidence imaging techniques may be, for example, molecular fragmentation following photoionization, since it is measurement of the fragments that allows for MF reconstruction in these methodologies. Historically different }\DIFaddend methods have typically been pursued by experimental communities making use of either laser-based (LF, AF and control \DIFaddbegin \DIFadd{type schemes}\DIFaddend ) or synchrotron-based (\DIFaddbegin \DIFadd{direct }\DIFaddend MF measurements) experimental methods\DIFdelbegin \DIFdel{; whilst the underlying }\DIFdelend \DIFaddbegin \DIFadd{. Whilst the underlying photoionization and molecular }\DIFaddend physics is shared, the different classes of experiment typically suit soft \DIFdelbegin \DIFdel{(}\DIFdelend \DIFaddbegin \DIFadd{or hard photon energies, for }\DIFaddend valence photoionization and multi-photon techniques\DIFdelbegin \DIFdel{) or hard (}\DIFdelend \DIFaddbegin \DIFadd{, or }\DIFaddend core ionization and dissociative photoionization based techniques\DIFdelbegin \DIFdel{) photon energies}\DIFdelend \DIFaddbegin \DIFadd{, respectively}\DIFaddend , although the split is not \DIFdelbegin \DIFdel{rigourous}\DIFdelend \DIFaddbegin \DIFadd{rigorous}\DIFaddend . However, there is increasingly overlap between the communities, particularly in the last decade or two\DIFdelbegin \DIFdel{, with }\DIFdelend \DIFaddbegin \DIFadd{. In particular, }\DIFaddend the advent of time-resolved hard photon sources \DIFdelbegin \DIFdel{, }\DIFdelend \DIFaddbegin \DIFadd{and }\DIFaddend strong-field \DIFdelbegin \DIFdel{laser techniques}\DIFdelend \DIFaddbegin \DIFadd{and emergent attosecond laser techniques has pushed developments on the ``tabletop" side (for a broad review of techniques in attoscience, see Ref. \mbox{%DIFAUXCMD
\cite{Krausz2009}}\hspace{0pt}%DIFAUXCMD
). Meanwhile, the advent of free-electron lasers (FELs)}\DIFaddend , and the \DIFdelbegin \DIFdel{availability of lasers at synchrotrons and FELs, thus enabling }\DIFdelend \DIFaddbegin \DIFadd{increasing availability of modern ultrafast lasers at synchrotron and FEL facilities, has enabled }\DIFaddend multi-source experiments in the time or frequency domain spanning optical and X-ray wavelengths and methods\DIFdelbegin \DIFdel{(for recent perspectives }\DIFdelend \DIFaddbegin \DIFadd{. (For recent perspectives covering many of these topics, including recent ultrafast and X-ray developments, }\DIFaddend see, for instance, Refs. \cite{Young2018,ueda2019RoadmapPhotonicElectronic}\DIFdelbegin \DIFdel{).}\DIFdelend \DIFaddbegin \DIFadd{.)
}\DIFaddend 

It is also noteworthy that in the context of ultracold physics a number of sophisticated techniques have been developed to coherently populate individual molecular eigenstates \cite{mitra2022QuantumControlMolecules}. While these techniques have yet to be applied to molecular photoionization, recent examples \DIFdelbegin \DIFdel{exists }\DIFdelend \DIFaddbegin \DIFadd{exist }\DIFaddend of similar techniques applied to atomic photoionization \cite{desilva2021CircularDichroismAtomic}.

% PH 27/07/22 added this to main text above
% \textbf{Maybe this goes here, maybe it doesn't, but we should probably mention it somewhere: It is noteworthy that in the context of ultracold physics a number of sophisticated techniques have been developed to coherently populate individual molecular eigenstates} \cite{mitra2022}. \textbf{While these techniques have yet to be applied to molecular photoionization, recent examples exists of similar techniques applied to atomic photoionization.} \cite{desilva2021}

\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/concepts_fig_draft_010417_withAxes}
\caption{Conceptual outline for retrieval of MF properties for \DIFdelbeginFL \DIFdelFL{"}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{``}\DIFaddendFL bootstrapping to the MF", via a set of time-resolved measurements and suitable post-processing scheme. In the LF, a set of laser pulses creates and probes an aligned distribution of molecules, and photoelectron images are measured. The experimental data is analyzed through a multi-step \DIFdelbeginFL \DIFdelFL{"}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{``}\DIFaddendFL bootstrap" protocol to obtain matrix elements, which constitute a complete description of the photoionization event. These can further be used to obtain MF observables, for any polarization geometry. Note the coordinates show will be used throughout the manuscript, with the LF z-axis defined relative to the laser field (\textbf{E}) polarization, and the MF defined with the molecular axis aligned along the z-axis (and polarization geometries for the laser field (\textbf{E}) referenced to this axis).\label{781808}}
\end{center}
\end{figure}


%DIF >  28/02/23 rev: got this far, above expanded a bit, may still need to review.
\DIFaddbegin 

\DIFaddend \subsection{Photoionization observables, properties and dimensionality\label{sec:Photo-into}}

Fundamentally, experimental observables depend on intrinsic molecular properties. In the  context of molecular physics, such properties are naturally expressed in the molecular frame - for instance: bond lengths, bond angles, polarisabilities, absorption cross-sections, dipole matrix elements and so on. Whilst it is often the case that such properties may be viewed as stationary, \DIFdelbegin \DIFdel{or approximately }\DIFdelend \DIFaddbegin \DIFadd{and possibly approximated }\DIFaddend semi-classical\DIFdelbegin \DIFdel{- e.g. }\DIFdelend \DIFaddbegin \DIFadd{, ultimately the dynamics of the system are also of great interest. For instance, in a stationary state }\DIFaddend the equilibrium or average bond-lengths of a system \DIFdelbegin \DIFdel{is }\DIFdelend \DIFaddbegin \DIFadd{are }\DIFaddend often viewed as a \DIFaddbegin \DIFadd{well-defined }\DIFaddend molecular property, \DIFdelbegin \DIFdel{rather than }\DIFdelend \DIFaddbegin \DIFadd{but really it is }\DIFaddend the associated vibrational wavefunction \DIFaddbegin \DIFadd{that defines this. However, in a state-resolved experiment, the averaging over the vibrational DOF may be small (i.e. the wavefunction is localised), so this approximation holds. More generally this may not be the case, and will not be the case in a time-resolved experimental methodology wherein a superposition of vibrational states  }\DIFaddend - \DIFdelbegin \DIFdel{ultimately the dynamics of the system are also of great interest}\DIFdelend \DIFaddbegin \DIFadd{a wavepacket - may be prepared}\DIFaddend . In this sense, the observables in a given case may also be affected by experimental conditions \DIFdelbegin \DIFdel{/}\DIFdelend \DIFaddbegin \DIFadd{and }\DIFaddend methods, and degrees-of-freedom \DIFdelbegin \DIFdel{/dynamics, and one seeks a ``maximum information" measurement to try and understand or quantitatively determine the various effects at play}\DIFdelend \DIFaddbegin \DIFadd{or dynamics, all of which may affect what are viewed as fundamental molecular properties}\DIFaddend . 

As well as MF observables, one may \DIFaddbegin \DIFadd{also }\DIFaddend be interested in determining the underlying intrinsic molecular properties which govern the observable, and/or exploring extrinsic properties which modify or control the observable\DIFdelbegin \DIFdel{(e.g. application of }\DIFdelend \DIFaddbegin \DIFadd{. For instance, the response to application of different }\DIFaddend laser field(s) \DIFaddbegin \DIFadd{(wavelength, intensity, polarization...)}\DIFaddend , preparation of specific molecular states\DIFaddbegin \DIFadd{, }\DIFaddend or wavepacket dynamics \DIFdelbegin \DIFdel{)}\DIFdelend \DIFaddbegin \DIFadd{in time-resolved studies}\DIFaddend . In some \DIFdelbegin \DIFdel{case }\DIFdelend \DIFaddbegin \DIFadd{cases }\DIFaddend the mapping between observable(s) and property/ies \DIFaddbegin \DIFadd{of interest }\DIFaddend may be relatively direct, in other cases much less so!

\DIFaddbegin \DIFadd{To mitigate these issues, one generally seeks a ``maximum information" measurement to try and understand, untangle or even quantitatively determine the various effects at play. Clearly, the amount of information required will depend on the type of analysis, and complexity of the problem. %DIF >  As a short-hand for this, the 
This concept is expanded below in terms of a fundamental 1D example (Sect. \ref{sec:1D-case}), and the discussion is extended to the more complex (higher dimensionality) case of the measurement of photoelectron angular distributions in the remainder of this section (Sect. \ref{sec:flux-intro}). An important caveat to this is that, for analysis or retrieval of phases, the measurements must have some degree of phase-sensitivity and coherence - this may be inherent to the observables or DOFs chosen, or imparted experimentally via  interferometric (coherent multi-path) schemes.
}

\DIFaddend \subsubsection{A brief discussion of rotation: 1D problems and beyond\DIFaddbegin \label{sec:1D-case}\DIFaddend }

A basic, traditional, example - at least for simple molecules - is the determination of bond lengths from LF measurements of rotational energy spectra. In this case, the intrinsic molecular properties (equilibrium bond lengths and geometry) map relatively cleanly to the observable energy levels\DIFdelbegin \DIFdel{, thus one can }\DIFdelend \DIFaddbegin \DIFadd{; one can thus }\DIFaddend uniquely determine the properties of interest via a suitable data analysis methodology (for a general introduction, see \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{hollasHighRes}). For instance, in the simplest case \DIFdelbegin \DIFdel{, a }\DIFdelend \DIFaddbegin \DIFadd{of a rigid }\DIFaddend homonuclear diatomic system, the problem can be regarded as 1-dimensional, with a single bond length to be determined from a 1D experimental measurement \DIFdelbegin \DIFdel{(the rotational energy spectrum) }\DIFdelend made in the LF. \DIFaddbegin \DIFadd{A measurement of the rotational energy spectrum is sufficient to provide bond-length information. }\DIFaddend In this case, there is no issue with orientational averaging, since the position of features in the energy spectrum \DIFdelbegin \DIFdel{- }\DIFdelend \DIFaddbegin \DIFadd{are invariant to orientation, although their magnitudes are not. 
(In a more precise description, the observed spectrum is }\DIFaddend determined by the (rotational) transition moments\DIFdelbegin \DIFdel{(}\DIFdelend \DIFaddbegin \DIFadd{, }\DIFaddend which are tied to the molecular symmetry axes\DIFdelbegin \DIFdel{) - are invariant to orientation, although their magnitudes (or, more precisely, their }\DIFdelend \DIFaddbegin \DIFadd{. The magnitudes are the }\DIFaddend projection into the LF \DIFdelbegin \DIFdel{) are not.}\DIFdelend \DIFaddbegin \DIFadd{of these transition moments, but their energy eigenstates are invariant to orientation; an angle-integrated measurement will thus provide a sufficient information content.)
}\DIFaddend In this case, the intrinsic molecular properties can therefore be mapped to the LF observable relatively clearly, and the retrieval of these properties from a measurement is similarly direct. However, for more complicated systems, additional information may be required, either in terms of a richer ND (N-dimensional) measurement technique and/or a series of simple measurements with different ``control" parameters\DIFaddbegin \DIFadd{, which are chosen to affect the observable but not the intrinsic molecular properties}\DIFaddend .

% For more complicated systems, additional information may be required, e.g.

More generally, one can regard a hierarchy of difficulty in the determination of molecular properties, based on the complexity or dimensionality of the system and observable(s).
\begin{itemize}
\item Simple systems, ``1D” methods, where a dataset of a single variable (e.g. rotational energy spectrum) is measured. For simple cases, e.g. rigid diatomic molecules, the determination of molecular properties - the rotational energy levels and, hence, the bond length - is relatively direct. (See, for example, Chpt. 5 in \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{hollasHighRes}.) % [Illustration?]   
\item Intermediate cases, e.g. larger, but fairly rigid, molecules (for instance, formaldehyde \DIFaddbegin \DIFadd{(}\DIFaddend $H_2CO$\DIFdelbegin \DIFdel{and aniline, }\DIFdelend \DIFaddbegin \DIFadd{) and aniline (}\DIFaddend $C_6NH_7$\DIFaddbegin \DIFadd{)}\DIFaddend , as discussed in \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{hollasHighRes}), possibly with congested spectra\DIFdelbegin \DIFdel{, }\DIFdelend \DIFaddbegin \DIFadd{. In such cases }\DIFaddend the ``direct” determination of molecular properties may not be possible without more sophisticated modelling and \DIFdelbegin \DIFdel{ab initio computations, and/or additional }\DIFdelend \DIFaddbegin \textit{\DIFadd{ab initio}} \DIFadd{computations. Additional }\DIFaddend information from higher-dimensionality observables\DIFdelbegin \DIFdel{(}\DIFdelend \DIFaddbegin \DIFadd{, }\DIFaddend e.g. polarization-dependent energy spectra\DIFdelbegin \DIFdel{)}\DIFdelend \DIFaddbegin \DIFadd{, may also be required}\DIFaddend . An interesting example, and relevant to latter discussion herein, is the use of rotational coherence spectroscopy (RCS) in such cases \cite{Felker1987} - this can be considered as the narrow-wavepacket limit of more general (non-adiabatic) rotational wavepacket based methods (Sect. \ref{sec:MF-control}).
% \textbf{I think RCS is also used for such systems. Should probably cite something from Fleker.}
\item For the most complex cases, e.g. large, floppy molecules or complexes \cite{bunkerMolSymm,schmiedt2015SymmetryExtremelyFloppy}, determination of molecular properties in an absolute sense may be impossible \DIFdelbegin \DIFdel{(}\DIFdelend or, rather, may be a poorly posed question \DIFdelbegin \DIFdel{); high }\DIFdelend \DIFaddbegin \DIFadd{since DOFs may become strongly coupled, and simplifying approximations such as fixed point-group symmetry and the BO separation break down \mbox{%DIFAUXCMD
\cite{bunkerMolSymm}}\hspace{0pt}%DIFAUXCMD
. High }\DIFaddend level computational results (if possible/tractable) may be required to understand the spectrum, and associated dynamics, along with multi-dimensional observables (e.g. temperature dependent spectra, dependence on isotopically-substituted species and so on). \DIFaddbegin \DIFadd{Such cases remain at the cutting-edge of research in molecular spectroscopy \mbox{%DIFAUXCMD
\cite{schmiedt2015SymmetryExtremelyFloppy}}\hspace{0pt}%DIFAUXCMD
.
}\DIFaddend \end{itemize}    

Whilst this discussion may seem a little arbitrary initially, \DIFaddbegin \DIFadd{aside from the general concepts, }\DIFaddend there is a strong link between traditional rotational spectroscopy and modern molecular alignment techniques (as will be discussed later\DIFdelbegin \DIFdel{), and }\DIFdelend \DIFaddbegin \DIFadd{, Sect. \ref{sec:MF-control}). Furthermore, control of the }\DIFaddend averaging over rotational (geometric) DOFs is \DIFaddbegin \DIFadd{a }\DIFaddend key to stepping into the MF in time-domain experiments.

\subsubsection{Photoelectron flux in the LF and MF\DIFaddbegin \label{sec:flux-intro}\DIFaddend }

A (generally) more complicated example is the topic of this article, i.e. the determination of MF photoelectron distributions, and the intrinsic molecular photoionization dynamics which underlie the observables.  The former may involve direct or indirect techniques; the latter is usually defined as the retrieval of the (complex valued) ionization dipole matrix elements, hence is indirect by definition (since phase information may not be directly measured). 
\DIFaddbegin 

\DIFadd{A broad conceptual overview for a time-dependent measurement scheme and associated observables is illustrated in Fig. \ref{781808}; although the figure shows a specific experimental scheme, the concepts are general. In this example - which forms the basis for the case study of Sect. \ref{sec:bootstrapping} - a multi-pulse experimental scheme is used to prepare an aligned molecular axis distribution, and AF photoionization measurements are made.
}

\DIFadd{The preparation (or pump) step in this case is impulsive molecular alignment, in which one or more laser pulses, of short duration as compared to
%DIF >  $\tau_{pulse}<<\tau_{rot}$, 
the characteristic rotational timescale, are used to create a rotational wavepacket in the system. The evolution of this wavepacket corresponds to different ensemble alignments (LF projections), as a function of time. A probe-pulse of similar pulse-duration, and with controllable time-delay $\Delta t$, can then probe specific alignments as a function of time. In general, pulses in the femto-second regime are suitable for this type of experimental scheme, and the technique is quite widely applicable; further discussion can be found in Sect. \ref{sec:MF-control}.
}

\DIFadd{The type of measurements shown are photoelectron images, which provide the angle and energy resolved photoelectron flux. Since the molecular axis distribution is time-dependent in this case,
%DIF > (the scheme illustrated is impulsive molecular alignment, which creates a time-dependent rotational wavepacket), 
a set of time-dependent measurements provide a set of observables with different spatial averaging at each measurement time $t$. These observables can be parameterised as a set of time-dependent parameters as shown in the lower right panel. }\DIFaddend The observables of interest - the photoelectron flux as a function of energy \DIFdelbegin \DIFdel{, ejection angle}\DIFdelend \DIFaddbegin \DIFadd{($\epsilon$), ejection angles ($\theta,\phi$)}\DIFaddend , and time \DIFaddbegin \DIFadd{($t$) }\DIFaddend - can be written generally as an expansion in spherical harmonics:

\begin{equation}
\bar{I}(\epsilon,t,\theta,\phi)=\sum_{L=0}^{2n}\sum_{M=-L}^{L}\bar{\beta}_{L,M}(\epsilon,t)Y_{L,M}(\theta,\phi)\label{eq:AF-PAD-general}
\end{equation}

Here the flux in the laboratory frame (LF) or aligned frame (AF) is denoted $\bar{I}(\epsilon,t,\theta,\phi)$, with the bar signifying ensemble averaging, and the molecular frame \DIFaddbegin \DIFadd{(MF) }\DIFaddend flux by $I(\epsilon,t,\theta,\phi)$.  Similarly, the expansion parameters $\bar{\beta}_{L,M}(\epsilon,t)$ include a bar for the LF/AF case. These observables are generally termed photoelectron angular distributions (PADs), often with a prefix denoting the reference frame, e.g. LFPADs, MFPADs, and the associated expansion parameters $\bar{\beta}_{L,M}(\epsilon,t)$ are generically termed ``anisotropy" parameters. The polar coordinate system $(\theta,\phi)$ is referenced to an experimentally-defined axis in the LF/AF case (usually defined by the laser polarization), and the molecular symmetry axis in the MF\DIFdelbegin \DIFdel{(see }\DIFdelend \DIFaddbegin \DIFadd{, as indicated in the corresponding panels of }\DIFaddend Fig. \ref{781808}\DIFdelbegin \DIFdel{). 
}\DIFdelend \DIFaddbegin \DIFadd{. 
%DIF >  The spherical harmonic rank and order $(L,M)$ are constrained by experimental factors in the LF/AF, and $n$ is typically limited by the molecular alignment (which is correlated with the photon-order for gas phase experiments), and can be considered in terms of conservation of total angular momentum in the LF more generally \cite{Yang1948}. In the MF $n$ is constrained only by the maximum continuum electron angular momentum $n=l_{max}$ imparted by the scattering event \cite{Dill1976}. 
%DIF >  VM: \textbf{Is the largest value of L necessarily even? I guess maybe so.} PH: yes, has to be from the 3js, i.e. always have Lmax = lmax + l'max = 2lmax.
}

\DIFaddend The spherical harmonic rank and order \DIFaddbegin \DIFadd{of the observables, }\DIFaddend $(L,M)$\DIFaddbegin \DIFadd{, }\DIFaddend are constrained by experimental factors in the LF/AF, and $n$ is \DIFdelbegin \DIFdel{effectively }\DIFdelend \DIFaddbegin \DIFadd{typically }\DIFaddend limited by the molecular alignment\DIFdelbegin \DIFdel{(}\DIFdelend \DIFaddbegin \DIFadd{, }\DIFaddend which is correlated with the photon-order for gas phase experiments\DIFdelbegin \DIFdel{, or conservation of }\DIFdelend \DIFaddbegin \DIFadd{. Generally, this can be considered in terms of conservation of total }\DIFaddend angular momentum in the LF \DIFdelbegin \DIFdel{more generally \mbox{%DIFAUXCMD
\cite{Yang1948}}\hspace{0pt}%DIFAUXCMD
), but in the MF is defined by the maximum continuum angular momentum$n=l_{max}$ imparted by the scattering event \mbox{%DIFAUXCMD
\cite{Dill1976}}\hspace{0pt}%DIFAUXCMD
. %DIF <  VM: \textbf{Is the largest value of L necessarily even? I guess maybe so.} PH: yes, has to be from the 3js, i.e. always have Lmax = lmax + l'max = 2lmax.
}%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{Yang1948}}\hspace{0pt}%DIFAUXCMD
, and each photon imparts one unit of angular momentum. }\DIFaddend For basic cases these limits may be low: for instance, a simple 1-photon photoionization event ($n=1$) from an isotropic ensemble (zero net ensemble angular momentum) defines $L_{max}=2$; for cylindrically \DIFaddbegin \DIFadd{or axially }\DIFaddend symmetric cases (i.e. $D_{\infty h}$ symmetry) $M=0$ only. 
\DIFdelbegin \DIFdel{For MF }\DIFdelend \DIFaddbegin 

\DIFadd{In the MF $n$ is constrained only by the maximum continuum electron angular momentum $n=l_{max}$ imparted by the scattering event \mbox{%DIFAUXCMD
\cite{Dill1976} }\hspace{0pt}%DIFAUXCMD
(note lower-case $l$ for the electron angular momentum). For these }\DIFaddend cases, $l_{max}=4$ is often given as a reasonable rule-of-thumb for the continuum - hence $L_{max}=8$ - although in practice higher-$l$ may be populated. \DIFdelbegin \DIFdel{For }\DIFdelend \DIFaddbegin \DIFadd{Further details are discussed below, with }\DIFaddend a realistic example \DIFdelbegin \DIFdel{see }\DIFdelend \DIFaddbegin \DIFadd{case forming the basis of }\DIFaddend Sect. \ref{sec:bootstrapping}\DIFdelbegin \DIFdel{, and ref. \mbox{%DIFAUXCMD
\cite{hockett2018QMP1} }\hspace{0pt}%DIFAUXCMD
for more discussion and complex examples }\DIFdelend . \DIFaddbegin \DIFadd{(For further introductory discussion and examples of LF and MF PADs, see Refs. \mbox{%DIFAUXCMD
\cite{Reid2003,hockett2018QMP1}}\hspace{0pt}%DIFAUXCMD
; a recent review article can be found in Ref. \mbox{%DIFAUXCMD
\cite{dowek2022TrendsAngleresolvedMolecular}}\hspace{0pt}%DIFAUXCMD
.)
}\DIFaddend 

\DIFdelbegin \DIFdel{A broad conceptual overview for a time-dependent measurement scheme and associated observables is illustrated in }\DIFdelend %DIF >  A broad conceptual overview for a time-dependent measurement scheme and associated observables is illustrated in Fig. \ref{781808}; although the figure shows a specific experimental scheme, the concepts are general. In this case - which forms the case study of Sect. \ref{sec:bootstrapping} - a multi-pulse experimental scheme is used to prepare an aligned molecular axis distribution
\DIFaddbegin 

\DIFadd{Returning to }\DIFaddend Fig. \ref{781808}\DIFdelbegin \DIFdel{; although the figure shows a specific experimental scheme, the concepts are general. Note}\DIFdelend \DIFaddbegin \DIFadd{, note}\DIFaddend , in particular that the LF measurements \DIFaddbegin \DIFadd{(top panel) }\DIFaddend involve averaging over an ensemble of molecules with different orientations, leading to averaging over the molecular frame observables\DIFdelbegin \DIFdel{, which are highly structured. Compare, in particular, the full MFPADs ($I(\theta,\phi)$ shown in the bottom left panel , with the relatively unstructured - but time-dependent - LFPADs ($\bar{I}(\theta,t)$)}\DIFdelend \DIFaddbegin \DIFadd{. The $\bar{\beta}_{L,M}(\epsilon,t)$ parameters in this case are }\DIFaddend shown in the \DIFdelbegin \DIFdel{bottom right panel. In this particular example, each }\DIFdelend \DIFaddbegin \DIFadd{lower right panel (and in more detail in Fig. \ref{720080}), and are constrained to $L_{max}=6$ and $M=0$ (cylindrical or axial symmetry). Two examples of the corresponding AFPADs $\bar{I}(\epsilon,t,\theta,\phi)$ are also shown, as simple polar plots, in the panel. These AFPADs display fairly simple, albeit }\DIFaddend time-dependent\DIFdelbegin \DIFdel{measurement involves averaging over a different alignment of the ensemble, and represent a rich dataset for retrieving matrix elements and reconstruction of the MFPADs.
}\DIFdelend \DIFaddbegin \DIFadd{, angular structure. 
%DIF >  The MF results (lower left panel) are highly structured: compare, in particular, the full MFPADs ($I(\theta,\phi)$ shown, with the relatively unstructured - but time-dependent - LFPADs ($\bar{I}(\theta,t)$) shown in the bottom right panel (see Fig. \ref{454268} for more detailed MFPADs). 
The corresponding MFPADs (lower left panel) are highly structured,  time-independent, quantities $I(\epsilon,\theta,\phi)$ in this case. The difference in the complexity of the MFPADs and AFPADs is typical of spatial averaging, and indicative of why one wishes to obtain MF results if possible. Crucially, these types of process are coherent, and the PADs are sensitive to the (relative) phases of the continuum electrons. PADs may also respond to other phase contributions depending on the type of experiment, for example the spatial averaging in an AF measurement is a coherent process.
%DIF >  (based on the rotational wavepacket created in the pump process).
}\DIFaddend In cases - such as this example - where the time-dependence is purely geometric, and is separable from the ionization matrix elements, the total information content can be broadly viewed as the number of sets of $\{L,M\}$ at a given $\epsilon$. 
\DIFaddbegin \DIFadd{This represents a rich dataset for retrieving matrix elements and reconstruction of the MFPADs, and this fairly general case is explored in detail herein (Sect. \ref{sec:MF-recon-basic-intro} introduces the concepts, and Sect. \ref{sec:bootstrapping} presents a full numerical case-study). 
}

%DIF >  In this particular example, each time-dependent measurement involves averaging over a different alignment of the ensemble, and this represents a rich dataset for retrieving matrix elements and reconstruction of the MFPADs (again, this is explored in detail in Sect. \ref{sec:bootstrapping}). 
%DIF >  In cases - such as this example - where the time-dependence is purely geometric, and is separable from the ionization matrix elements, the total information content can be broadly viewed as the number of sets of $\{L,M\}$ at a given $\epsilon$.
\DIFaddend 

% [Following is general-ish, but also quite similar to Sect. 4.1 - should make a more careful separation? Would make sense to have some key eqns. here, and elaborate in Sect. 4.]

% [\textbf{PH 27/07/22: tidied to here. TODO: combine the text below with Sect. 4.1, whole section as 3.4: Photoionization dynamics and retrieval. Also move final para up above, and link to dimensionality discussion.}]

% Underlying the observable is the photoelectron continuum wavefunction $\Psi_{e}(\boldsymbol{\mathbf{k}})$, prepared via photoionization, and assumed herein to be a 1-photon dipolar photoionization event. The photoelectron momentum vector is denoted generally by $\boldsymbol{\mathbf{k}}$, in the MF. %, which can be regarded as loosely interchangable with an $(\epsilon,\theta,\phi)$ spherical polar coordinate system in the MF. 
% The ionization matrix elements associated with this transition %\textbf{provide the set of quantum amplitudes} 
% provide the set of quantum amplitudes completely defining the final continuum scattering state,
% \begin{equation}
% \left|\Psi_c\right> = \sum{\int{\left|\Psi_{+};\bf{k}\right>\left<\Psi_{+};\mathbf{k}|\Psi_c\right> d\bf{k}}},
% \label{eq:cstate}
% \end{equation}
% % \textbf{where the sum is over states of the molecular ion $\left|\Psi_{+}\right>$. The number of these accessed depends on the nature of the ionizing pulse.} 
% where the sum is over states of the molecular ion $\left|\Psi_{+}\right>$. The number of these accessed depends on the nature of the ionizing pulse. Importantly, the observables are sensitive to the magnitudes and phases of these matrix elements. The ionization dipole matrix elements can be separated into radial (energy-dependent) and geometric (analytical) parts, and the former can be written generally as:

% \begin{equation}
% \left<\Psi_{+};\mathbf{k}|\Psi_c\right> \equiv r_{k,l,m}=\langle\Psi_{+};\,\psi_{l,m}(k)|\hat{\mathbf{\mu}}.\boldsymbol{\mathbf{E}}|\Psi_{i}\rangle
% \label{eq:r-kllam}
% \end{equation}

% Where the notation implies a perturbative photoionization event from an initial state $i$ to a particular ion plus electron state following absorption of a photon $h\nu$, % $|\Psi_{i}\rangle\stackrel{h\nu}{\rightarrow}|\Psi_{+};\,\Psi_{e}(\boldsymbol{\mathbf{k}})\rangle$, 
% $|\Psi_{i}\rangle+h\nu{\rightarrow}|\Psi_{+};\boldsymbol{\mathbf{k}}\rangle$, and the photoelectron wavefunction is expressed as a set of ``partial waves", with angular momentum components $(l,m)$ (note lower case notation for the partial wave components). Provided that the analytical solutions are known, knowledge of the radial matrix elements $r_{k,l,m}$ at a given $(\epsilon,t)$ thus equates to a full description of the system (and, hence, the observables). 
% %\textbf{The photoelectron angular distribution (PAD) at a given $(\epsilon,t)$ can then be determined by the squared projection of $\left|\Psi_c\right>$ onto a specific state $\left|\Psi_{+};\bf{k}\right>$, and therefore the amplitudes in Eq.~\ref{eq:r-kllam} which then also determine the observable anisotropy parameters $\beta_{L,M}(\epsilon,t)$. If a number of ionic states are accessed, each state is treated independently.}
% The photoelectron angular distribution (PAD) at a given $(\epsilon,t)$ can then be determined by the squared projection of $\left|\Psi_c\right>$ onto a specific state $\left|\Psi_{+};\bf{k}\right>$ (see Sect. \ref{sec:theoretical-techniques}), and therefore the amplitudes in Eq.~\ref{eq:r-kllam} which then also determine the observable anisotropy parameters $\beta_{L,M}(\epsilon,t)$. Typically, for reconstruction experiments, a given measurement will be selected to simplify this as much as possible by, e.g., populating only a single ionic state (or states for which the corresponding observables are experimentally energetically-resolvable), and with a bandwidth $d\bf{k}$ which is small enough such that the matrix elements can be assumed constant.
% % If a number of ionic states are accessed, each state is treated independently. [THIS IS MISLEADING, possibly - it's dependent on too many things!]
% %by knowledge of the anisotropy parameters $\beta_{L,M}(\epsilon,t)$, and does not necessarily require knowledge of the matrix elements.

% A broad conceptual overview for a time-dependent measurement scheme and associated observables is illustrated in Fig. \ref{781808}; although the figure shows a specific experimental scheme, the concepts are general. Note, in particular that the LF measurements involve averaging over an ensemble of molecules with different orientations, leading to averaging over the molecular frame observables, which are highly structured. Compare, in particular, the full MFPADs ($I(\theta,\phi)$ shown in the bottom left panel, with the relatively unstructured - but time-dependent - LFPADs ($\bar{I}(\theta,t)$) shown in the bottom right panel. In this particular example, each time-dependent measurement involves averaging over a different alignment of the ensemble, and represent a rich dataset for retrieving matrix elements and reconstruction of the MFPADs. In cases - such as this example - where the time-dependence is purely geometric, and is separable from the ionization matrix elements, the total information content can be broadly viewed as the number of sets of $\{L,M\}$ at a given $\epsilon$.

% The difficulty in reconstruction in general arises from the fact that there are typically many component partial waves (matrix elements) for even a simple system, and that determination of both magnitudes and phases is required. Hence this can be viewed as a form of quantum tomography, or a specific class of (quantum) phase-retrieval problems. In terms of the MF observable, these properties result in a quantity that may be highly structured and, hence, is (in general) particularly susceptible to orientational averaging. Furthermore, it may be particularly sensitive to averaging over other DOFs (e.g. vibronic states) and/or molecular dynamics, due to inherent sensitivity of the scattering process to molecular structure. Whilst a number of direct and indirect techniques have been used to obtain the relevant MF observables and/or dipole matrix elements, many outstanding questions remain, and this is an ongoing, interesting and challenging area of research \cite{hockett2018QuantumMetrologyPhotoelectrons,hockett2018QuantumMetrologyPhotoelectronsa}.

\subsection{Photoionization dynamics\label{sec:dynamics-intro}} 

% [Following is general-ish, but also quite similar to Sect. 4.1 - should make a more careful separation? Would make sense to have some key eqns. here, and elaborate in Sect. 4.]

% [\textbf{PH 27/07/22: tidied to here. TODO: combine the text below with Sect. 4.1, whole section as 3.4: Photoionization dynamics and retrieval. Also move final para up above, and link to dimensionality discussion.}]

% UPDATE: merge now in progress
% UPDATE: now done, aside from some tidy-up.

The core physics of photoionization has been covered extensively in the literature, and only a very brief overview is provided here with sufficient detail to introduce the MF reconstruction problem; the reader is referred to the literature listed in Appendix \ref{sec:theory-lit} for further details and general discussion. Technical details of the formalism applied for the reconstruction techniques discussed herein can be found in Sect. \ref{sec:tensor-formulation}.

% As already outlined in Sect. \ref{sec:Photo-into}, 
Photoionization can be described by the coupling of an initial state of the system to a particular final state (photoion(s) plus free photoelectron(s)), coupled by an electric field/photon. Very generically, this can be written as a matrix element $\langle\Psi_i|\hat{\Gamma}(\boldsymbol{\mathbf{E}})|\Psi_f\rangle$, where $\hat{\Gamma}(\boldsymbol{\mathbf{E}})$ defines the light-matter coupling operator (depending on the electric field $\boldsymbol{\mathbf{E}}$), and $\Psi_i$, $\Psi_f$ the total wavefunctions of the initial and final states respectively. 

There are many flavours of this fundamental light-matter interaction, depending on system and coupling; the discussion here is confined to the simplest case of single-photon absorption, in the weak field (or \DIFdelbegin \DIFdel{purturbative}\DIFdelend \DIFaddbegin \DIFadd{perturbative}\DIFaddend ), dipolar regime, resulting in a single photoelectron. (For more discussion of various approximations in photoionzation, see \DIFdelbegin \DIFdel{refs}\DIFdelend \DIFaddbegin \DIFadd{Refs}\DIFaddend . \cite{Seideman2002,Seideman2001}.)
% RENDERING ISSUES HERE? REFS in footnote seem to be this issue
% \footnote{For more discussion of these various approximations in photoionzation, see refs. [see raw tex]}  %\cite{Seideman2002,Seideman2001} . } 

% [29/07/22: the following still needs a bit of polishing for consistency in flow and notation]
% [TODO: notation may be improved above, as per below? Change i and c?]

Underlying the photoelecton observables is the photoelectron continuum state $\left|\mathbf{k}\right>$, prepared via photoionization.
% , and assumed herein to be a 1-photon dipolar photoionization event. 
The photoelectron momentum vector is denoted generally by $\boldsymbol{\mathbf{k}}=k\mathbf{\hat{k}}$, in the MF. %, which can be regarded as loosely interchangable with an $(\epsilon,\theta,\phi)$ spherical polar coordinate system in the MF. 
The ionization matrix elements associated with this transition %\textbf{provide the set of quantum amplitudes} 
provide the set of quantum amplitudes completely defining the final continuum scattering state,
\begin{equation}
\left|\Psi_f\right> = \sum{\int{\left|\Psi_{+};\bf{k}\right>\left<\Psi_{+};\mathbf{k}|\Psi_f\right> d\bf{k}}},
\label{eq:cstate}
\end{equation}
% \textbf{where the sum is over states of the molecular ion $\left|\Psi_{+}\right>$. The number of these accessed depends on the nature of the ionizing pulse.} 
where the sum is over states of the molecular ion $\left|\Psi_{+}\right>$. The number of ionic states accessed depends on the nature of the ionizing pulse and interaction. For the dipolar case,

\begin{equation}
\hat{\Gamma}(\boldsymbol{\mathbf{E}}) = \hat{\mathbf{\mu}}\DIFdelbegin \DIFdel{.}\DIFdelend \DIFaddbegin \DIFadd{\cdot}\DIFaddend \boldsymbol{\mathbf{E}}
\end{equation}

Hence,

\begin{equation}
\left<\Psi_{+};\mathbf{k}|\Psi_f\right> =\langle\Psi_{+};\,\mathbf{k}|\hat{\mathbf{\mu}}\DIFdelbegin \DIFdel{.}\DIFdelend \DIFaddbegin \DIFadd{\cdot}\DIFaddend \boldsymbol{\mathbf{E}}|\Psi_{i}\rangle
\label{eq:matE-dipole}
\end{equation}

Where the notation implies a perturbative photoionization event from an initial state $i$ to a particular ion plus electron state following absorption of a photon $h\nu$, % $|\Psi_{i}\rangle\stackrel{h\nu}{\rightarrow}|\Psi_{+};\,\Psi_{e}(\boldsymbol{\mathbf{k}})\rangle$, 
$|\Psi_{i}\rangle+h\nu{\rightarrow}|\Psi_{+};\boldsymbol{\mathbf{k}}\rangle$, and \DIFdelbegin \DIFdel{$\hat{\mu}.\boldsymbol{\mathbf{E}}$ }\DIFdelend \DIFaddbegin \DIFadd{$\hat{\mu}\cdot\boldsymbol{\mathbf{E}}$ }\DIFaddend is the usual dipole interaction term \cite{qOptics}, which includes a sum over all electrons $s$ defined in position space as $\mathbf{r_{s}}$:  
%[Gerry \& Knight - may be older/better refs for this, although G\&K is quite thorough?]

\begin{equation}
\hat{\mu}=-e\sum_{s}\mathbf{r_{s}}
\label{eq:dipole-operator}
\end{equation}

The position space photoelectron wavefunction is typically expressed in the ``partial waves" basis, expanded as (asymptotic) continuum \DIFdelbegin \DIFdel{eignstates }\DIFdelend \DIFaddbegin \DIFadd{eigenstates }\DIFaddend of orbital angular momentum, with angular momentum components $(l,m)$ (note lower case notation for the partial wave components),  

%DIF >  \begin{equation}
%DIF >  \Psi_\mathbf{k}(\bm{r})\equiv\left<\bm{r}|\mathbf{k}\right> = \sum_{lm}Y_{lm}(\mathbf{\hat{k}})\psi_{lm}(\bm{r},k)
%DIF >  \label{eq:elwf}
%DIF >  \end{equation}
\DIFaddbegin 

%DIF >  Replaced \bm with \mathbf, for Authorea compilation (doesn't like \bm!)
\DIFaddend \begin{equation}
\Psi_\mathbf{k}(\DIFdelbegin %DIFDELCMD < \bm{r}%%%
\DIFdelend \DIFaddbegin \DIFadd{\mathbf{r}}\DIFaddend )\equiv\left<\DIFdelbegin %DIFDELCMD < \bm{r}%%%
\DIFdelend \DIFaddbegin \DIFadd{\mathbf{r}}\DIFaddend |\mathbf{k}\right> = \sum_{lm}Y_{lm}(\mathbf{\hat{k}})\psi_{lm}(\DIFdelbegin %DIFDELCMD < \bm{r}%%%
\DIFdelend \DIFaddbegin \DIFadd{\mathbf{r}}\DIFaddend ,k)
\label{eq:elwf}
\end{equation}

where \DIFdelbegin \DIFdel{$\bm{r}$ }\DIFdelend \DIFaddbegin \DIFadd{$\mathbf{r}$ }\DIFaddend are MF electronic coordinates and $Y_{lm}(\mathbf{\hat{k}})$ are the spherical harmonics.
% \textbf{where $\mathbf{r}$ are MF electronic coordinates and $Y_{lm}(\mathbf{\hat{k}})$ are the spherical harmonics.} 

Similarly, the ionization dipole matrix elements can be separated generally into radial (energy-dependent or `dynamical' terms) and geometric (angular momentum) parts (this separation is essentially the Wigner-Eckart Theorem, see Ref. \cite{zareAngMom} for general discussion), and written generally as (using notation similar to \cite{Reid1991}): 

\begin{equation}
\langle\Psi_{+};\,\mathbf{k}|\hat{\mathbf{\mu}}\DIFdelbegin \DIFdel{.}\DIFdelend \DIFaddbegin \DIFadd{\cdot}\DIFaddend \boldsymbol{\mathbf{E}}|\Psi_{i}\rangle = \sum_{lm}\gamma_{l,m}\mathbf{r}_{k,l,m}
\label{eq:r-kllam}
\end{equation}


Provided that the geometric part of the matrix elements $\gamma_{l,m}$ \DIFdelbegin \DIFdel{- which includes the geometric rotations  into the LF arising from the dot product in Eq.~\ref{eq:r-kllam} and other angular-momentum coupling terms - are know}\DIFdelend \DIFaddbegin \DIFadd{are known}\DIFaddend , knowledge of the so-called radial (or reduced) dipole matrix elements, at a given 
% $(\epsilon,t)$ 
$k$\DIFaddbegin \DIFadd{, }\DIFaddend %(or $(k,t)$ for time-dependent cases) 
thus equates to a full description of the system \DIFaddbegin \DIFadd{photoionization }\DIFaddend dynamics (and, hence, the observables). \DIFaddbegin \DIFadd{The $\gamma_{l,m}$ includes the geometric rotations  into the LF arising from the dot product in Eqn.~\ref{eq:r-kllam}, as well as all other angular-momentum coupling terms.
}\DIFaddend 

% \textbf{Provided that the matrix elements of the geometric rotations into the LF arising from the dot product in Eq.~\ref{eq:r-kllam} are known, which they are typically by the Wigner-Ekart Theorem, knowledge of the so-called radial dipole matrix elements $\mathbf{r}_{k,l,m}=\int\psi_{lm}(\bm{r},k)\mathbf{\mu}\Psi_{i}(\bm{r})d\bm{r}$} at a given 
% $(\epsilon,t)$ 
% $k$ (or $(k,t)$ for time-dependent cases) thus equates to a full description of the system (and, hence, the observables).}

% PH 23/08/22: modified the above for generality. Wigner-Eckart is now mentioned above. Forgot to keep the old copy though, and I also don't want to ascribe much more that the geometric-radial separation to it, since most of the other geometric stuff requires additional derivations beyond just the separation into 3j + reduced mat element.


For the simplest treatment, the radial matrix element can be approximated as a 1-electron integral involving the initial electronic state (orbital), and final continuum photoelectron wavefunction:

%DIF >  \begin{equation}
%DIF >  \mathbf{r}_{k,l,m}=\int\psi_{lm}(\bm{r},k)\bm{r}\Psi_{i}(\bm{r})d\bm{r}
%DIF >  \label{eq:r-kllam-integral}
%DIF >  \end{equation}
\DIFaddbegin 

%DIF >  Replaced \bm with \mathbf, for Authorea compilation (doesn't like \bm!)
\DIFaddend \begin{equation}
\mathbf{r}_{k,l,m}=\int\psi_{lm}(\DIFdelbegin %DIFDELCMD < \bm{r}%%%
\DIFdelend \DIFaddbegin \DIFadd{\mathbf{r}}\DIFaddend ,k)\DIFdelbegin %DIFDELCMD < \bm{r}%%%
\DIFdelend \DIFaddbegin \DIFadd{\mathbf{r}}\DIFaddend \Psi_{i}(\DIFdelbegin %DIFDELCMD < \bm{r}%%%
\DIFdelend \DIFaddbegin \DIFadd{\mathbf{r}}\DIFaddend )d\DIFdelbegin %DIFDELCMD < \bm{r}
%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \DIFadd{\mathbf{r}
}\DIFaddend \label{eq:r-kllam-integral}
\end{equation}

As noted above, the geometric terms $\gamma_{l,m}$ are analytical functions which can be computed for a given case - minimally requiring knowledge of the molecular symmetry and polarization geometry, although other factors may also play a role (see Sect. \ref{sec:full-tensor-expansion} for details). 
% (These, again, follow from application of the Wigner-Eckart theorem, plus further algebraic manipulations.)
% and the former can be written generally as a (radial dipole) matrix element (using notation similar to \cite{Reid1991}):



%\textbf{The photoelectron angular distribution (PAD) at a given $(\epsilon,t)$ can then be determined by the squared projection of $\left|\Psi_c\right>$ onto a specific state $\left|\Psi_{+};\bf{k}\right>$, and therefore the amplitudes in Eq.~\ref{eq:r-kllam} which then also determine the observable anisotropy parameters $\beta_{L,M}(\epsilon,t)$. If a number of ionic states are accessed, each state is treated independently.}



The photoelectron angular distribution (PAD) at a given $(\epsilon,t)$ can then be determined by the squared projection of $\left|\Psi_f\right>$ onto a specific state $\left|\Psi_{+};\bf{k}\right>$ (see Sect. \ref{sec:theoretical-techniques}), and therefore the amplitudes in \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eq:r-kllam} also determine the observable anisotropy parameters $\beta_{L,M}(\epsilon,t)$ (Eqn. \ref{eq:AF-PAD-general}). (Note that the photoelectron energy $\epsilon$ and \DIFaddbegin \DIFadd{(scalar) }\DIFaddend momentum $k$ are used somewhat interchangeably herein, with the former usually preferred in reference to observables.) Note, also, that in the treatment above there is no time-dependence incorporated in the notation; however, a time-dependent treatment readily follows, and may be incorporated either as explicit time-dependent modulations in the expansion of the wavefunctions for a given case, or implicitly in the radial matrix elements. Examples of the former include \DIFdelbegin \DIFdel{, e.g. }\DIFdelend a rotational or vibrational wavepacket, or a time-dependent laser field. The rotational wavepacket case is discussed herein (see Sect. \ref{sec:full-tensor-expansion}). The radial matrix elements are a sensitive function of molecular geometry and electronic configuration in general, hence may be considered to be responsive to molecular dynamics, although they are formally time-independent in a Born-Oppenheimer basis\DIFdelbegin \DIFdel{- for }\DIFdelend \DIFaddbegin \DIFadd{. For }\DIFaddend further general discussion and examples see Ref. \cite{wu2011TimeresolvedPhotoelectronSpectroscopy}\DIFdelbegin \DIFdel{; discussions }\DIFdelend \DIFaddbegin \DIFadd{. Discussions }\DIFaddend of more complex cases with electronic and nuclear dynamics can be found in Refs.  \cite{arasaki2000ProbingWavepacketDynamics,Seideman2001, Suzuki2001,Stolow2008}.

Typically, for reconstruction experiments, a given measurement will be selected to simplify this as much as possible by, e.g., populating only a single ionic state (or states for which the corresponding observables are experimentally energetically-resolvable), and with a bandwidth $d\bf{k}$ which is small enough such that the matrix elements can be assumed constant. Importantly, the angle-resolved observables are sensitive to the magnitudes and (relative) phases of these matrix elements, and can be considered as angular interferograms (Fig. \ref{781808} top right).
% If a number of ionic states are accessed, each state is treated independently. [THIS IS MISLEADING, possibly - it's dependent on too many things!]
%by knowledge of the anisotropy parameters $\beta_{L,M}(\epsilon,t)$, and does not necessarily require knowledge of the matrix elements.


\subsection{MF photoionization measurements and matrix element retrieval: approaching the problem and accounting for complexity\label{sec:MF-recon-basic-intro}}

As discussed in Sect. \ref{sec:MF-intro}, MF observables may be sought via (1) direct or (2) indirect methods. Following Sect. \ref{sec:dynamics-intro} the difficulty of both methods may begin to become apparent - both require sophisticated measurements and data analysis, and the underlying photoionization dynamics may be very rich. For (1) the aim is to obtain highly-structured $\beta_{L,M}(\epsilon,t)$ from ``fixed-in-space" molecules, whilst for (2) sufficient measurements must be made to either reconstruct these observables and/or the underlying matrix elements from \DIFdelbegin \DIFdel{$\bar{\beta_{L,M}}(\epsilon,t)$ }\DIFdelend \DIFaddbegin \DIFadd{$\bar{\beta}_{L,M}(\epsilon,t)$ }\DIFaddend measurements. In both cases experimental measurements are designed, ideally, to avoid averaging over any correlated DOFs which map into the observables (or otherwise account for them in some manner) - specific methods are discussed further in Sect. \ref{sec:experimentalTechniques}.

For indirect methods, the MF observables and/or matrix elements are reconstructed or retrieved from the LF measurements, via inversion or fitting methodologies, and these techniques are the main focus of Sect. \ref{sec:Recon}. The difficulty in matrix element reconstruction in general arises from the fact that there are typically many component partial waves (matrix elements) for even a simple system, and that determination of both magnitudes and phases is required. Hence this can be viewed as a form of quantum tomography, or a specific class of (quantum) phase-retrieval problems. In terms of the MF observable, these properties result in a quantity that may be highly structured and, hence, is (in general) particularly susceptible to orientational averaging (Fig. \ref{781808}). Furthermore, it may be particularly sensitive to averaging over other DOFs (e.g. vibronic states) and/or molecular dynamics, due to inherent sensitivity of the scattering process to molecular structure. Whilst a number of direct and indirect techniques have been used to obtain the relevant MF observables and/or dipole matrix elements, many outstanding questions remain, and this is an ongoing, interesting and challenging area of research \cite{hockett2018QMP1, hockett2018QMP2}.

Although the core physics is complicated, relatively high-dimensionality observables are possible for photoelectron measurements (Sect. \ref{sec:info-content}), hence experimental progress can be made to understand these light-matter interactions. The PAD is the key observable, which may be measured in the LF or MF (see Sect. \ref{sec:Photo-into}), and additionally interrogated as a function of other experimental parameters: of particular interest (and readily amenable to experimental control) are the ionizing field properties (polarization, intensity, wavelength, duration), the axis distribution of the molecular ensemble in the LF (alignment), and orientation in the MF. 

As a reasonable first approximation, photoionization can be treated as a single active electron (SAE) problem, and one in which the remainder of the system is static during the photoionization process (impulsive, or sudden, approximation): this allows the problem to be defined in terms terms of three key components: 

\begin{enumerate}
\item the initial (ionizing) state (electronic) wavefunction $\Psi_i$ (and the final ion state is assumed to be identical in character, minus the ionizing electron $\Psi_+ = \Psi_i(N-1)$, hence the hole created has the same orbital structure as the ionizing electron),
\item the structure of the continuum (free electron) wavefunction 
\DIFdelbegin \DIFdel{$\Psi_{k}(\bm{r})$}\DIFdelend %DIF >  $\Psi_{k}(\bm{r})$,
\DIFaddbegin \DIFadd{$\Psi_{k}(\mathbf{r})$}\DIFaddend ,
\item the dipole matrix elements coupling these (single electron) wavefunctions.
\end{enumerate}

% The corresponding photoionization matrix elements can be written as: $\langle\psi_i|\hat{\mu}.\boldsymbol{\mathbf{E}}|\psi_f\rangle$, where the wavefunctions pertain to the active (ionized) electron, and $\hat{\mu}.E$ is the usual dipole term.

However, this problem still remains rather complicated (hence interesting), since the structure of the initial and continuum states depends sensitively on the molecular geometry (atomic positions and electron distribution, i.e. the full vibronic wavefunction) of the ionizing system. Nonetheless, significant progress can be made in both experimental analysis and \textit{ab initio} theory in this reduced case, and the approximations are valid for many interesting real cases (e.g. small, relatively rigid, polyatomics). Naturally, this zero-order treatment also provides a framework within which other effects can be recognised and understood, in terms of which physical assumptions are broken\DIFdelbegin \DIFdel{, and certain }\DIFdelend \DIFaddbegin \DIFadd{. Certain }\DIFaddend types of experiment may be sensitive to certain effects and DOFs - for instance, time-resolved observables may map the vibrational dependence, and pulse-intensity studies may indicate if and when the weak-field approximation breaks down.



% [Below needs finishing with a corresponding appendix, may move to Sect. 4?]

% Beyond the basic case, increasingly sophisticated experimental schemes are now routine for a number of labs \cite{Reid2012}, examples include: state-selected measurements; pump-probe schemes for time-resolved PADs (\cite{Seideman2002} [plus Wu, others?]); control schemes with shaped laser pulse(s), or multipulse schemes, controlling bound or continuum dynamics [Eliott refs, Baumert and related refs]; schemes coupling continuum states for energy-dependent phase measurements [rabbit refs.]; recoil frame (RF) and aligned frame (AF) measurements. These last cases are the focus herein, since they provide a relatively general route to MF observables and related properties.

\section{Concepts \& techniques\label{sec:Concepts}}

In this section a more detailed discussion of photoionization is provided, which underpins the quantum state and MF reconstruction presented in Sect. \ref{sec:Recon}.

% 27/07/22, PH - consolidating as new Sect. 3.4
% \subsection{Photoionization dynamics} 
% [ePSproc example walk-through? Or notebooks from QM book?]

% % \subsubsection{Overview}
% [This part overlaps with above a bit much, could also be repurposed as more general intro material?]
% The core physics of photoionization has been covered extensively in the literature (see Appendix \ref{sec:theory-lit}), and only a very brief overview is provided here with sufficient detail to define the MF reconstruction problem; the reader is referred to the literature listed at the end of this section for further details.

% As already outlined in Sect. \ref{sec:Photo-into}, photoionization can be described by the coupling of an initial state of the system to a particular final state (photoion(s) plus free photoelectron(s)), coupled by an electric field/photon. Very generically, this can be written as a matrix element $\langle\Psi_i|\hat{\Gamma}(\boldsymbol{\mathbf{E}})|\Psi_f\rangle$, where $\hat{\Gamma}(\boldsymbol{\mathbf{E}})$ defines the light-matter coupling operator (depending on the electric field $\boldsymbol{\mathbf{E}}$), and $\Psi_i$, $\Psi_f$ the total wavefunctions of the initial and final states respectively. 

% There are many flavours of this fundamental light-matter interaction, depending on system and coupling; the discussion here is confined initially to the simplest case of single-photon absorption, in the weak field (or purturbative), dipole regime, resulting in a single photoelectron.
% % RENDERING ISSUES HERE? REFS in footnote seem to be this issue
% % \footnote{For more discussion of these various approximations in photoionzation, see refs. [see raw tex]}  %\cite{Seideman2002,Seideman2001} . } 
% As a first approximation, this can usually be treated as a single active electron (SAE) problem, in which the remainder of the system is static during the photoionization process (impulsive, or sudden, approximation): this allows the problem to be defined in terms terms of three key components: (1) the initial (ionizing) state (electronic) wavefunction, (2) the structure of the continuum (free electron) wavefunction, (3) the dipole matrix elements coupling these (single electron) wavefunctions. The corresponding photoionization matrix elements can be written as: $\langle\psi_i|\hat{\mu}.\boldsymbol{\mathbf{E}}|\psi_f\rangle$, where the wavefunctions pertain to the active (ionized) electron, and $\hat{\mu}.E$ is the usual dipole term.

% However, this problem still remains rather complicated (hence interesting), since the structure of the initial and continuum states depends sensitively on the geometry (atomic positions and electron distribution, i.e. the full vibronic wavefunction) of the ionizing system. Nonetheless, significant progress can be made in both experimental analysis and \textit{ab initio} theory in this reduced case, and the approximations are valid for many interesting real cases (e.g. small, relatively rigid, polyatomics). Naturally, this zero-order treatment also provides a framework within which other effects can be recognised and understood, in terms of which physical assumptions are broken.

% Although the core physics is complicated, relatively high-dimensionality observables are possible for photoelectron measurements, hence experimental progress can be made to understand these light-matter interactions. The PAD is the key observable, which may be measured in the LF or MF (see Sect. \ref{sec:Photo-into}), and additionally interrogated as a function of other experimental parameters: of particular interest herein will be the electric field polarization, the axis distribution of the molecular ensemble in the LF (alignment), and orientation in the MF. 

% Beyond the basic case, increasingly sophisticated experimental schemes are now routine for a number of labs \cite{Reid2012}, examples include: state-selected measurements; pump-probe schemes for time-resolved PADs (\cite{Seideman2002} [plus Wu, others?]); control schemes with shaped laser pulse(s), or multipulse schemes, controlling bound or continuum dynamics [Eliott refs, Baumert and related refs]; schemes coupling continuum states for energy-dependent phase measurements [rabbit refs.]; recoil frame (RF) and aligned frame (AF) measurements. These last cases are the focus herein, since they provide a relatively general route to MF observables and related properties.

% [List of refs by topic here? Seems better than prose style, and can be correlated with Zotero lib. Now partially in Sect. \ref{sec:Appendix}]


\subsection{Experimental techniques\label{sec:experimentalTechniques}}

Following the above discussions, experimental methodologies for the determination of MF observables can be viewed from the perspective of direct and indirect techniques. 

In the direct case, access to the MF is sought via essentially one of two schemes:

\begin{enumerate}
\item Alignment/orientation of the molecular frame (Sect. \ref{sec:MF-control}).
\item Post-hoc reconstruction of the molecular frame from a suitable measurement (Sect. \ref{sec:fixed-in-space}).
\end{enumerate}

Indirect techniques are the main focus of this manuscript, and experimental implications are briefly introduced in Sect. \ref{sec:MF-recon-expt}.

% [UPDATE 24/08/22 - added Sect. \ref{sec:MF-recon-expt} on recon from experiments, hopefully doesn't repeat anything elsewhere.

% UPDATE 29/07/22 - this section now sub-divided and tidied up a bit, still needs some polishing and ref integration. For MF case now in appendix \ref{appendix:MF-expt}, but not so much for alignment, although partially covered in Sect. \ref{sec:CompleteLit}.]


\subsubsection{Molecular alignment and control: conforming the MF to the LF\label{sec:MF-control}}

The first category covers a range of techniques. For gas phase experiments, the most common methods involve creating some form of alignment or orientation \footnote{In the technical sense, alignment retains 
% \textbf{inversion symmetry in the LF, while orientation typically implies reduction of the LF symmetry to match the molecular point group symmetry}.
inversion symmetry in the LF, while orientation typically implies reduction of the LF symmetry to match the molecular point group symmetry. The term "orientation" is used herein as \DIFdelbegin \DIFdel{synonomous }\DIFdelend \DIFaddbegin \DIFadd{synonymous }\DIFaddend with the MF for an arbitrary molecular system, but in some cases - e.g. homonuclear diatomics - alignment may be sufficient for observation of MF observables.} 
in the gas phase molecular ensemble, which defines a relationship between the LF and MF. In general, measurements made from such an ensemble can be termed as corresponding to ``the aligned frame (AF)", and may still involve averaging over some DOFs; in the 
% \textbf{classical} 
classical limit of perfect orientation, the AF and MF are conformal/indistinguishable. 

Perhaps the simplest AF technique is the creation of alignment via a single-photon pump process (as used in many resonance-enhanced mulit-photon ionization (REMPI) type experimental schemes, which may even be rotational-state selected); in this case a parallel or perpendicular transition moment will create a $\cos^2(\theta)$ or $\sin^2(\theta)$ distribution, respectively, of the corresponding molecular axis. Any such axis distribution, in which there is a defined arrangement of axes created in the LF, can be discussed, and characterised, in terms of the axis distribution moments (ADMs)\DIFdelbegin \DIFdel{, typically expressed as an expansionin }\DIFdelend \DIFaddbegin \DIFadd{. ADMs are coefficients in a multipole expansion, in terms of }\DIFaddend Wigner D-Matrix Elements (see Sect. \ref{sec:full-tensor-expansion})\DIFaddbegin \DIFadd{, of the molecular axis probability distribution}\DIFaddend . These are spherical \DIFdelbegin \DIFdel{multipole tensors, and can be equivalently described by a density matrix }\DIFdelend \DIFaddbegin \DIFadd{tensors, equivalent to density matrix elements }\DIFaddend \cite{BlumDensityMat}. Many authors have address aspects of this problem in the past in frequency-domain work, see, for instance, the textbooks of Zare \cite{zareAngMom} and Blum \cite{BlumDensityMat}, treatments for various experimental cases in Refs. \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{Docker1988, Dubs1989, Greene1983}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{Docker1988,Dubs1989,Greene1983}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , and application in complete photoionization experiments in Refs. \cite{Leahy1991,hockett2009RotationallyResolvedPhotoelectron}.
% \textbf{Wigner D-Matrix Elements}.)

Further control can be gained via a single, or sequence of, N-photon transitions, or strong-field mediated techniques. Of the latter, adiabatic and non-adiabatic alignment methods are particularly powerful, and make use of a strong, slowly-varying or impulsive laser field respectively. (Here the ``slow" and ``impulsive" time-scales are defined in relation to molecular rotations, roughly on the ps time-scale, with ns and fs laser fields corresponding to the typical slow and fast control fields.) In the former case, the molecular axis, or axes, will gradually align along the electric-field vector(s) while the field is present\DIFdelbegin \DIFdel{; in the latter}\DIFdelend \DIFaddbegin \DIFadd{. In the latter, impulsive case, }\DIFaddend a broad rotational wavepacket (RWP) can be created, initiating complex rotational dynamics including field-free revivals of ensemble alignment. Both techniques are powerful, but multiple laser fields are typically required in order to control more than one molecular axis, leading to relatively complex experimental requirements. The absolute degree of alignment obtained in a given case is also dependent on a number of intrinsic and experimental properties, including the molecular polarisability 
% \textbf{and moment of inertia} 
and moment of inertia tensors, rotational temperature and separability of the rotational degrees of freedom from other DOFs (loosely speaking, this can be considered in terms of the stiffness of the molecule). \DIFaddbegin \DIFadd{Recent studies of molecules embedded in Helium droplets have addressed some of these issues, achieving stronger and longer lived 3D alignment. These studies also examined several complications associated with coupling between molecular and droplet DOFs.   }\DIFaddend Therefore, although general in principle, in practice not all molecular targets are amenable to ``good" (i.e. a high degree of) alignment. For more general details, see, for example, Refs. \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{ koch2019QuantumControlMolecular, Stapelfeldt2003}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{koch2019QuantumControlMolecular,Stapelfeldt2003,nielsen2022Helium}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , and for applications in photoionization see Sect. \ref{sec:theory-lit}.

Whilst gas phase alignment experiments can become rather complex, multi-pulse affairs, they are increasingly popular in the AMO community for a number of possible reasons\DIFdelbegin \DIFdel{- conceptually }\DIFdelend \DIFaddbegin \DIFadd{. Conceptually }\DIFaddend and experimentally, they are a relatively tractable extension to existing techniques\DIFdelbegin \DIFdel{, they }\DIFdelend \DIFaddbegin \DIFadd{. They }\DIFaddend are interesting experiments in their own right, and, practically, they are usually feasible with existing high-power pulsed laser sources in the ns to fs regime. Alignment \DIFdelbegin \DIFdel{techiques }\DIFdelend \DIFaddbegin \DIFadd{techniques }\DIFaddend have been combined with a range of different probes, including non-linear and high-harmonic optical probes, as well as photoionization-based methods - for recent reviews see \cite{hasegawa2015NonadiabaticMolecularAlignment,koch2019QuantumControlMolecular}. 

An alternative, very different, technique of orientational control is via embedding the target species in a matrix, or via deposition on a surface, which defines a spatial orientation. This approach has been taken primarily by the surface science community, and the required methods may often be readily applied to a range of targets using existing experimental apparatus and techniques (hence their ready adoption, analogous to the ready adoption of multi-pulse laser schemes in the gas phase community), combined with suitably-prepared surfaces. Although not the topic of this manuscript, there is certainly work in this vein conceptually related to the discussions herein, including ARPES (angle-resolved photoemission spectroscopy) and SERS (surface-enhanced, coherent anti-Stokes Raman scattering) studies. In these techniques, molecular orientation is well-defined, but at the expense of interactions with the bulk - although the latter may also be of interest and/or probed by the measurement. 
Examples include ARPES studies in which orbital densities of adsorbed species are reconstructed (``orbital tomography") \cite{Puschnig2009a,dauth2014AngleResolvedPhotoemission}, and SERS work making use of functionalised nano-particles for ``single molecule" fluorescence studies of vibrational wavepackets \cite{Yampolsky2014}. 
% [more to say on ARPES?] \textbf{ Don't know enough about this stuff, so will refrain from commenting.}

% [Anything on cold molecules?] \textbf{ I think the single sentence in 3.2 referring to the review article is sufficient. We can move it here if that works better.} Agreed!

% \textbf{I think an overview of retrieval using RWPs is appropriate here...Happy to write it if we agree.} - yes, maybe as a full subsubsection here?

% \subsubsection{Freely rotating molecules: MF via time evolution\label{sec:RWPs}}

% The efforts to align and orient molecules discussed in the previous sections necessarily led to detailed studies of the rotational dynamics of molecules after interaction with a non-resonant femtosecond laser pulse. A significant outcome of these studies has been the development of a reliable model capable of accurate simulations of rotational wavepacket dynamics that quantitatively agree with experimental results. By measurement of a signal from a time evolving rotational wavepacket, this ability to accurately simulate the wavepacket dynamics can be used to reconstruct the measured signal in the molecular frame. Since in this case the time resolved measurement constitutes a set of measurements of the same quantity from a variety of molecular axes distributions, it is reasonable to conclude that if the axes distributions are known, and provided a large enough space of orientations is explored by the molecule over the experimental time window, the molecular frame signal should be extractable. 

% This is relatively straight forward for a signal that is a single number in the MF for a given polarization of the light, such as the photoionisation yield. Such a signal may, in general, be expressed as an expansion,
% \begin{equation}
% S(\theta,\chi)=\sum_{jk}C_{jk}D^{j}_{0k}(\theta,\chi),
% \label{eq:mfrealsig}
% \end{equation}
% where $\theta$ and $\chi$ are the spherical polar and azimuthal angles of the linearly polarized electroic field vector generating the signal; $C_{jk}$ are unknown expansion coefficients; and $D^{j}_{0k}$ are the Wigner D-Matrix elements, a basis on the space of orientations. A time resolved measurement of $S$ from a rotational wavepacket is the quantum expectation value of this expression,
% \begin{equation}
% \langle S \rangle(t) = \sum_{jk}C_{jk}\langle D^{j}_{0k} \rangle (t).
% \end{equation}
% Since the rotational wavepacket can be accurately simulated, the $\langle D^{j}_{0k} \rangle (t)$ are considered known. The time resolved signal $\langle S \rangle(t)$ being measured, the unknown coefficients $C_{jk}$ can be determined by linear regression (albeit overdetermined), and the molecular frame signal in Eq.~\ref{re:mfrealsig} constructed. In this form the method was initially applied to strong field ionization and dubbed Orientation Reconstruction through Rotational Coherence Spectroscopy (ORRCS). It has since been applied to strong field ionization of various molecules, strong field dissociation and few-photon ionization.

% The case of PADs is a more challenging one, since they are not generally described by Eq.~\ref{eq:mfrealsig}. Instead, both LFPADs and MFPADs are determined by the radial dipole matrix elements as described above (\textbf{refer to section 3 here!}). The authors of this manuscript, with a number of collaborators, demonstrated that these matrix elements can also be retrieved for one-photon ionisation of N$_2$ by time resolved measurements of LFPADs from a rotational wavepacket. This method is focus of sections X and Y (\textbf{refer to apprpriate section(s)!}) below, with additional details and results provided on the case of radial matrix element extraction for N$_2$.   In follow up work, it was shown that for molecules with $D_{nh}$ point group symmetry the retrieval of the MFPAD is possible directly, bypassing the radial matrix elements. 



\subsubsection{Fixed-in-space molecules: MF via axis reconstruction\label{sec:fixed-in-space}}

The second category covers methodologies which make use of experimental information to reconstruct, post-facto, molecular alignment at the time of a light-matter interaction. This usually involves making a ``kinematically complete" class of measurement, which provides the full energy or momentum partitioning of the products of a light-matter interaction. In order for the alignment of a given axis to be defined in this case, there must be a clear energy partitioning defining it - typically dissociation is required, although some axes in a given problem may be inferred from related or proxy measurements. The simplest example is the dissociation of a diatomic molecule, in this case measuring the momentum of just one product atom/ion will enable the original orientation of the molecule to be determined 
% \textbf{provided the molecule does not rotate while dissociating}. 
provided the molecule does not rotate while dissociating (i.e. photodisociation is also sudden/impulsive, or equivalently geometrically-uncoupled - otherwise this remains a DOF to be averaged over, resulting in ``recoil-frame" (RF) measurements!). Combined with measurement of an electron, in coincidence, the MF photoelectron distribution can be recovered from a set of such measurements. Recent discussions and reviews of this area can be found in \DIFdelbegin \DIFdel{refs}\DIFdelend \DIFaddbegin \DIFadd{Refs}\DIFaddend . \cite{Yagishita2005,Reid2012,dowek2012PhotoionizationDynamicsPhotoemission,Yagishita2015,jahnke2022PhotoelectronDiffraction}, and some (representative) examples from the literature are given in Sect. \ref{appendix:MF-expt}.


Further extensions to such a measurement can probe additional dynamics in the MF, for instance electron-electron correlation effects in double ionization \cite{Akoury2007}. %or bond-length dependence of the observable when recoil energy of the ion is measured [ref. multiple early 2000 Dorner papers. \textbf{Also Dowek and Lucchese should be cited somewhere here.} ]. 
For larger molecules this becomes more complicated, and additionally requires that axial-recoil conditions are fulfilled (i.e. energy is not partitioned into other DOFs during dissociation). Such measurements are, therefore, well-suited to diatomics, and small polyatomics, and light-matter interactions involving core-ionization(s) events. For valence studies these techniques are less directly applicable, since dissociative events are less common (and may be slow/complex), although potentially can be applied in Coulomb-explosion imaging (CEI) type scenarios. In CEI methods, intense fields are used to strip multiple electrons from the target system, causing the molecule to (Coulombically) explode. Provided the intense pulse is short (relative to time-scales of atomic motion), measurement of multiple ionic fragments yields a map of the geometry of the system at the instant of the interaction \cite{stapelfeldt1998TimeresolvedCoulombExplosion,Underwood2015,Slater2015}. 

Another caveat for this class of measurement is the requirement for coincidence (or covariance) data collection, which typically limits count rates significantly, as well as the total number of products which may be feasibly measured - although the requirements may be somewhat relaxed for covariance studies. For these various reasons, amongst others, these experiments have typically been performed at \DIFdelbegin \DIFdel{synchrotons }\DIFdelend \DIFaddbegin \DIFadd{synchrotrons }\DIFaddend (and, recently, at FELs) with high repetition rates (high KHz, MHz) and at hard photon energies\DIFdelbegin \DIFdel{- although }\DIFdelend \DIFaddbegin \DIFadd{. However, }\DIFaddend laser-based experiments are also relatively common, particularly in the strong-field community, and may become more so as sources with high-repetition rates and high peak intensities become commercially available. 

Recent state-of-the-art MF measurements have successfully measured 4-fold coincidences, and 5-particle covariance maps, in order to map polyatomic molecules and vibrational dynamics\DIFdelbegin \DIFdel{; }\DIFdelend \DIFaddbegin \DIFadd{. }\DIFaddend %[Dorner and Boll refs]
\DIFdelbegin \DIFdel{for }\DIFdelend \DIFaddbegin \DIFadd{For }\DIFaddend a recent example, illustrating the power of such a technique for CEI imaging of iodopyridine and iodopyrazine, see Ref.   \cite{boll2022XrayMultiphotoninducedCoulomb}. However, to date these techniques have mainly been used as structural (nuclear) probes\DIFdelbegin \DIFdel{; in }\DIFdelend \DIFaddbegin \DIFadd{. In }\DIFaddend terms of MFPAD measurements, these techniques remain very challenging, since the CEI schemes required produce many secondary electrons which cannot typically be distinguished. 


% [somethign about detector tech...?][COLTRIMS \cite{Moshammer1996,Dorner1997a,Dorner2000}, x-ray diffraction] \cite{Akoury2007}

\subsubsection{Post-processing \& ``complete" photoionization studies: MF via reconstruction\label{sec:MF-recon-expt}}

% \textbf{[Added this section 23/08/22 to tie together experimental techniques with analysis - needs some work and refs still, bit generic at the moment]}

A significant issue with ``direct" experimental approaches to the MF is the difficulty of the measurement, and the degree of MF fidelity obtained, particularly in more complex systems. (Related to this is the issue of whether the free system is measured, or whether it is \DIFdelbegin \DIFdel{purturbed }\DIFdelend \DIFaddbegin \DIFadd{perturbed }\DIFaddend in some way, e.g. by an alignment laser field or a coupled system.) A complementary approach is to employ a post-processing approach in which underlying MF properties, possibly even the full set of photoionization matrix elements, are sought from LF or AF measurements, as already introduced in Sect. \ref{sec:MF-recon-basic-intro}. Such schemes are potentially demanding and complex in terms of the computational effort required to post-process the experimental data, but may also be significantly less demanding experimentally than direct MF measurements\DIFdelbegin \DIFdel{; such }\DIFdelend \DIFaddbegin \DIFadd{. Such }\DIFaddend schemes additionally have the potential to provide more fundamental information on photoionization dynamics.

Experimental techniques to generate suitable datasets for analysis are many and varied\DIFdelbegin \DIFdel{, and }\DIFdelend \DIFaddbegin \DIFadd{. These }\DIFaddend include the direct analysis of MF measurements to obtain the underlying photoionization dynamics, the use of \DIFdelbegin \DIFdel{frequency- resolved }\DIFdelend \DIFaddbegin \DIFadd{frequency-resolved }\DIFaddend methods, and the use of molecular alignment techniques. Some representative examples of such ``complete" photoionization studies from the literature are given in Sect. \ref{sec:CompleteLit}. %, and it is also of note that other fields have approached similar . 
The main focus of Sect. \ref{sec:Recon} is the analysis of time-resolved data from an aligned system with a prepared RWP, although retrieval from the MF is also investigated herein (Sect. \ref{sec:recon-from-MFPADs}). Whilst the RWP case is experimentally similar to the ``direct" MF measurement case outlined above, the requirements on the degree of alignment are much reduced, since the fidelity arises from the analysis, rather than the absolute maximum degree of alignment obtained. Specifically, the fidelity of the reconstruction can be considered as a result of the total information content of the time-domain measurement (related to the number of distinct molecular axis distributions probed), as distinct from the ``direct" case which is constrained by a single measurement at the best alignment or orientation obtained\DIFdelbegin \DIFdel{- in practice this }\DIFdelend \DIFaddbegin \DIFadd{. In practice this alignment }\DIFaddend needs to be extremely good to truly approach MF information in general, and this may not be possible in many cases\DIFdelbegin \DIFdel{; it }\DIFdelend \DIFaddbegin \DIFadd{. It }\DIFaddend will also be constrained in general by the symmetry of the problem. For an example case study, see Ref. \cite{reid2018AccessingMolecularFramea}, which suggests $\langle\cos^2(\theta)\rangle>0.9$ as a \textit{minimum} requirement, for measurements of relatively simple, cylindrically-symmetric, MFPADs; another illustrative example of the loss of information in the MF to LF transformation can be found in Ref. \cite{Underwood2000}.
%[Refs \cite{Underwood2000} plus Seidemann works and Reid gaussian wavepacket - could cite some specific numbers from these. Big RWP paper too?]
% (see Sect. \ref{sec:bootstrapping-info-sensitivity})

This implies that reconstruction methods may be rather more general, and the RWP case in particular is expected to be applicable to any molecular system, although outstanding questions on the required and obtainable information content remain (see Sect. \ref{sec:info-content}). Questions of fidelity of reconstruction are also a matter of ongoing research\DIFdelbegin \DIFdel{, since this }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend will, again, depend on both the type and nature of the experimental measurements, and the reconstruction methodology, both of which may involve or assume certain additional DOFs or physical behaviours which are required for tractable theory but may not hold in practice. Examples include cases with multiple conformers, floppy systems and the presence of additional (e.g. vibrational) dynamics. In all cases progress may be possible, but will require additional experimental and/or computational effort to control, isolate, simulate or reconstruct the additional DOFs. (See Ref. \cite{Takatsuka2000} for a ``basic" theoretical vibrational wavepacket example in $Na_2$, and for a more complex case in $CS_2$ Ref. \cite{wang2017MonitoringNonadiabaticDynamics}.)

A benchmark example is the retrieval of the photoionization dynamics of $N_2$, since this is a simple, fairly rigid, system amenable to experimental control ($NO$ has also been investigated by a number of authors, see Sect. \ref{sec:CompleteLit}). The authors of this manuscript, with a number of collaborators, demonstrated that photoionization matrix elements can be retrieved for one-photon ionisation of $N_2$ by time resolved measurements of LFPADs from a rotational wavepacket. The experiments did achieve a relatively high degree of alignment via a two-pulse pump scheme, with a maximum $\langle\cos^2(\theta)\rangle$ of $\sim 0.8$, and 11 temporal data-points (obtained over the half and full RWP revivals) were found to be sufficient for full matrix element retrieval and MFPAD reconstruction. This methodology, ``bootstrapping to the molecular frame", is the focus of Sect. \ref{sec:bootstrapping} below, with additional details and results provided for the case of radial matrix element extraction for N$_2$.  In follow up work, it was shown that for molecules with $D_{nh}$ point group symmetry the retrieval of the MFPAD is possible directly via a matrix inversion methodology, bypassing the difficulty of extracting the radial matrix elements, and this is discussed in Sect. \ref{sec:Matrix-inversion-example}.

% [TODO - also longer RWP section to be written? UPDATE: now Sect. \ref{sec:RWPs}, also moved above para from there.
% Also Appendix section?]



\subsubsection{Technology and outlook}

A final note on experimental methods is the possibilities afforded by technological (rather than conceptual) developments. Naturally, the techniques above rely on a certain degree of experimental and technological sophistication, and this, of course, generally increases over time as a technique matures and ``enabling" technologies develop. Examples, in this context, are the development of, and gradual improvements in, particle imaging detectors. Such progress allows for more sophisticated experiments with, e.g. multi-particle coincidence detection, higher detection rates, energy-multiplexed measurements and so on. In short, the experimental dimensionality or information content can be increased. For developing general methods, which can be applied in complex cases, this becomes increasingly important (as do related technological capabilities, such as data storage and processing, to handle the enhanced complexity). 

Historically, photoionization measurement capabilities have gone from 1D (flux) and 2D (flux and kinetic energy) in the early days, advanced to sequential or parallel measurements at different angles for various flavours of angle-resolved studies, and to full 3D or 4D capabilities in modern ``imaging" type systems (flux and 2D or 3D kinetic energy vector resolution)\DIFdelbegin \DIFdel{, with }\DIFdelend \DIFaddbegin \DIFadd{. This is expanded by }\DIFaddend the possibility of additional experimental measurement dimensions such as time, polarisation, laser power, wavelength and so forth. Advances in experimental methods, in particular the development of high count-rate 3D detectors, is ongoing (see, for examples and historical context, \cite{Parker1997,Dorner1997a,Continetti2001,Vallance2013,chandler2017PerspectiveAdvancedParticle}). 

As well as detector technology, general developments in experimental methods, system integration, computational power and so forth further enable novel techniques and/or fusion of existing methodologies. For instance, it is of note that with the advent of more sophisticated laser-based techniques, and short-pulse FELs, the combination of laser alignment techniques with dissociative photoionization measurements is also now increasingly common\DIFdelbegin \DIFdel{; other }\DIFdelend \DIFaddbegin \DIFadd{. Other }\DIFaddend examples include increasingly sophisticated multi-pulse measurements and measurements with shaped laser pulses. An illustrative example of the rich data available from a modern, sophisticated, experimental scheme - CEI with a pixel-imaging mass-spectroscopy (PImMS) camera and covariance analysis - see \cite{Slater2015}. Further examples of experimental developments from the literature, with respect to matrix element retrieval, can be found in Sect. \ref{sec:CompleteLit}.


% Integrate this part above?
% Beyond the basic case, increasingly sophisticated experimental schemes are now routine for a number of labs \cite{Reid2012}, examples include: state-selected measurements; pump-probe schemes for time-resolved PADs (\cite{Seideman2002} [plus Wu, others?]); control schemes with shaped laser pulse(s), or multipulse schemes, controlling bound or continuum dynamics [Eliott refs, Baumert and related refs]; schemes coupling continuum states for energy-dependent phase measurements [rabbit refs.]; recoil frame (RF) and aligned frame (AF) measurements. These last cases are the focus herein, since they provide a relatively general route to MF observables and related properties.



% LIST IN PROGRESS 03/09/21 
% NOTE: doesn't currently include any dynamical cases.
% TO CONSIDER: move to end as supplementals, and link to Zotero library for "ongoing" version?
% 09/09/21 now moved, use this style generally to allow organic growth... easy way to link it?

% ADDITIONAL MFPAD notes...
% Complete expts from MFPADS: \cite{Shigemasa1995,Cherepkov2000,Hikosaka2000,Yagishita2005}
% NOTES to add on RF vs. MF?
% \subsection{Theoretical techniques \& analysis methodologies\label{sec:theoretical-techniques}}

\subsection{Theoretical techniques\label{sec:theoretical-techniques}}

% To cover 

% \begin{itemize}
% \item Theory sophistication and availability
% \item Data analysis techniques
% \item Development of new formalism/theory, relation to phase retrieval problems, etc.
% \end{itemize}

\subsubsection{Tensor formulation of photoionization\label{sec:tensor-formulation}}

A number of authors have treated MFPADs and related problems, see Appendix \ref{sec:theory-lit} for some examples. Herein, a geometric tensor based formalism is developed, which is close in spirit to the treatments given by Underwood and co-workers \cite{Reid2000, Stolow2008, Underwood2000}, but further separates various sets of physical parameters into dedicated tensors\DIFdelbegin \DIFdel{; this }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend allows for a unified theoretical and numerical treatment, where the latter computes properties as tensor variables which can be further manipulated and investigated. %\footnote{It should be emphasized, however, that the underlying physical quantities are essentially identical in all these approaches, with a set of coupled angular-momenta defining the geometrical part of the photoionization problem, despite these differences in the details of the theory and notation. The current tensorial numerical implementation is in contradistinction to standard numerical routines in which the requisite terms are usually computed from vectorial and/or nested summations, which can be somewhat opaque to detailed interpretation, and typically implement the full computation of the observables in one computational routine. The main cost of a tensor-based approach is that more RAM is required to store the full set of tensor variables.} 
Furthermore, the tensors can readily be converted to a density matrix representation \cite{BlumDensityMat, zareAngMom}, which is more natural for some quantities, and also emphasizes the link to quantum state tomography and other quantum information techniques. Much of the theoretical background, as well as application to aspects of the current problem, can be found in the textbooks of Blum \cite{BlumDensityMat} and Zare \cite{zareAngMom}.

Within this treatment, the observables can be defined in a series of simplified forms, emphasizing the quantities of interest for a given problem. Some details are defined in the following subsections, and further detailed in Appendix \ref{appendix:formalism}.


\subsubsection{Channel functions\label{sec:channel-funcs}}

%DIF >  07/03/23 - added longer lead-in here, may also want to add notes on fitting?
A simple form of the equations, amenable to fitting, is to write the observables in terms of ``channel functions", which define the ionization continuum for a given case and set of parameters $u$ (e.g. defined for the MF, or defined for a specific experimental configuration)\DIFdelbegin \DIFdel{,
}\DIFdelend \DIFaddbegin \DIFadd{. Here we briefly introduce the notation, which expresses the observables $\beta_{L,M}^{u}$ (Eqn. \ref{eq:AF-PAD-general}) as a tensor product of channel functions ($\varUpsilon_{L,M}^{u,\zeta\zeta'}$), which collect all of the geometric parameters, and ionization matrix elements $\mathbb{I}^{\zeta\zeta'}$. At a basic level, the channel functions can be viewed simply as defining all of the analytical parameters in a given case; further theoretical details are unpacked below (Sect. \ref{sec:full-tensor-expansion} and Appendix \ref{appendix:formalism}), and specific cases in Sect. \ref{sec:bootstrapping-info-sensitivity}.
}

\DIFadd{Making use of the channel functions, the observables can be written as:
}\DIFaddend 

\begin{equation}
\beta_{L,M}^{u}=\sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbb{I}^{\zeta\zeta'}\label{eqn:channel-fns}
\end{equation}

% \sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbb{I}_{\zeta\zeta'}^{\Gamma,\Gamma'}=
% \equiv\sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbf{\rho}^{\zeta\zeta'}

\DIFdelbegin \DIFdel{Where }\DIFdelend \DIFaddbegin \DIFadd{where }\DIFaddend $\zeta,\zeta'$ collect all the required quantum numbers, and define all (coherent) pairs of components. The term $\mathbb{I}^{\zeta\zeta'}$ denotes the coherent square of the ionization matrix elements:

\begin{equation}
\mathbb{I}^{\zeta,\zeta}=I^{\zeta}(\epsilon)I^{\zeta'*}(\epsilon)
\label{eqn:I-zeta}
\end{equation}

This is effectively a convolution equation (cf. \DIFdelbegin \DIFdel{refs}\DIFdelend \DIFaddbegin \DIFadd{Refs}\DIFaddend . \cite{Reid2000,gregory2021MolecularFramePhotoelectron}) with channel functions, for a given ``experiment'' $u$, summed over all terms $\zeta,\zeta'$. Aside from the change in notation (which is here chosen to match the formalism of Refs. \cite{Gianturco1994, Lucchese1986, Natalense1999}), see also Sect. \ref{sec:mat-ele-conventions}), these matrix elements are essentially identical to the simplified (radial) forms $\mathbf{r}_{k,l,m}$ defined in Eqn. \ref{eq:r-kllam}, in the case where $\zeta=k,l,m$. These complex matrix elements can also be equivalently defined in a magnitude, phase form:

\begin{equation}
I^{\zeta}(\epsilon)\equiv\mathbf{r}_{\zeta}\equiv r_{\zeta}e^{i\phi_{\zeta}}
\end{equation}


This tensorial form is numerically implemented in the ePSproc codebase \cite{ePSprocGithub}\DIFdelbegin \DIFdel{, and }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend is in contradistinction to standard numerical routines in which the requisite terms are usually computed from vectorial and/or nested summations, \DIFdelbegin \DIFdel{which can be somewhat opaque to detailed interpretation, }\DIFdelend and typically implement the full computation of the observables in one computational routine. The \DIFaddbegin \DIFadd{standard approach can be somewhat opaque to detailed interpretation.  The }\DIFaddend PEMtk codebase \cite{hockett2021PEMtkGithub} implements matrix element retrieval based on this formalism, with pre-computation of all the geometric tensor components (channel functions) prior to a fitting protocol for matrix element analysis\DIFdelbegin \DIFdel{, }\DIFdelend \DIFaddbegin \DIFadd{. This is }\DIFaddend essentially a fit to Eqn. \ref{eqn:channel-fns} \DIFdelbegin \DIFdel{, with terms }\DIFdelend \DIFaddbegin \DIFadd{given a set of $\beta_{L,M}^{u}$, with }\DIFaddend $I^{\zeta}(\epsilon)$ as the unknowns (in magnitude, phase form). The main computational cost of a tensor-based approach is that more RAM is required to store the full set of tensor variables.

\subsubsection{Density matrix representation\label{sec:density-mat-basic}}
The density operator associated with the continuum state in \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eq:cstate} is easily written as $\hat{\rho}=|\Psi_c\rangle\langle\Psi_c|$. In the channel function basis, this leads to a density matrix given by the radial matrix elements:

\begin{equation}
\mathbf{\rho}^{\zeta\zeta'} = \mathbb{I}^{\zeta,\zeta'}
\label{eqn:radial-density-mat}
\end{equation}

Since the matrix elements characterise the scattering event, the density matrix provides an equivalent characterisation of the scattering event.
An example case is discussed in Sect. \ref{sec:den-mat-N2} (see Fig. \ref{998904}); for more details, and further discussion, see Sect. \ref{sec:density-mat-full}. Further discussion can also be found in the literature, see, e.g., Ref. \cite{BlumDensityMat} for general discussion, Ref. \cite{Reid1991} for application in pump-probe schemes.

% \textbf{I don't think I fully understand this section. In the partial wave basis, wouldn't the density operator be,}
% \begin{equation}
% \rho(t) =\sum_{LM}\sum_{KQS}A^{K}_{QS}(t)\sum_{\zeta\zeta^{\prime}}\Gamma^{\zeta\zeta^{\prime}LM}_{KQS}|\zeta,\Psi_+\rangle\langle\zeta,\Psi_+|\mu_q\rho_i\mu_{q\prime}^{*}|\zeta^{\prime},\Psi_+\rangle\langle\zeta^{\prime},\Psi_+|
% \end{equation}
% \textbf{with} $\rho_i = |\Psi_i\rangle\langle\Psi_i|$\textbf{ ? It's likely I'm not fully understanding the notation here, because I'm used the notation in MG 2021. Either way, maybe we don't need to include the density matrix version here? Eq.~\ref{eq:cstate} is intended to drive home the quantum tomography perspective.}\\
% Following the channel function notation, it is also trivial to write the radial matrix elements in density matrix form in the $\zeta\zeta'$ representation:

% \begin{equation}
% \mathbf{\rho}^{\zeta\zeta'} = |\zeta\rangle\langle\zeta'| \equiv \mathbb{I}^{\zeta,\zeta'}\label{eqn:radial-density-mat}
% \end{equation}

% And the full final continuum state as a density matrix in the $\zeta\zeta'$ representation (with the observable dimensions $L,M$ explicitly included in the density matrix), which will also be dependent on the choice of channel functions ($u$):

% \begin{equation}
% \mathbf{\rho}_{L,M}^{u,\zeta\zeta'}=\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbb{I}^{\zeta,\zeta'}
% \end{equation}

% Here the density matrix can be interpreted as the final, LF/AF or
% MF density matrix (depending on the channel functions used), incorporating both the intrinsic and extrinsic
% effects (i.e. all channel couplings and radial matrix elements for
% the given measurement), with dimensions dependent on the unique sets of quantum numbers required - in the simplest case, this will just be a set of partial waves $\zeta = (l,m)$. Note that this final state is distinct from the ``radial" density matrix (Eqn. \ref{eqn:radial-density-mat}), which encodes purely intrinsic (molecular scattering) photoionization dynamics. The $L,M$ notation indicates here that these dimensions should not be summed over, hence the tensor coupling into the $\beta_{L,M}^{u}$ parameters can also be written in terms of the density matrix:

% \begin{equation}
% \beta_{L,M}^{u}=\sum_{\zeta,\zeta'}\mathbf{\rho}_{L,M}^{u,\zeta\zeta'}
% \end{equation}

% In fact, this form arises naturally since the $\beta_{L,M}^{u}$ terms are the state multipoles (geometric tensors) defining the system, which can be thought of as a coupled basis equivalent of the density matrix representations (see, e.g., ref. \cite{BlumDensityMat}, Chpt. 4.).

% TODO: confirm notation here, may want to include more discussion from Blum? (See Fig. \ref{998904} for results, should also confirm representation here from outer product case, maybe plot LM representation too - see \href{https://epsproc.readthedocs.io/en/dev/methods/density_mat_notes_demo_300821.html}{ePSproc density matrix notes} esp. \href{https://epsproc.readthedocs.io/en/dev/methods/density_mat_notes_demo_300821.html#Density-matrix-from-geometric-tensors}{Density matrix from geometric tensors section}.)



\subsubsection{Full tensor expansion\label{sec:full-tensor-expansion}}

In more detail, the channel functions can be given as a set of tensors, defining each aspect of the problem.

For the MF:

\begin{eqnarray}
\beta_{L,-M}^{\mu_{i},\mu_{f}}(\epsilon) & = & (-1)^{M}\sum_{P,R',R}(2P+1)^{\frac{1}{2}}{E_{P-R}(\hat{e};\mu_{0})}\\
 & \times &\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}{\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')B_{L,-M}(l,l',m,m')}\\
 & \times & I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(\epsilon)\label{eq:BLM-tensor-MF}
\end{eqnarray}

And the LF/AF as:

\begin{eqnarray}
\bar{\beta}_{L,-M}^{\mu_{i},\mu_{f}}(E,t) & = & (-1)^{M}\sum_{P,R',R}{[P]^{\frac{1}{2}}}{E_{P-R}(\hat{e};\mu_{0})}\\
 & \times &\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}{\Lambda_{R'}(\mu,P,R')B_{L,S-R'}(l,l',m,m')}\\
 & \times &I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(\epsilon)\sum_{K,Q,S}\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)\label{eq:BLM-tensor-AF}
\end{eqnarray}

In both cases a set of geometric tensor terms are required, which are fully defined in Appendix \ref{appendix:formalism}; these terms provide details of:

\begin{itemize}
\item ${E_{P-R}(\hat{e};\mu_{0})}$: polarization geometry \& coupling with the electric field.
\item $B_{L,S-R'}(l,l',m,m')$: geometric coupling of the partial waves into the $\beta_{L,M}$ terms (spherical tensors).
\item $\Lambda_{R'}(\mu,P,R')$: frame couplings and rotations.
\item $\Delta_{L,M}(K,Q,S)$: alignment frame coupling.
\item $A_{Q,S}^{K}(t)$: ensemble alignment described as a set of axis distribution moments (ADMs).
\end{itemize}

And \(I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)\) are the (radial) dipole ionization matrix elements, as a function of energy \(\epsilon\). These matrix elements are essentially identical to the simplified forms $r_{k,l,m}$ defined in Eqn. \ref{eq:r-kllam}, except with additional indices to label symmetry and polarization components
defined by a set of partial-waves \(\{l,m\}\), for polarization component \(\mu\) (denoting the photon angular momentum components) and channels (symmetries) labelled by initial and final state indexes \({p_{i}\mu_{i},p_{f}\mu_{f}}\). The notation here follows that used by ePolyScat \cite{Gianturco1994, Lucchese1986, Natalense1999}, and these matrix elements again represent the quantities  to be obtained numerically from data analysis, or from an \href{https://epsproc.readthedocs.io/en/latest/ePS_ePSproc_tutorial/ePS_tutorial_080520.html\#Theoretical-background}{ePolyScat (or similar) calculation}. 

Note that, in this case as given, time-dependence arises purely from the \(A_{Q,S}^{K}(t)\) terms in the AF case, and the electric field term currently describes only the photon angular momentum coupling,
although can in principle also describe time-dependent/shaped fields. Similarly, a time-dependent initial state (e.g. a vibrational wavepacket) could also describe a time-dependent MF case.

It should be emphasized, however, that the underlying physical quantities are essentially identical in all the theoretical approaches, with a set of coupled angular-momenta defining the geometrical part of the photoionization problem, despite these differences in the details of the theory and notation. 




\subsubsection{Information content\label{sec:info-content}}

As discussed in \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{hockett2018QMP2}, the information content of a single observable might be regarded as simply the number of contributing $\beta_{L,M}$ parameters. In set notation:

\begin{equation}
M=\mathrm{n}\{\beta_{L,M}\}
\end{equation}

where $M$ is the information content of the measurement, defined
as $\mathrm{n}\{...\}$ the cardinality (number of elements) of the
set of contributing parameters. A set of measurements, made for some
experimental variable $u$, will then have a total information content:

\begin{equation}
M_{u}=\sum_{u}\mathrm{n}\{\beta_{L,M}^{u}\}
\end{equation}

In the case where a single measurement contains multiple $\beta_{L,M}$, e.g. as a function of energy $\epsilon$ or time $t$, the information content will naturally be larger:

%DIF >  06/03/23: tried to clarify (E,t) here a bit, may still need work.
\begin{eqnarray}
M\DIFdelbegin \DIFdel{_{u} }\DIFdelend \DIFaddbegin \DIFadd{_{u,\epsilon,t} }\DIFaddend & = & \sum\DIFdelbegin \DIFdel{_{u,k,t}}\DIFdelend \DIFaddbegin \DIFadd{_{u,\epsilon,t}}\DIFaddend \mathrm{n}\{\beta_{L,M}^{u}(\epsilon,t)\}\\
 & = & M_{u}\times M\DIFaddbegin \DIFadd{_{\epsilon,t}
}\DIFaddend \end{eqnarray}

where the second line pertains if each measurement has the same native
information content \DIFaddbegin \DIFadd{$M_{\epsilon,t}$ per energy and time point}\DIFaddend , independent of \DIFaddbegin \DIFadd{any other experimental parameters }\DIFaddend $u$. It may be that the variable
\DIFdelbegin \DIFdel{$k$ }\DIFdelend \DIFaddbegin \DIFadd{$\epsilon$ }\DIFaddend is continuous (e.g. photoelectron energy), but in practice it
will usually be discretized in some fashion by the measurement.

In terms of purely experimental methodologies, a larger $M_{u}$ clearly defines a richer experimental measurement which explores more of the total measurement space spanned by the full set of $\{\beta_{L,M}^{u}(k,t)\}$. However, in this basic definition a larger $M_{u}$ does not necessarily indicate a higher information content for quantum retrieval applications.
The reason for this is simply down to the complexity of the problem
(cf. Eqn. \ref{eqn:channel-fns}), in which many couplings define
the sensitivity of the observable to the underlying system properties
of interest. In this sense, more measurements, and larger $M$, may
only add redundancy, rather than new information.

A more complete accounting of information content would, therefore,
also include the channel couplings, i.e. sensitivity/dependence of the observable to a given system property, in some manner. For the case of a time-dependent measurement, arising from a rotational wavepacket, this can be written as:

\begin{equation}
M_{u}=\mathrm{n}\{\varUpsilon_{L,M}^{u}(\epsilon,t)\}
\end{equation}

In this case, each $(\epsilon,t)$ is treated as an independent measurement with unique information content, although there may be redundancy as a function of $t$ depending on the nature of the rotational wavepacket and channel functions\DIFdelbegin \DIFdel{- this }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend is explored further in Sect. \ref{sec:bootstrapping-info-sensitivity}. (Note this is in distinction to previously demonstrated cases where the time-dependence was created from a shaped laser-field, and was integrated over in the measurements, which provided a coherently-multiplexed case, see \DIFdelbegin \DIFdel{refs}\DIFdelend \DIFaddbegin \DIFadd{Refs}\DIFaddend . \cite{hockett2014CompletePhotoionizationExperiments, hockett2015CompletePhotoionizationExperiments,hockett2015CoherentControlPhotoelectron} for details.)




% [Formalism from 
% \href{https://epsproc.readthedocs.io/en/dev/methods/ePSproc_geom_methods_summary_190821-v1-tidy.html}{ePSproc notes}


% Also need to develop language a bit + radial matrix elements > Rlmlam form and tensor.

% Add appendix with definition of each tensor.]


\subsection{Retrieval \& reconstruction techniques\label{sec:recon-techniques-intro}}
% \& analysis methodologies

% Very generally, the problem of retrieval can be considered in terms of completeness, i.e. the degree to which the full quantum state of the system is know. In photoionization, ``complete" experiments, in which the full system wavefunction (matrix elements), denote the class of measurements in which full matrix element retrieval is the goal, as distinct from measurements which aim at specific observables
% This is currently briefly in Sect. 3.1, but probably should be expanded!

Following the tensor notation presented above, a ``complete" photoionization experiment can be characterized as recovery of the matrix elements $I^{\zeta}(\epsilon)$ from the experimental measurements or, equivalently, the density matrix $\mathbf{\rho}^{\zeta\zeta'}$. (For further discussion, see \DIFdelbegin \DIFdel{refs}\DIFdelend \DIFaddbegin \DIFadd{Refs}\DIFaddend . \cite{Reid2003,kleinpoppen2013perfect,hockett2018QMP1}.) This may be possible provided the channel functions are known, and the information content of the measurements is sufficient. (Note here that the matrix elements are assumed to be time-independent, although that may not be the case for the most complicated examples including vibronic dynamics \cite{hockett2018QMP2}.) 

Additionally, for schemes making use of molecular alignment, the molecular axis distributions must also be characterised. For the rotational wavepacket case, this is discussed in Sect. \ref{sec:RWPs}\DIFdelbegin \DIFdel{; this }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend can actually be considered as a reduced-dimensionality MF signal retrieval problem, and also forms the first step in both the generalised ``bootstrapping" method (Sect. \ref{sec:bootstrapping}) and matrix inversion techniques (Sect. \ref{sec:matrix-inv-intro}).

Of particular import for matrix element retrieval is the phase-sensitive nature of the observables, which is required in order to obtain partial wave phase information\DIFdelbegin \DIFdel{- hence }\DIFdelend \DIFaddbegin \DIFadd{. }\DIFaddend PADs can also be considered as angular interferograms, and reconstruction can be considered conceptually similar to other phase-retrieval problems, e.g. optical field recovery with techniques such as FROG \cite{trebino2000FrequencyResolvedOpticalGating}, and general quantum tomography \cite{MauroDAriano2003}. 



\subsubsection{Freely rotating molecules: MF via time evolution\label{sec:RWPs}}
% PH 22/08/22 - move this from 4.1.2 to 4.3.1, and added final paras to consolidate - may need some work still!

The efforts to align and orient molecules discussed in the previous sections necessarily led to detailed studies of the rotational dynamics of molecules after interaction with a non-resonant femtosecond laser pulse. A significant outcome of these studies has been the development of a reliable model capable of accurate simulations of rotational wavepacket dynamics that quantitatively agree with experimental results. By measurement of a signal from a time evolving rotational wavepacket, this ability to accurately simulate the wavepacket dynamics can be used to reconstruct the measured signal in the molecular frame. Since in this case the time resolved measurement constitutes a set of measurements of the same quantity from a variety of molecular axes distributions, it is reasonable to conclude that if the axes distributions are known, and provided a large enough space of orientations is explored by the molecule over the experimental time window, the molecular frame signal should be extractable. 

This is relatively straight forward for a signal that is a single number (scalar) in the MF for a given polarization of the light, such as the \DIFdelbegin \DIFdel{photoionisation }\DIFdelend \DIFaddbegin \DIFadd{photoionization }\DIFaddend yield. Such a signal may, in general, be expressed as an expansion,
\begin{equation}
S(\theta,\chi)=\sum_{jk}C_{jk}D^{j}_{0k}(\theta,\chi),
\label{eq:mfrealsig}
\end{equation}
where $\theta$ and $\chi$ are the \DIFaddbegin \DIFadd{MF }\DIFaddend spherical polar and azimuthal angles of the linearly polarized \DIFdelbegin \DIFdel{electroic }\DIFdelend \DIFaddbegin \DIFadd{electric }\DIFaddend field vector generating the signal; $C_{jk}$ are unknown expansion coefficients; and $D^{j}_{0k}$ are the Wigner D-Matrix elements, a basis on the space of orientations. A time resolved measurement of $S$ from a rotational wavepacket is the quantum expectation value of this expression,
\begin{equation}
\langle S \rangle(t) = \sum_{jk}C_{jk}\langle D^{j}_{0k} \rangle (t).
\label{eq:St-Cjk}
\end{equation}
Since the rotational wavepacket can be accurately simulated, the $\langle D^{j}_{0k} \rangle (t)$ are considered known. The time resolved signal $\langle S \rangle(t)$ being measured, the unknown coefficients $C_{jk}$ can be determined by linear regression\DIFdelbegin \DIFdel{(albeit overdetermined)}\DIFdelend , and the molecular frame signal in \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eq:mfrealsig} constructed. In this form the method was initially applied to strong field ionization and dubbed Orientation Reconstruction through Rotational Coherence Spectroscopy (ORRCS) \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{makhija2016ORRCS,wang2017ORRCS}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend .
It has since been applied to strong field ionization of various molecules \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{sandor2018ORRCS,sandor2019ORRCS,wangjam2021ORRCS}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend ,
strong field dissociation \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{lam2020ORRCS} 
}\hspace{0pt}%DIFAUXCMD
}\DIFaddend and few-photon ionization \DIFdelbegin \DIFdel{.
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{lam2022ORRCS}}\hspace{0pt}%DIFAUXCMD
. 
%DIF >  09/03/23: Added below for referee, where refs he2018RealTimeObservationMolecular, he2020MeasuringRotationalTemperature,wang2022RotationalEchoSpectroscopy were per referee recommendations.
(As hinted at in Sect. \ref{sec:MF-control}, a large range of other experimental methods have also addressed alignment and orientation dependence and retrieval, other recent examples include Coulomb-explosion imaging \mbox{%DIFAUXCMD
\cite{Underwood2015}}\hspace{0pt}%DIFAUXCMD
, high-harmonic spectroscopy \mbox{%DIFAUXCMD
\cite{he2018RealTimeObservationMolecular, he2020MeasuringRotationalTemperature}}\hspace{0pt}%DIFAUXCMD
, optical imaging \mbox{%DIFAUXCMD
\cite{Loriot2008} }\hspace{0pt}%DIFAUXCMD
and rotational echo spectroscopy \mbox{%DIFAUXCMD
\cite{wang2022RotationalEchoSpectroscopy}}\hspace{0pt}%DIFAUXCMD
, see Refs. \mbox{%DIFAUXCMD
\cite{Ramakrishna2013,koch2019QuantumControlMolecular} }\hspace{0pt}%DIFAUXCMD
for further discussion.)
}\DIFaddend 

% The case of PADs is a more challenging one, since they are not generally described by Eq.~\ref{eq:mfrealsig}. Instead, both LFPADs and MFPADs are determined by the radial dipole matrix elements as described above (\textbf{refer to section 3 here!}). The authors of this manuscript, with a number of collaborators, demonstrated that these matrix elements can also be retrieved for one-photon ionisation of N$_2$ by time resolved measurements of LFPADs from a rotational wavepacket. This method is focus of sections X and Y (\textbf{refer to apprpriate section(s)!}) below, with additional details and results provided on the case of radial matrix element extraction for N$_2$.   In follow up work, it was shown that for molecules with $D_{nh}$ point group symmetry the retrieval of the MFPAD is possible directly, bypassing the radial matrix elements. 

The case of PADs is a more challenging one, since they are not generally described by \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eq:mfrealsig}. Instead, both LFPADs and MFPADs are determined by the radial dipole matrix elements as described above (Sects. \ref{sec:dynamics-intro}, \ref{sec:channel-funcs}). However, the correspondence of the problem with an equation of the form of Eqn. \ref{eq:St-Cjk} - essentially a convolution - can be made. This is discussed in detail in Ref. \cite{Underwood2000}\DIFdelbegin \DIFdel{; in }\DIFdelend \DIFaddbegin \DIFadd{. In }\DIFaddend the current case Eqns. \ref{eqn:channel-fns}, \ref{eq:BLM-tensor-AF} can be rewritten in a similar form to Eqn. \ref{eq:St-Cjk} by explicitly separating out the axis distribution moments $A_{Q,S}^{K}(t)$ and collapsing all other terms. The case of photoionization from a time-dependent ensemble can then be \DIFdelbegin \DIFdel{reparametrized }\DIFdelend \DIFaddbegin \DIFadd{reparameterized }\DIFaddend as:
% (cf. also Eqn. \ref{eq:BLM-tensor-AF}):

% \begin{equation}
% \beta_{L,M}^{u}(t)=\sum_{K,Q,S}(\sum_{\zeta,\zeta'}\bar{\varUpsilon}_{L,M}^{u,\zeta\zeta'}\mathbb{I}^{\zeta\zeta'})A_{Q,S}^{K}(t)

% \label{eqn:beta-convolution}
% \end{equation}

% Where $\bar{\varUpsilon}$ is as per Eqn. \ref{eqn:channel-fns} except for the omission of the ADMs. 
% and the case of photoionization from a time-dependent ensemble can be reparametrized as:

\begin{equation}
\bar{\beta}_{L,M}^{u}(\epsilon,t)=\sum_{K,Q,S}\bar{C}_{KQS}^{LM}(\epsilon)A_{Q,S}^{K}(t)
\label{eqn:beta-convolution-C}
\end{equation}

% [NOTE: this now preempts the matrix inversion formalism, so may want to change this, or that, to avoid repetition] UPDATE - now fixed notation and refer to that eqn instead of duplicating.

Here the set of axis distribution moments can thus be viewed as modulating all observables $\beta_{L,M}^{u}(t)$\DIFdelbegin \DIFdel{; the unknowns}\DIFdelend \DIFaddbegin \DIFadd{. The unknowns, }\DIFaddend $\bar{C}_{KQS}^{LM}$ and axis distribution moments $A_{Q,S}^{K}(t)$, can be retrieved in a similar manner to that discussed for the simpler scalar observable case above, i.e. via linear regression with simulated rotational wavepackets. 

In practice this equates to (accurately) simulating rotational wavepackets, hence obtaining the corresponding $A_{Q,S}^{K}(t)$ parameters (expectation values), as a function of laser fluence and rotational temperature. Given experimental data, a 2D uncertainty (or error) surface in these two fundamental quantities can then be obtained from a linear regression for each set of $A_{Q,S}^{K}(t)$. The closest set of parameters to the experimental case is then determined by selection of the best results (smallest uncertainty) from such a parameter-space mapping, which constitutes determination of both the rotational \DIFdelbegin \DIFdel{wavepcket }\DIFdelend \DIFaddbegin \DIFadd{wavepacket }\DIFaddend (hence $A_{Q,S}^{K}(t)$) and $\bar{C}_{KQS}^{LM}(\epsilon)$\DIFdelbegin \DIFdel{; optimally}\DIFdelend \DIFaddbegin \DIFadd{. Optimally}\DIFaddend , the corresponding physical properties can be cross-checked with other experimental estimates for additional confirmation of the \DIFdelbegin \DIFdel{fiedelity }\DIFdelend \DIFaddbegin \DIFadd{fidelity }\DIFaddend of the protocol, although this may not always be possible. Note that, in this case, the photoionization dynamics are phenomenologically described by the real parameters $\bar{C}_{KQS}^{LM}$, but details of the matrix elements are not obtained directly; however, these parameters can be further used for the matrix inversion method (Sect. \ref{sec:matrix-inv-intro}), and are formally defined therein (Eqn. \ref{eq:C-AF}).

% 22/08/22 - removed this for now, but could incorporated into Sect 4.1.1
% The authors of this manuscript, with a number of collaborators, demonstrated that these matrix elements can also be retrieved for one-photon ionisation of N$_2$ by time resolved measurements of LFPADs from a rotational wavepacket. This method is focus of sections X and Y (\textbf{refer to apprpriate section(s)!}) below, with additional details and results provided on the case of radial matrix element extraction for N$_2$.   In follow up work, it was shown that for molecules with $D_{nh}$ point group symmetry the retrieval of the MFPAD is possible directly, bypassing the radial matrix elements. 





\subsubsection{Fitting methodologies\label{sec:fitting-intro}}

The nature of the photoionization problem suggests that a fitting approach can work, in general, which can be expressed (for example) in the standard way as a (non-linear) least-squares minimization problem:

\begin{equation}
\chi^{2}(\mathbb{I}^{\zeta\zeta'})=\sum_{u}\left[\beta^{u}_{L,M}(\epsilon,t;\mathbb{I}^{\zeta\zeta'})-\beta^{u}_{L,M}(\epsilon,t)\right]^{2}\label{eq:chi2-I}
\end{equation}

\DIFdelbegin \DIFdel{Where }\DIFdelend \DIFaddbegin \DIFadd{where }\DIFaddend $\beta^{u}_{L,M}(\epsilon,t;\mathbb{I}^{\zeta\zeta'})$ denotes  the values from a model function, computed for a given set of (complex) matrix elements $\mathbb{I}^{\zeta\zeta'}$, and $\beta^{u}_{L,M}(\epsilon,t)$ the experimentally-measured parameters, for a given configuration $u$. Implicit in the notation is that the matrix elements are independent of $u$ (or otherwise averaged over $u$). Once the matrix elements are obtained in this manner then MF observables, for any arbitrary $u$, can be calculated. An example of such a protocol - specifically one based on time-domain measurements and making use of a rotational wavepacket - is shown in Fig. \ref{781808}, %, as previously discussed, 
and the practical realisation of such a methodology is the topic of Sect. \ref{sec:bootstrapping} (see also \DIFdelbegin \DIFdel{refs. \mbox{%DIFAUXCMD
\cite{hockett2018QMP2, marceau2017MolecularFrameReconstruction} }\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{Refs. \mbox{%DIFAUXCMD
\cite{hockett2018QMP2,marceau2017MolecularFrameReconstruction} }\hspace{0pt}%DIFAUXCMD
}\DIFaddend for further discussion). As discussed in Sect. \ref{sec:MF-recon-expt}, other choices of experimental measurements may also be made, for instance direct MF measurements or frequency-domain measurements, some representative examples from the literature are given in Sect. \ref{sec:CompleteLit}. 
% [23/08/22 HERE - move to expt section? Also intro complete expts better elsewhere?]

Although in principle a very general approach, outstanding questions with such protocols remain, in particular fit uniqueness and reproducibility, the optimal measurement space $u$ - or associated information content $M_u$ - for any given case or measurement schema, and how well they will scale to larger problems (more matrix elements/partial waves). (Again, see \DIFdelbegin \DIFdel{refs. \mbox{%DIFAUXCMD
\cite{hockett2018QMP2, marceau2017MolecularFrameReconstruction} }\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{Refs. \mbox{%DIFAUXCMD
\cite{hockett2018QMP2,marceau2017MolecularFrameReconstruction} }\hspace{0pt}%DIFAUXCMD
}\DIFaddend for further discussion.)


\subsubsection{Matrix inversion methodologies\label{sec:matrix-inv-intro}}

An alternative methodology has recently been demonstrated, in which the MF observables are determined via a matrix inversion protocol \cite{gregory2021MolecularFramePhotoelectron}. This method does not require - potentially time-consuming - numerical fitting, although still requires knowledge of the channel functions. A full outline of the matrix inversion method is given in Appendix \ref{app:mat-inversion}, and a brief overview below.

For the matrix-inversion approach, the relationship between the LF/AF and MF is considered in terms of a matrix transform:

\begin{equation}
\mathbf{C}^{mol}=\mathbf{G}\mathbf{C}^{lab},\label{eq:basic}
\end{equation}

\DIFdelbegin \DIFdel{Where }\DIFdelend \DIFaddbegin \DIFadd{where }\DIFaddend $\mathbf{C}$ are a set of coefficients that can be used to construct the $\beta_{LM}$ in the LF and MF. Explicitly, 

%similar to the channel functions defined above, but \textit{without} the inclusion of alignment ($\mathbf{C}^{lab}$) or frame rotation effects ($\mathbf{C}^{mol}$), and will be termed herein as ``reduced" channel functions. The relevant parameters can be explicitly defined as:

\begin{equation}
C_{PR}^{LM}(\epsilon,\Delta q)=\sum_{\zeta\zeta'}\mathbb{I}^{\zeta\zeta'}(\epsilon)\Gamma_{PR\Delta q}^{\zeta\zeta'LM}
\end{equation}

for the MF ($\mathbf{C}^{mol}$), and:

\begin{equation}
\bar{C}_{KQS}^{LM}(\epsilon)=\sum_{\zeta\zeta'}\mathbb{I}^{\zeta\zeta'}(\epsilon)\Gamma_{KQS}^{\zeta\zeta'LM}
\label{eq:C-AF}
\end{equation}

for the LF ($\mathbf{C}^{lab}$). We refer to $\mathbf{\Gamma}$ as the ``reduced" channel functions - similar to the channel functions defined previously (Sect. \ref{sec:channel-funcs}), but \textit{without} the inclusion of alignment ($\mathbf{C}^{lab}$) or frame rotation effects ($\mathbf{C}^{mol}$). These are explicitly indexed by all required quantum numbers for the LF and MF definitions (as previously, $\zeta$ denotes all other required indices). Again, full details can be found in Appendix \ref{app:mat-inversion}. Given these, it can be shown for molecules with $D_{nh}$ point group symmetry that a transformation matrix can be written as:

\begin{equation}
\mathbf{G}_{L'M'KS}^{LMP\Delta q}=\mathbf{\Gamma}_{P0\Delta q}^{\zeta\zeta'LM}(\mathbf{\Gamma}_{K0S}^{\zeta\zeta'L^{\prime}M^{\prime}})^{+}
\label{eq:MPinversion}
\end{equation}

Here $()^{+}$ indicates the Moore-Penrose inverse matrix of a reduced channel function, which can be computed numerically. Significantly, the matrix elements are not required for inversion, provided that $\mathbf{C}^{lab}$ is known (e.g. from a measurement), and that the reduced channel functions are computed. Therefore, this method does not provide a route to reconstruction of a full set of matrix elements, but can be used to obtain MFPADs, and has been demonstrated to work for linear ($N_2$, $D_{\infty h}$ symmetry) and 
%\textbf{asymmetric top}
asymmetric top ($C_{2}H_{4}$, $D_{2h}$ symmetry) examples. Although not as powerful as a complete experiment methodology, this technique is expected to scale more readily to larger problems (more matrix elements), for which a complete matrix element retrieval via fitting may be impossible. 


\subsubsection{Numerical implementations\label{sec:numerics-intro}}

The numerical implementation of the methodologies defined above has been variously implemented in the past, including code in Fortran, C and Matlab, often for specific cases only. Recently a unified Python codebase/ecosystem/platform has been in development to tackle various aspects of photoionization problems, including \textit{ab initio} computations and experimental data handling, and (generalised) matrix element retrieval. The ``Quantum Metrology with Photoelectrons"  platform is briefly introduced here, and is used for the analysis in Sects. \ref{sec:bootstrapping} and \ref{sec:recon-from-MFPADs}. Fig. \ref{239231} shows some of the main tools and tasks/layers. 
% The main software components are detailed further below (see also Sects. \ref{sec:resources}, \ref{sec:numerical-notes}).

The two main components of the platform used herein are:
% (see also Sects. \ref{sec:resources} for more tools, and \ref{sec:numerical-notes} for additional implementation details):

\begin{itemize}
\item The Photoelectron Metrology Toolkit (PEMtk) codebase \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{hockett2021PEMtkDocs, hockett2021PEMtkGithub} }\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{hockett2021PEMtkDocs,hockett2021PEMtkGithub} }\hspace{0pt}%DIFAUXCMD
}\DIFaddend aims to provide various general data handling routines for photoionization problems. At the time of writing, simulation of observables and fitting routines are implemented, along with some basic utility functions. Further implementation details can be found in Sect. \ref{sec:numerical-notes}, and the \href{https://pemtk.readthedocs.io/en/latest/about.html}{PEMtk documentation} \cite{hockett2021PEMtkDocs}.
\item The ePSproc codebase \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{ePSprocAuthorea, ePSprocGithub, ePSprocDocs} }\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{ePSprocAuthorea,ePSprocGithub,ePSprocDocs} }\hspace{0pt}%DIFAUXCMD
}\DIFaddend aims to provide methods for post-processing with \textit{ab initio} radial dipole matrix elements from ePolyScat \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{Lucchese1986, Gianturco1994, Natalense1999, luccheseEPolyScatUserManual}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{Lucchese1986,Gianturco1994,Natalense1999,luccheseEPolyScatUserManual}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , or equivalent matrix elements from other sources, including computation of AF and MF observables. Manual computation without known matrix elements is also possible, e.g. for investigating limiting cases, or data analysis and fitting. These routines also provide the backend functionality for PEMtk fitting routines. See Sect. \ref{sec:numerical-notes} for additional notes.
\end{itemize}

Note that, at the time of writing, rotational wavepacket simulation is not yet implemented in the PEMtk suite, and these must be obtained via other codes. %The example wavepacket used in Sect. \ref{sec:bootstrapping}

A Docker-based distribution of various codes for tackling photoionization problems is also available from the \href{https://github.com/phockett/open-photoionization-docker-stacks}{Open Photoionization Docker Stacks} project, which aims to make a range of these tools more accessible to interested researchers \cite{hockettOpenPhotoionizationDocker}.



% Additional aspects of the platform:

% \begin{itemize}
% \item ePSdata \cite{hockett2019EPSDataPhotoionization}
% \end{itemize}



% The PEMtk python package [REF] currently implements the bootstrapping routines, and full computational notebooks, including source data and numerics, for these examples are available online [REFS]. The matrix inversion technique will be implemented soon, examples shown herein are reproduced from ref. \cite{gregory2021MolecularFramePhotoelectron}. It is hoped that interested readers will make use of these materials, and that this presentation will encourage other readers to try (and build upon) what has - up until quite recently - been a rather challenging and involved numerical analysis task.

% - General notes on fitting? Some already below, and may stay there.
% - Matrix inversion method overview?

\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/QM_unified_schema_wrapped_280820-gv.png}
\caption{Quantum metrology with photoelectrons platform outline.\label{239231}}
\end{center}
\end{figure}

\section{Reconstruction examples \& recent developments in time-domain measurements\label{sec:Recon}}

In this section/the remainder of the manuscript, reconstruction of MFPADs from time-domain measurements are considered using two methodologies:

\begin{enumerate}
\item ``Bootstrapping" to the MF \cite{hockett2018QMP1,hockett2018QMP2,marceau2017MolecularFrameReconstruction}. The protocol outline is shown in Fig. \ref{807606}, and discussed in Sect. \ref{sec:bootstrapping}.
\item Matrix reconstruction with Moore-Penrose inversion \cite{gregory2021MolecularFramePhotoelectron}. The protocol outline is shown in Fig. \ref{731792}, and discussed in Sect. \ref{sec:Matrix-inversion-example}.
\end{enumerate}

The techniques are closely related, and both make use of rotational wavepackets (geometrical coherences) to mediate the LF/AF information content of a set of measurements in the time-domain, but differ in the ``directness" of the reconstruction\DIFdelbegin \DIFdel{: in }\DIFdelend \DIFaddbegin \DIFadd{. In }\DIFaddend the former case, the aim is full matrix element retrieval (Sect. \ref{sec:bootstrap-fidelity}) or, equivalently, continuum density matrix reconstruction (Sect. \ref{sec:den-mat-N2}), and the MFPADs can then be computed from these ``complete" results (Sect. \ref{sec:bootstrap-MFPADs})\DIFdelbegin \DIFdel{; in the latter }\DIFdelend \DIFaddbegin \DIFadd{. In the latter case of matrix reconstruction }\DIFaddend the MFPADs are determined, essentially, via a transformation matrix (Sect. \ref{sec:Matrix-inversion-example}), and full matrix element retrieval is not necessary. The former is therefore a full quantum state retrieval or quantum tomography, whilst the latter represents a reconstruction of the MF observables which is more akin to classical tomographic methods, albeit with some phase information retained. %\cite{gregory2021MolecularFramePhotoelectron}. %[TBD-\textbf{This is a complicated discussion which we can have, or just cite}~\cite{gregory2021MolecularFramePhotoelectron}.\textbf{It's in there, and I'm not sure it will add much to this review.}]. UPDATE: now partly addressed in main sect.
However, the matrix reconstruction method does not require time-consuming data fitting, and should also scale more readily to larger systems (with some caveats), so should be advantageous in problems where only the MFPADs are sought.

Additionally, matrix element retrieval from MF observables is briefly addressed, the protocol is outlined in Fig. \ref{671760}, and discussed in Sect. \ref{sec:recon-from-MFPADs}. This protocol is essentially identical to the level 2 bootstrapping case, but with different geometric parameters and input dataset. This provides a route to quantum state reconstruction from direct MF measurements, \textit{or reconstructed MF observables}, hence provides a protocol which can be used to extend the matrix inversion method if desired, albeit with associated information content restrictions.

Finally, it is of note that the MF matrix element retrieval protocol of Fig. \ref{671760} is rather generic, and also forms the basis for other similar methods, e.g. cases where LF measurements are obtained as a function of polarization geometry. The difference in general is the exact form and information content of the input dataset, and the geometric parameters required for the given case (model).

% The PEMtk python package [REF] implements both routines [TODO], and full computational notebooks and numerics for these examples are available online [REFS].

The PEMtk python package \cite{hockett2021PEMtkDocs, hockett2021PEMtkGithub} currently implements the level 2 bootstrapping routines (Fig. \ref{807606}), and MF retrieval (Fig. \ref{671760}), and full computational notebooks, including source data and numerics, for these examples are available online \cite{hockett2022MFreconFigshare}. The matrix inversion technique will be implemented soon, examples shown herein are reproduced from \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{gregory2021MolecularFramePhotoelectron}. It is hoped that interested readers will make use of these materials, and that this presentation will encourage other readers to try (and build upon) what has - up until quite recently - been a rather challenging and involved numerical analysis task. A full list of resources is given in Sect. \ref{sec:resources}, and additional numerical notes in Sect. \ref{sec:numerical-notes}.

\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/bootstrap_flowchart_290822.gv.pdf}
\caption{Basic bootstrap protocol outline. (See also Fig. \ref{781808} .) Filled shapes indicate (upper) required inputs to the fitting stages (experimental measurements, trial ADMs, and geometric parameters), (lower) the final outputs (ADMs, matrix elements and MF observables).\label{807606}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/matrix_inversion_flowchart_300822.gv.pdf}
\caption{Matrix inversion protocol outline. Filled shapes indicate (upper) required inputs to the fitting stages (experimental measurements, trial ADMs, and geometric parameters), (lower) the final outputs (ADMs, and MF observables), matrix elements may also be obtained via further treatment of the MF observables (Sect. \ref{sec:recon-from-MFPADs} ).    Note that the ADM retrieval step is the same as the level 1 bootstrapping stage (Fig. \ref{807606} ).\label{731792}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/MF_fitting_flowchart_290822.gv.pdf}
\caption{MF matrix element retrieval protocol outline. Filled shapes indicate (upper) required inputs to the fitting stages (experimental measurements and geometric parameters), (lower) the final outputs (matrix elements).    Note that this is essentially identical to the level 2 bootstrapping protocol (Fig. \ref{807606} ), except with MF observables as the input. This can also be viewed as a generic model protocol, subject to the given set of measurements and associated channel functions.\label{671760}}
\end{center}
\end{figure}

\subsection{Bootstrapping to the MF example case\label{sec:bootstrapping}}

% [TODO: outline figure for methods]

The ``generalised bootstrapping" methodology proceeds via a multi-stage fitting protocol to obtain both the AF axis distribution (level 1 of the bootstrap, linear fit), and the photoionization matrix elements (level 2 of the bootstrap, non-linear fit). A general overview is given in Fig. \ref{781808}, and a more detailed schematic overview is given in Fig. \ref{807606}. In the simplest case (as illustrated), this proceeds in a direct manner, and a final set of results are obtained. However, further bootstrapping - in the statistical sense - can also be employed to probe the fidelity of the reconstruction with different samples from the source data (typically sub-sets from the measured time-steps and/or $\beta_{LM}$ parameter sub-sets), to further test the robustness of the results, and estimate uncertainties and/or improve upon them. Some of these possibilities are explored below, and further details may also be found in Refs. \cite{hockett2018QMP1,hockett2018QMP2,marceau2017MolecularFrameReconstruction} (and references therein).





\subsubsection{Bootstrapping basics: dataset and setup}

For the example case, synthetic data was used, although the dataset was inspired by \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{marceau2017MolecularFrameReconstruction}. In that case, experimental results were obtained via a (dual) pump-probe scheme, where the IR pump pulses prepared a rotational wavepacket in $N_2$, and a time-delayed XUV probe pulse ionized the sample - this scheme is illustrated in Fig. \ref{781808}. Multiple channels were probed in this manner, for a range of time-delays, to provide a dataset of AF-$\beta_{LM}(E,t)$ parameters. Here the focus is on the photoionization step, information content and further investigation of the retrieval routines; this is facilitated by the following choices and data:

\begin{enumerate}
\item The same rotational wavepacket \& molecular axis distribution as obtained experimentally is assumed. Consequently, the 1st (linear) stage of the bootstrapping protocol is not investigated herein. Although this may seem like a drastic omission, in general this stage of the methodology is expected to be quite robust, and this has been demonstrated in various investigations of rotational wavepackets and molecular alignment techniques, see discussion in Sect. \ref{sec:RWPs}.
% \footnote{Although this may seem like a drastic omission, in general this stage of the methodology is expected to be quite robust, and this has been demonstrated in various investigations of rotational wavepackets and molecular alignment techniques. [REFS]}
\item To simulate the observables, photoionization matrix elements from ePolyScat \cite{Lucchese1986, Gianturco1994, Natalense1999, luccheseEPolyScatUserManual} calculations were used. The calculations made use of $N_2$ electronic structure input, computed with Gamess \cite{gamess, Gordon} (RHF/MP2/6-311G, bond length $1.07$~\AA). In the example \DIFdelbegin \DIFdel{illustated }\DIFdelend \DIFaddbegin \DIFadd{illustrated }\DIFaddend herein, matrix elements for $E_{ke}=1~eV$ were used, and are given explicitly in Table \ref{tab:inputMatE}. This, naturally, also provides a means for direct comparison and fidelity analysis of the retrieval protocol (Sect. \ref{sec:bootstrap-fidelity}); the density matrix can also be used for analysis (Sect. \ref{sec:den-mat-N2}). In the current study only ionization of the $3\sigma_g$ orbital (HOMO) is investigated, corresponding to formation of  $X^2\Sigma_{g}^{+}$ ionic ground-state, i.e. $N_2(X^{1}\Sigma^{+}_{g}) \rightarrow N^+_2(X^{2}\Sigma^{+}_{g})$, generically denoted as the $X$-channel, or via the ionizing orbital as $N_2(3\sigma_g^{-1})$, for a more compact notation. 
\item To investigate limitations of the numerical routines, noise and other \DIFdelbegin \DIFdel{artiefacts }\DIFdelend \DIFaddbegin \DIFadd{artifacts }\DIFaddend can be added to the simulated data\DIFdelbegin \DIFdel{; different }\DIFdelend \DIFaddbegin \DIFadd{. Different }\DIFaddend sub-sets of the data can also be readily analysed and compared.
\item Finally, it is of note that the numerical implementations are structured as a set of tensors, as close as possible to the formalism given above (Sect. \ref{sec:tensor-formulation}). This provides a means to further investigate the information content of various parts of the problem, and investigate their influence on the retrieval\DIFdelbegin \DIFdel{- in }\DIFdelend \DIFaddbegin \DIFadd{. In }\DIFaddend particular, these can indicate aspects of the data which may be most sensitive to particular matrix elements, most susceptible to noise and so forth. This is explored in Sect. \ref{sec:bootstrapping-info-sensitivity}
% The numerics are currently implemented using the Xarray python library [REFS].
\end{enumerate}

The sample dataset used for the results presented herein is illustrated in Figure \ref{720080} and, as mentioned previously, full numerical data can be accessed online (Sect. \ref{sec:resources}). In this case only a 1~ps subset of the simulation data was used, over the main revival feature. Figure \ref{720080} shows both the full simulation results and the sub-selected points (13 data points) with random noise added (up to 10\%), the latter is used as the input dataset for matrix element retrieval in the following sections. % [May want to show more simulated data here? DONE]




\begin{figure}[]
\begin{center}
\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_data4up_290722_11-00-33.png}
%DIFDELCMD < %%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_data4up_090323_19-37-14.png}
\DIFaddendFL \caption{Simulated data for N2: (Upper pair) (a) Axis distribution moments (ADMs, \(A^{K}_{Q,S}(t)\) ) and (b) corresponding axis distribution maps \(P(\theta, t)\) . (Lower pair) (c) Calculated observables, \(\beta_{L,M}\) parameters (solid lines) and sub-selected data points (dashed lines) with random noise added (up to 10\%) as used for the reconstruction protocol, (d)  full theoretical \(I(\theta,t)\) maps (ideal case with no added noise).\label{720080}}
\end{center}
\end{figure}



\begin{figure}[]
\begin{center}
\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_fitHistPlot_290722_11-26-28.png}
%DIFDELCMD < %%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_fitHistPlot_100323_10-07-34.png}
\DIFaddendFL \caption{Sample results from 1000 fits with noisy data, showing all fits with \(\bar{\chi}^2 < 2.4\times10^{-4}\) .\label{509194}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_paramsViolin_290722_11-11-15.png}
%DIFDELCMD < %%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_paramsViolin_090323_19-37-49.png}
\DIFaddendFL \caption{Statistics for the 349 best fit results ( \(\bar{\chi}^2 < 2.3 \times 10^{-4}\) ). Plots show magnitudes (top) and phase (bottom) parameters, labelled by \((l,m)\) , with spread proportional to the number of results and colour-mapped by \(\bar{\chi}^2\) . Note the clustering by \(\bar{\chi}^2\) , where each cluster constitutes a viable set of matrix elements (particularly in \(\phi_{3,\pm1}\) terms) , and the lack of variation for \(\phi_{1,-1}\) , which was fixed as a reference.\label{494229}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_BLM_allFits_150422.png}
%DIFDELCMD < %%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_BLMdataAgg_090323_19-42-12.png}
\DIFaddendFL \caption{Best fit results (minimum \(\bar{\chi}^2\) only) with uncertainty estimation. Plots show original simulation (solid lines), simulation with noise used for fitting (dashed lines with `+' markers) and mean values \(\pm1\sigma\) (filled bands). Note that (spurious) \(\beta_{3,0}\) data is present in the input noisy data, but not in the outputs, as defined by symmetry.\label{743962}}
\end{center}
\end{figure}

\subsubsection{Bootstrapping basics: fit setup}

To fit the simulated data, a set of fitting parameters were defined in (magnitude, phase) form. In this case, the parameter set was simply defined from the input matrix elements, resulting in 6 complex radial matrix elements defining the problem\DIFdelbegin \DIFdel{(this }\DIFdelend \DIFaddbegin \DIFadd{. This }\DIFaddend equates to $2n$ parameters to determine in magnitude-phase form, or, if only relative phases are to be obtained, $2n-1$ parameters, where the remaining phase is defined as a reference, either pre or post fit\DIFdelbegin \DIFdel{; similarly}\DIFdelend \DIFaddbegin \DIFadd{. Similarly}\DIFaddend , if only relative magnitudes are obtained, the total number of parameters is reduced to $2n-2$\DIFdelbegin \DIFdel{); in }\DIFdelend \DIFaddbegin \DIFadd{. In }\DIFaddend general this step in the protocol may require manual configuration for the problem at hand, based on the symmetry of the system. The input matrix elements are listed in Table \ref{tab:inputMatE}\DIFdelbegin \DIFdel{; of }\DIFdelend \DIFaddbegin \DIFadd{. Of }\DIFaddend particular note in this case is that only $l=1,3$ partial-waves are present, and the two continuum symmetries - $\sigma_u$ and $\pi_u$ - which correlate with $m=0$ and $m=\pm1$ respectively, and correspond to parallel and perpendicular polarization geometries in the molecular frame. Furthermore, the $m=\pm1$ pairs are identical in this case. Because the $l,\pm m$ indices are unique\DIFdelbegin \DIFdel{in this case}\DIFdelend , they will be used generally as short-hand labels for the matrix elements, e.g. $|1,\pm1\rangle$ corresponds to the $|\zeta\rangle = |\pi_u,1,\pm 1,\mp 1 \rangle$ continuum component (full matrix element), and $\phi_{1,\pm1}$ corresponds to the phase of this component.

% The PEMtk fitting matrix element fitting routine makes use of the lmfit package [REF, https://lmfit.github.io/lmfit-py/, https://dx.doi.org/10.5281/zenodo.11813], which implements a range of fitting routines and options. 
In the current demonstration case:

\begin{itemize}
\item A standard Levenberg-Marquardt least-squares minimization was used.
\item 11 of the 12 parameters were allowed to float freely (i.e. no symmetry relations were imposed a priori), with phases bounded to $-\pi\leq\phi\leq\pi$. % [TODO: confirm].
\item $\phi_{1,-1}$ was set as a reference phase. 
\item To gain insight into the efficiency of the fitting routine, the validity of the methodology and the uniqueness of the fit results (Sect. \ref{sec:bootstrap-fidelity}), 1000 fits were performed on the same dataset, each seeded with randomised parameter values. 
\item Convergence criteria were set as a minimum gradient reduction of $1\times10^{-8}$, % [TODO: check this], 
but fits were also capped by the total number of function evaluations\DIFdelbegin \DIFdel{- whilst }\DIFdelend \DIFaddbegin \DIFadd{. Whilst }\DIFaddend this prevents run-away cases, it also constitutes a second convergence criteria.
\item Results herein are categorized by reduced $\bar{\chi}^2$ values ($\bar{\chi}^2=\chi^2/(N-N_{vars})$, where $N$ is the number of data points, and $N_{vars}$ the number of parameters) unless otherwise noted.
\item Further details of the codebase and numerical implementation can be found in Sect. \ref{sec:numerical-notes}.
\end{itemize}

This methodology amounts to a statistical sampling of the solution hyperspace, which may be expected to contain some local minima in general high-dimensional cases.  Running in parallel on 20 (logical) cores of an AMD Threadripper 2950X based workstation, this required ~5GB of RAM and took on the order of 2 hours (note that the time per fit cycle had large variance, since convergence time depends on the start parameters); further benchmarks for the current codebase can be found in \href{https://pemtk.readthedocs.io/en/latest/index.html}{the PEMtk documentation} \cite{hockett2021PEMtkDocs}.

% TODO: add table of results and remap param names back to QNs.

\subsubsection{Bootstrapping basics: fit results}

Results are summarised broadly in Fig. \ref{509194}, which shows the best fit results over the fits. A few (tentative) conclusions can be quickly drawn from this:

\begin{enumerate}
\item The results appear to indicate a well-defined, single global minima was found, with $\bar{\chi}^2 = 2.291\times10^{-3}$, and 203 fits (20\%) obtained this value.
\item There are additional close-lying bands with $\bar{\chi}^2 < 2.3\times10^{-3}$. In the test case, 349 fits (35\%) obtained this region of the fitting space. These results may be due to local minima, or simply fits which didn't quite converge for numerical reasons (e.g. reached the upper limit of iterations in fitting protocol); further exploration to identify whether these sub-sets of parameters are significantly different is therefore required.
\item There are multiple bands of fits which converged to higher $\bar{\chi}^2$; since there is a large step to the first of these ($\bar{\chi}^2 = 2.312\times10^{-3}$), and they appear with much lower frequency, these are most likely indicative of local minima.

% \item Not all fits that converged - as defined by the criteria above - provided the reference matrix elements. This illustrates the importance of statistical sample of the solution hyperspace, and/or the use of further tests of the fit results [REF] in order to determine their veracity in general.
% \item In this case, the lowest $\chi^2$ does correspond to the reference matrix elements. Further, in the noise-free case, the minima found in these cases is orders of magnitude lower than the next best parameter set, although this may not hold in general depending on the quality of the data (see Sect. XX), and the complexity of the parameter-set.
% \item For the free floating parameter case, the results are shown in both raw form and with a reference phase set in Figs. XX and XX. This illustrates the phase sensitivity of the fitting, and also that this is a \textit{relative} phase. In a similar fashion to statistically sampling the parameter space with the seed parameters, allowing unconstrained parameters also helps to ensure that the full hyperspace is probed; however, it is not apparent that a viable solution set (or sets) have been found until a reference phase is set. (Similar considerations may apply to the magnitudes, depending on whether these are chosen to be normalised and/or if $\beta_{0,0}$ values are included in the fitting.)
% \item Uncertainties on the parameters here are estimated from the fit using a standard approach of testing the curvature of the $\chi^2$ hypersurface with respect to each parameter; in this case this routine is implemented by the lmfit library. Uncertainties may also be estimated by repeated fits to different sub-sets of the data - a statistical bootstrapping methodology - which is investigated in Sect. XX [TODO].
\end{enumerate}


\subsubsection{Bootstrapping basics: retrieved parameter sets \& fidelity\label{sec:bootstrap-fidelity}}

To drill down into the results, the values and clustering of the retrieved parameter sets can be investigated, as well as the overall quality of the fitting. Fig. \ref{494229} illustrates the spread in retrieved parameters over the best fit region, and Fig. \ref{743962} shows the overall quality of the fits in this region. For the purposes of discussion, each band observed in Fig. \ref{509194} will be described as a $\bar{\chi}^2$ cluster or group, assumed to equate to a viable set of retrieved parameters, and the best such set should equate to the "true" values, i.e. the photoionization matrix elements, if the methodology is successful and there is a well-defined global minima. Again, some tentative conclusions can be drawn:

\begin{enumerate}
\item The results for the magnitudes show very little difference within each $\bar{\chi}^2$ cluster, and closer inspection reveals that values between clusters are typically within 5\%, with the exception of the $|3,\pm1\rangle$ case which shows a larger spread. This indicates a good agreement in all results.
\item The phase results broadly fall into two classes, (a) cases which show good agreement within a $\bar{\chi}^2$ cluster, and (b) cases which have two values per $\bar{\chi}^2$ cluster. Additionally there is a larger spread in the values between clusters in phase space, and this is again most apparent for the $|3,\pm1\rangle$ case, which spans the full $-\pi\leq\phi\leq\pi$ phase range. Note that there is no spread in the $\phi_{1,-1}$ (phase) parameter, this was fixed as a reference phase in the current case, with $\phi=-0.861$.
\item The well-defined grouping here indicates that the retrieved parameter sets are unique for each $\bar{\chi}^2$ cluster, and each case can be regarded as a distinct, viable, parameter set to be \DIFdelbegin \DIFdel{futher }\DIFdelend \DIFaddbegin \DIFadd{further }\DIFaddend investigated; a priori it is expected that the lowest $\bar{\chi}^2$ should be the true result, but in practice this may not always hold depending on the data.
\item The parameters with split/pairs of values are indicative of cases where \DIFdelbegin \DIFdel{these }\DIFdelend \DIFaddbegin \DIFadd{there }\DIFaddend is an insensitivity in the fit. In this case, the $|3,\pm1\rangle$ case shows an insensitivity to the sign of the phase, which appears as a splitting due to the $\mod(\pi)$ nature of the result\DIFdelbegin \DIFdel{- although there }\DIFdelend \DIFaddbegin \DIFadd{. There }\DIFaddend is a slight bias in the results towards one of the pair in each case, \DIFaddbegin \DIFadd{though }\DIFaddend this may be a statistical \DIFdelbegin \DIFdel{artiefact}\DIFdelend \DIFaddbegin \DIFadd{artifact}\DIFaddend . (This type of effect will be discussed further below.)
\end{enumerate}

% TODO: confirm fit settings and results, discussion of phase lock to rotational wavepacket via magnitudes to add later.

To further investigate the parameter sets, a correlation pair/matrix representation can be used\DIFdelbegin \DIFdel{: for }\DIFdelend \DIFaddbegin \DIFadd{. For }\DIFaddend the phases, an example is shown in Fig. \ref{888108}. In this plot each parameter is shown as a function of all other parameters for each set (fit), and coloured by $\bar{\chi}^2$. This results in a rather complex, but informative, representation. In this example the phases were ``corrected", with the reference value set to zero in order to illustrate general trends (i.e. as would typically be the case when an absolute reference value is not known a priori), which results in a zero spread for this parameter (top left panel in Fig. \ref{888108}). Additionally, the ranges are wrapped to $\mod(\pi)$, keeping \DIFdelbegin \DIFdel{+ve }\DIFdelend \DIFaddbegin \DIFadd{positive }\DIFaddend values only, thus collapsing the $\pm$ pairs observed in Fig. \ref{494229} for $\phi_{3,\pm1}$. The bottom row and final column on the right of Fig. \ref{888108} show patterns of the parameters with $\bar{\chi}^2$ value. Of particular note here are the curves visible in most cases: these indicate the curvature of the $\bar{\chi}^2$ hypersurface with respect to the given coordinate (parameter), where a steeper curve indicates how well defined a given parameter is. The remaining correlation plots indicate the spread of individual parameters (diagonal panels), and \DIFdelbegin \DIFdel{parameter-paramter }\DIFdelend \DIFaddbegin \DIFadd{parameter-parameter }\DIFaddend correlations (off-diagonal panels). In general good clustering is observed for the lowest $\bar{\chi}^2$ values, % (bluest points), - NOT REALLY CLEAR currently.
consistent with the expectations from Fig. \ref{494229}, with more spread apparent in higher-valued results. For the phases with $\pm$ pair splittings - for example the 2nd column in Fig. \ref{888108} - characteristic V shapes are observed, fanning out from the best-fit cluster as a function of $\bar{\chi}^2$; these correspond to cases where the $\pm$ pairs are not wrapped (corrected) to the same value, hence indicate larger uncertainties in these parameter sets. Some outlier parameter sets can also be seen in this plot, for instance the single points visible to the right of the panels in the 2nd column of Fig. \ref{888108}, which are correlated with larger $\bar{\chi}^2$ values (bottom panel of the column).

To investigate the fidelity of the results in this test case the best parameter set(s) can be compared with the input matrix elements, and results are presented in Table \ref{tab:matE}. In this comparison, uncertainties on the retrieved parameters were estimated statistically, based on the standard deviation in the best fit results for the lowest $\bar{\chi}^2$ group; in this case it is of note that no ``experimental" uncertainties were included in the fitting, so the estimates herein indicate purely the error in the retrieval procedure with noisy data (without noise, essentially perfect results are found in this case). 
% In general, aside from the insensitivity to the sign of the phase in some cases, the results are in fair agreement with the input matrix elements.

\begin{itemize}
\item The final results are generally quite close to the inputs. In this case, the 10\% random noise essentially translates to a similar retrieval uncertainty in the magnitudes, although there is also a notable decrease in accuracy with the $|3,\pm1\rangle$ case, and significant increase in accuracy for the $\sigma_u$ cases.
\item The absolute phase values appear to be quite far off in some cases, but the phase corrected values typically look quite reasonable; this is consistent with a lack of sensitivity in the test dataset to the sign of the phases (as discussed elsewhere), but the remapped phases ($0:\pi$) are generally precise. Additionally, the ``absolute" phases given are averaged over all $\pm$ pairs, hence end up quite close to zero, whilst the ``corrected" phases are remapped before averaging. In general the former is, of course, not desirable, but serves to illustrated the type of issue that may arise in a retrieval protocol.
% \begin{itemize}
\item With the exception of $|3,0\rangle$ and $|1-1\rangle$, all remapped parameters are within 10\% of the reference values.
\item For the $\phi_{3,0}$ it appears that the value is not well-defined in the data, and is different from the reference value by $\sim\pi/4$.
\item For $\phi_{1-1}$ the absolute error is, indeed, small, but since this is close to zero, and should be defined as zero in the phase corrected case, the percentage error appears large, although the absolute value is close to the true value.
% \end{itemize}
\item The doubly-degenerate $|\pi_u,l,\pm1\rangle$ cases are found to have approximately the same magnitudes and phases in the free fit. In this case this is expected from the input values, hence indicates a good fit result. In general, if known \textit{a priori}, such constraints can also be included in the fitting protocol, and should result in faster and more precise results where there are significant symmetry constraints on the results.
\item The differences between the data and reference values are much larger than the standard deviation of the fits. This is indicative of a good (close/singular) batch of fits, with a unique global minimum, but reveals that the results obtained are not perfect - as expected for \DIFdelbegin \DIFdel{noisey }\DIFdelend \DIFaddbegin \DIFadd{noisy }\DIFaddend data. Adding more data-points to the fit, and/or using higher fidelity data would help in this case.
\item Alternative uncertainty estimations can be obtained from the individual parameter set results, based on the curvature of the $\chi^2$ hyperspace w.r.t. each parameter, or w.r.t. to all other parameters \cite{HockettThesis,Bevington1992}. In testing, only the first approach was considered, making use of values returned by the \href{https://lmfit.github.io/lmfit-py/fitting.html#uncertainties-in-variable-parameters-and-their-correlations}{lmfit library routines} \cite{LMFITDocumentation} from inversion of the Hessian matrix (see Sect. \ref{sec:numerical-notes}); however, this value was not found to be useful in many cases here, with relative errors into the thousands of \%, likely due to the strongly-correlated nature of the fit. The 2nd approach has been used previously, but is significantly more time-consuming (each test value necessitates a refitting of all other parameters), hence statistical uncertainties may represent the best approach for fast and robust estimations.
\item As noted above, although noise was added to the simulated data prior to fitting, experimental/data uncertainties were not included in the fitting. In general these may be expected to be relatively small for $\beta$ parameters obtained via imaging-type experiments with good S:N (for instance, the results of Refs. \cite{HockettThesis,marceau2017MolecularFrameReconstruction}), but may remain significant for absolute count-rates (i.e. $\beta_{0,0}$), and consequently are expected to map to larger uncertainties in the absolute magnitudes. However, fitting to count-rate normalised data (angular distributions only) can mitigate this effect, as was explored in the original demonstration of the technique \cite{marceau2017MolecularFrameReconstruction}, which returned accurate \textit{relative} magnitudes and MFPADs for the $X$-state with experimental \DIFdelbegin \DIFdel{uncertainities }\DIFdelend \DIFaddbegin \DIFadd{uncertainties }\DIFaddend typically $<10\%$.
\end{itemize}



% \subsubsection{Bootstrapping basics: 10-point fit}

% As an initial test of the method, noise-free data was used, and 10 temporal points over the main revival feature were randomly selected. To fit the data, a set of fitting parameters were defined in (magnitude, phase) form. In this case, the parameter set was simply defined from the input matrix elements, including symmetry relations, resulting in 6 complex radial matrix elements defining the problem (this equates to 2n-1 parameters to determine in magnitude-phase form, where the -1 arises since the phases are relative, and one phase must be defined as a reference, either pre or post fit); in general this step in the protocol may require manual configuration for the problem at hand [MORE ON THIS? MATRIX METHOD TOO]. 

% The PEMtk fitting matrix element fitting routine wraps the lmfit package [REF, https://lmfit.github.io/lmfit-py/, https://dx.doi.org/10.5281/zenodo.11813], in this case a standard Levenberg-Marquardt minimization was used, and all (12) parameters allowed to float freely. To gain insight into the efficiency of the fitting routine, and the uniqueness of the fit results [REF], 1000 fits were performed on the same dataset, each seeded with randomised parameter values. (This methodology amounts to a statistical sampling of the solution hyperspace, which may be expected to contain some local minima in general high-dimensional cases. [REF]) Convergence criteria were set as .... Running in parallel on 20 (logical) cores of an AMD Threadripper 2950X based workstation, this required ~5GB of RAM and took on the order of 20 minutes per 100 fits (albeit with large variance, since convergence time depends on the start parameters); further benchmarks for the current codebase can be found at [REF].



% Results are summarised in Figs. XX. A few conclusions from this case study:

% \begin{enumerate}
% \item Not all fits that converged - as defined by the criteria above - provided the reference matrix elements. This illustrates the importance of statistical sample of the solution hyperspace, and/or the use of further tests of the fit results [REF] in order to determine their veracity in general.
% \item In this case, the lowest $\chi^2$ does correspond to the reference matrix elements. Further, in the noise-free case, the minima found in these cases is orders of magnitude lower than the next best parameter set, although this may not hold in general depending on the quality of the data (see Sect. XX), and the complexity of the parameter-set.
% \item For the free floating parameter case, the results are shown in both raw form and with a reference phase set in Figs. XX and XX. This illustrates the phase sensitivity of the fitting, and also that this is a \textit{relative} phase. In a similar fashion to statistically sampling the parameter space with the seed parameters, allowing unconstrained parameters also helps to ensure that the full hyperspace is probed; however, it is not apparent that a viable solution set (or sets) have been found until a reference phase is set. (Similar considerations may apply to the magnitudes, depending on whether these are chosen to be normalised and/or if $\beta_{0,0}$ values are included in the fitting.)
% \item Uncertainties on the parameters here are estimated from the fit using a standard approach of testing the curvature of the $\chi^2$ hypersurface with respect to each parameter; in this case this routine is implemented by the lmfit library. Uncertainties may also be estimated by repeated fits to different sub-sets of the data - a statistical bootstrapping methodology - which is investigated in Sect. XX [TODO].
% \end{enumerate}

% TO CONSIDER:

% - Level of detail here, words vs. just pointing at the notebook.
% - Plot style, types and export, see notes below (commented out)

% TODO: test HV HTML interactive export > Authorea, see https://holoviews.org/user_guide/Plots_and_Renderers.html

% Bokeh: https://docs.bokeh.org/en/latest/docs/user_guide/embed.html

% Authorea & Plotly: % https://support.authorea.com/en-us/article/inserting-an-interactive-figure-y32ne6/

% Param plot fig TODO (removed from caption 30/08/22)
%  [TODO: cbar and param labels, interactive with https://malouche.github.io/notebooks/correlation_matrix2.html or https://hvplot.holoviz.org/user_guide/Statistical_Plots.html or http://holoviews.org/gallery/demos/bokeh/iris_splom_example.html, may have trial code elsewhere...]




% From Pandas Latex export + added caption & label wrapper
% TODO: update with Styled table (PD>1.3)
\begin{table}
\centering
% Version paramsInputRelabelled_latex_210422.tex
\begin{tabular}{llllrrrl}
\toprule
   &   &    &    &          comp &     m &      p & labels \\
Cont & l & m & $\mu$ &               &       &        &        \\
\midrule
PU & 1 & -1 &  1 &  1.163-1.354j & 1.785 & -0.861 &   1,-1 \\
   &   &  1 & -1 &  1.163-1.354j & 1.785 & -0.861 &    1,1 \\
   & 3 & -1 &  1 & -0.803-0.017j & 0.803 & -3.120 &   3,-1 \\
   &   &  1 & -1 & -0.803-0.017j & 0.803 & -3.120 &    3,1 \\
SU & 1 &  0 &  0 & -2.317+1.359j & 2.686 &  2.611 &    1,0 \\
   & 3 &  0 &  0 &  1.106-0.087j & 1.109 & -0.079 &    3,0 \\
\bottomrule
\end{tabular}

\caption{\label{tab:inputMatE}Input matrix elements for the simulated data, from ePolyScat calculations for $N_2$ at 1~eV, (comp)lex values, and in (m)agnitude and (p)hase form. Note that the continuum symmetry is split into PU \DIFaddbeginFL \DIFaddFL{($\pi_u$) }\DIFaddendFL and SU \DIFaddbeginFL \DIFaddFL{($\sigma_u$) }\DIFaddendFL components, correlated with \DIFdelbeginFL \DIFdelFL{$\mu=\pm1$ }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$m=\pm1,\mu=\mp1$ }\DIFaddendFL and \DIFdelbeginFL \DIFdelFL{$\mu=0$ }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{$m=0,\mu=0$ }\DIFaddendFL respectively, i.e. perpendicular and parallel MF components; for brevity the matrix elements will be labelled simply by $|l,m\rangle$ in the text in general.}
\end{table}
% From Pandas Latex export + added caption & label wrapper
% TODO: update with Styled table (PD>1.3)
\begin{table}
\centering
% Version paramsAggRelabelled_latex_210422.tex
\begin{tabular}{lllrrrl}
\toprule
   &   & Type &     m &      p &    pc & labels \\
Cont & l & m &       &        &       &        \\
\midrule
PU & 1 & -1 & 1.614 & -0.859 & 0.000 &   1,-1 \\
   &   &  1 & 1.614 & -0.861 & 0.005 &    1,1 \\
   & 3 & -1 & 1.143 &  0.144 & 2.059 &   3,-1 \\
   &   &  1 & 1.142 &  0.143 & 2.059 &    3,1 \\
SU & 1 &  0 & 2.653 &  2.357 & 2.987 &    1,0 \\
   & 3 &  0 & 1.144 & -0.785 & 0.154 &    3,0 \\
\bottomrule
\end{tabular}

\caption{\label{tab:aggMatE}Retrieved values for (m)agnitudes, (p)hases and ``corrected" phases (pc).}
\end{table}
% From Pandas Latex export + added caption & label wrapper
% TODO: update with Styled table (PD>1.3)
\begin{table}
\centering

% \begin{tabular}{lllrrrrrr}
% \toprule
%   &          & Param &  PU\_SG\_PU\_1\_1\_n1\_1 &  PU\_SG\_PU\_1\_n1\_1\_1 &  PU\_SG\_PU\_3\_1\_n1\_1 &  PU\_SG\_PU\_3\_n1\_1\_1 &  SU\_SG\_SU\_1\_0\_0\_1 &  SU\_SG\_SU\_3\_0\_0\_1 \\
% Type & Source & dType &                    &                    &                    &                    &                   &                   \\
% \midrule
% m & mean & num &           1.613850 &       1.613570e+00 &           1.142652 &           1.142349 &          2.652524 &          1.143807 \\
%   & ref & num &           1.784616 &       1.784616e+00 &           0.802905 &           0.802905 &          2.686062 &          1.109153 \\
%   & diff & \% &          10.581260 &       1.060047e+01 &          29.733209 &          29.714546 &          1.264393 &          3.029722 \\
%   &          & num &          -0.170766 &      -1.710460e-01 &           0.339747 &           0.339444 &         -0.033538 &          0.034654 \\
%   & std & \% &           0.129194 &       1.364913e-01 &           0.266573 &           0.265457 &          0.001599 &          0.006777 \\
%   &          & num &           0.002085 &       2.202383e-03 &           0.003046 &           0.003032 &          0.000042 &          0.000078 \\
%   & diff/std & \% &        8190.232468 &       7.766406e+03 &       11153.883911 &       11193.713369 &      79089.050126 &      44706.225465 \\
% p & mean & num &          -0.859382 &      -8.610414e-01 &           0.144138 &           0.143498 &          2.356759 &         -0.785126 \\
%   & ref & num &          -0.861041 &      -8.610414e-01 &          -3.120444 &          -3.120444 &          2.611229 &         -0.078678 \\
%   & diff & \% &           0.193090 &       4.512885e-13 &        2264.893304 &        2274.558140 &         10.797481 &         89.978902 \\
%   &          & num &           0.001659 &       3.885781e-15 &           3.264583 &           3.263942 &         -0.254471 &         -0.706448 \\
%   & std & \% &           1.635940 &       0.000000e+00 &        1249.292494 &        1255.151491 &          5.709133 &         17.100819 \\
%   &          & num &           0.014059 &       0.000000e+00 &           1.800711 &           1.801116 &          0.134550 &          0.134263 \\
%   & diff/std & \% &          11.802998 &                inf &         181.294078 &         181.217818 &        189.126456 &        526.167201 \\
% pc & mean & num &           0.000000 &       5.372290e-03 &           2.058870 &           2.058926 &          2.986923 &          0.154275 \\
%   & ref & num &           0.000000 &       0.000000e+00 &           2.259403 &           2.259403 &          2.810915 &          0.782363 \\
%   & diff & \% &                NaN &       1.000000e+02 &           9.739951 &           9.736965 &          5.892615 &        407.123575 \\
%   &          & num &           0.000000 &       5.372290e-03 &          -0.200533 &          -0.200477 &          0.176008 &         -0.628088 \\
%   & std & \% &                NaN &       2.437070e+02 &           0.256878 &           0.461470 &          0.226641 &          4.433055 \\
%   &          & num &           0.000000 &       1.309265e-02 &           0.005289 &           0.009501 &          0.006770 &          0.006839 \\
%   & diff/std & \% &                NaN &       4.103288e+01 &        3791.665217 &        2109.989164 &       2599.979908 &       9183.815020 \\
% \bottomrule
% \end{tabular}

% Version paramsCompRelabelled_latex_210422.tex
\begin{tabular}{lllrrrrrr}
\toprule
   &          & l,m &     1,-1 &      1,1 &      3,-1 &       3,1 &       1,0 &       3,0 \\
Type & Source & dType &          &          &           &           &           &           \\
\midrule
m & mean & num &    1.614 &    1.614 &     1.143 &     1.142 &     2.653 &     1.144 \\
   & ref & num &    1.785 &    1.785 &     0.803 &     0.803 &     2.686 &     1.109 \\
   & diff & \% &   10.581 &   10.600 &    29.733 &    29.715 &     1.264 &     3.030 \\
   &          & num &   -0.171 &   -0.171 &     0.340 &     0.339 &    -0.034 &     0.035 \\
   & std & \% &    0.129 &    0.136 &     0.267 &     0.265 &     0.002 &     0.007 \\
   &          & num &    0.002 &    0.002 &     0.003 &     0.003 &     0.000 &     0.000 \\
   & diff/std & \% & 8190.232 & 7766.406 & 11153.884 & 11193.713 & 79089.050 & 44706.225 \\
p & mean & num &   -0.859 &   -0.861 &     0.144 &     0.143 &     2.357 &    -0.785 \\
   & ref & num &   -0.861 &   -0.861 &    -3.120 &    -3.120 &     2.611 &    -0.079 \\
   & diff & \% &    0.193 &    0.000 &  2264.893 &  2274.558 &    10.797 &    89.979 \\
   &          & num &    0.002 &    0.000 &     3.265 &     3.264 &    -0.254 &    -0.706 \\
   & std & \% &    1.636 &    0.000 &  1249.292 &  1255.151 &     5.709 &    17.101 \\
   &          & num &    0.014 &    0.000 &     1.801 &     1.801 &     0.135 &     0.134 \\
   & diff/std & \% &   11.803 &      inf &   181.294 &   181.218 &   189.126 &   526.167 \\
pc & mean & num &    0.000 &    0.005 &     2.059 &     2.059 &     2.987 &     0.154 \\
   & ref & num &    0.000 &    0.000 &     2.259 &     2.259 &     2.811 &     0.782 \\
   & diff & \% &      nan &  100.000 &     9.740 &     9.737 &     5.893 &   407.124 \\
   &          & num &    0.000 &    0.005 &    -0.201 &    -0.200 &     0.176 &    -0.628 \\
   & std & \% &      nan &  243.707 &     0.257 &     0.461 &     0.227 &     4.433 \\
   &          & num &    0.000 &    0.013 &     0.005 &     0.010 &     0.007 &     0.007 \\
   & diff/std & \% &      nan &   41.033 &  3791.665 &  2109.989 &  2599.980 &  9183.815 \\
\bottomrule
\end{tabular}

\caption{\label{tab:matE}Retrieved values and statistics for (m)agnitudes, (p)hases and ``corrected" phases (pc). For each type and parameter the mean result from the fits is given, along with the standard deviation, and a comparison to the (ref)erence computational data, with absolute numeric (`num') and percentage differences as defined by the `dType' column. Finally, the value of the difference/standard deviation is given as a rough metric for veracity.}
\end{table}

\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_corrPlot_220422.png}
\caption{Example correlation (pair) plot for retrieved phases. Note in this case the reference phase (top left panel) has been set to 0 to illustrate general patterns in the retrieved parameter sets. In general, the curvature indicates how well-defined a given parameter is, whilst V-patterns indicate cases with \(\pm\phi\) pairs. The bottom row and final column on the right show patterns of the parameters with respect to \(\bar{\chi}^2\) .\label{888108}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_densityNorm_max_290722_11-30-03.png}
%DIFDELCMD < %%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_densityNorm_max_090323_19-42-31.png}
\DIFaddendFL \caption{Density matrix representations for the continuum. (top row) From reference matrix elements, (middle row) from the retrieved matrix elements, (bottom row) differences. Each row shows the elements for the (imag)inary and real components. Density matrix values (complex) were renormalised to unity by the maximum before plotting ( \(|1,0,0\rangle \langle1,0,0|\) element), and these representations show the case for unsigned phases; note also the rescaled colourmap for the difference plots.\label{998904}}
\end{center}
\end{figure}

\subsubsection{Bootstrapping basics: density matrix representation\label{sec:den-mat-N2}}

An alternative test of fidelity can be investigated via a density matrix representation of the results, this is shown in Fig. \ref{998904}. These plots show the real and imaginary components of the density matrices for the ionization continuum (as defined in Sect. \ref{sec:density-mat-basic}, Eqn. \ref{eqn:radial-density-mat}), normalised to the maximum (complex) value. Overall the agreement is good for the real values (right column of Fig. \ref{998904}), as expected from the values in Table \ref{tab:matE}, and the differences (bottom row) are typically $<10~\%$. Similar results are observed for the imaginary values (left column), which are shown for the unsigned phase case only (corresponding to phases set `pc' as per Table \ref{tab:matE}). For the signed phase case (not shown, but corresponding to phases set `p' as per Table \ref{tab:matE}) the loss of signs leads to larger differences in the off-diagonal density terms, and the possibility of phase flips, which 
% is immediately evident 
can result in inverted patterns visible in the imaginary part of the density matrix. However, as discussed elsewhere (e.g. Sect. \ref{sec:bootstrap-fidelity}), symmetry constraints may render the continuum insensitive to the sign of the phases, and the retrieved matrix elements may therefore still present a high-fidelity reconstruction of the continuum.
%The absolute value plots do not indicate the sign difference directly, but it is reflected in larger differences observed in these plots (differences $>>10~\%$), although the absolute values and observed pattern for the retrieved matrix elements compares well with the reference case. (In this case, the differences were obtained from the complex-valued density matrices, rather than the individual components.) TODO: better language here.

Perhaps more interesting/useful in the density matrix representation is the visualisation of the phase relations between the photoionization matrix elements (the off-diagonal density matrix elements), and the ability to quickly check the overall pattern of the elements, hence confirm that no phase-relations are missing and orthogonality relations are fulfilled, or that very different patterns/sets of matrix elements were retrieved. Furthermore, the density matrix elements also provide a complete description of the photoionization event, and makes clear the equivalence of the ``complete" photoionization experiments (and associated continuum reconstruction methods) with quantum tomography schemes \cite{MauroDAriano2003}\DIFdelbegin \DIFdel{; it }\DIFdelend \DIFaddbegin \DIFadd{. It }\DIFaddend can be used as the starting point for further analysis based on density matrix techniques - this is discussed, for instance, in Ref. \cite{BlumDensityMat}, and can also be viewed as a bridge between traditional methods in spectroscopy and AMO physics, and more recent concepts in the quantum information sciences (e.g. Refs.  \cite{Tichy2011a,Yuen-Zhou2014}).

% TODO: more to say, other metrics for fidelity?

\subsubsection{Bootstrapping basics: obtaining MFPADs\label{sec:bootstrap-MFPADs}}

With the matrix elements to hand, the MFPADs can also be computed, for any arbitrary molecular alignment and polarization. Some examples are shown in Fig. \ref{454268}, which shows results for the two sets of retrieved matrix elements discussed above (raw, and with phase-correction), along with the reference computational results (as used to originally generate the simulated data) and the differences between the phase-corrected case and the reference results.

A number of points are illustrated by the figure:

\begin{itemize}
\item The original/input matrix elements produce the MFPADs shown in the top row of the figure, which provide a reference for the fidelity of the reconstructed MFPADs. 
\item Polarization geometries are illustrated for four cases (see Fig. \ref{781808} for the MF reference coords), labelled $z,x,y,d$, where $z$ is parallel to the bond axis, $x,y$ perpendicular and $d$ ``diagonal" relative to the $z$-axis ($\theta_{z}=\pi/4$). In this case symmetry dictates that $z$ ($\sigma_u$ continuum) is cylindrically symmetric, the $x,y$ cases are a conjugate $\pi_u$ pair, and that the diagonal case mixes these components, hence breaks the symmetry and is sensitive to the relative phase between the continua.
\item The 2nd row illustrates the results from the phase-corrected parameters. These show generally good agreement with the reference case, apart from slightly exaggerated off-diagonal lobes for the $x,y$ results, consistent with the larger magnitudes for $|3,\pm1\rangle$ in the reconstructed matrix elements.
\item The 3rd row shows difference plots between the reference and phase-corrected results. This emphasizes the differences in the $|3,\pm1\rangle$ component magnitudes. The $z$ case shows very good agreement with the reference case (note the smaller magnitudes), whilst the $d$ case indicates some differences, again attributable to the differences in $|3,\pm1\rangle$ component magnitudes.
\item The bottom row illustrates the case of the phase-averaged (but not ``corrected") parameters. This serves to highlight the sensitivity of the PADs to the relative phases of the matrix elements - here the $x,y$ results show poor agreement with the reference case due to averaging over the $\pm\phi$ pairs, and this also affects the $d$ case.
\end{itemize}

Overall, with careful treatment of the phases, it is clear that high-fidelity MFPADs can be recovered in the current case. Although the difference plots indicate some differences between the reconstructed and reference case, the absolute changes in the form of the MFPADs are fairly minor. The lack of an absolute phase is not an issue in general for MFPAD recovery, although this does constitute a loss of relative phase in the continuum wavefunctions as a function of energy. % More on this here? Or elsewhere? Maybe RABITT etc. discussion?

% To further investigate the different parameter sets discussed above, which were essentially identical in the AF-$\beta_{L,M}$ comparisons, Fig. [XX] illustrates some MFPADs for these cases too. [TODO - if interesting]

\begin{figure}[]
\begin{center}
\DIFdelbeginFL %DIFDELCMD < \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_MFPADs_250422.png}
%DIFDELCMD < %%%
\DIFdelendFL \DIFaddbeginFL \includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/dataDump_1000fitTests_multiFit_noise_051021_MFPADs_100323.png}
\DIFaddendFL \caption{Reconstructed MFPADs for N2. Columns show results for polarization geometries \((z,x,y,d)\) and rows the results for difference sets of matrix elements: 
\DIFdelbeginFL \DIFdelFL{retrieved mean case, phase-corrected case, }\DIFdelendFL %DIF > retrieved mean case, phase-corrected case, reference (computational) results and difference between phase-correct and reference case. See main text for details.\label{454268}}
reference (computational) results\DIFdelbeginFL \DIFdelFL{and }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{, phase-corrected retrieval case, }\DIFaddendFL difference between \DIFdelbeginFL \DIFdelFL{phase-correct }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{phase-corrected }\DIFaddendFL and reference case\DIFaddbeginFL \DIFaddFL{, and retrieved mean case (i.e. without phase-correction)}\DIFaddendFL . See main text for details.\label{454268}}
\end{center}
\end{figure}

\subsubsection{Further bootstrapping: information content \& sensitivity\label{sec:bootstrapping-info-sensitivity}}

As well as considering the results from full fits of the data, the inherent sensitivity of various aspects of the problem can also be investigated. In general, this will depend on the details of the problem at hand (symmetry, ADMs etc.), but can in essence be considered independently of the matrix elements themselves via ``channel functions" or equivalent (see Sect. \ref{sec:channel-funcs} and Sects. \ref{appendix:formalism}, \ref{sec:channel-funs-full} for full definitions). In the PEMtk routines, the various component tensors are computed and packaged as a basis set prior to fitting, and can be further examined independently. (For full details see \href{https://pemtk.readthedocs.io/en/latest/fitting/PEMtk_fitting_basis-set_demo_050621-full.html}{the PEMtk docs}.)

Fig. \ref{776753} illustrates the geometric coupling term $B_{L,M}$ (Eqn. \ref{eq:BLM-func-defn}), hence the sensitivity of different (L,M) terms to the matrix element products. This term incorporates the coupling of the partial wave pairs, $|l,m\rangle$ and $|l',m'\rangle$, into the term $B_{L,M}$, where $\{L,M\}$ are observable total angular momenta, 
% and $M = S-R_{p}$, 
% ([full definition here](https://epsproc.readthedocs.io/en/dev/methods/geometric_method_dev_260220_090420_tidy.html#B_{L,M}-term)), 
hence indicates which terms are allowed for a given set of partial waves - in the current test case, $l=1,3$ only (as defined by the known matrix elements). This is essentially a way to visualize the general selection rules into the observable: for instance, only terms $l=l'$ and $m=-m'$ contribute to the overall \DIFdelbegin \DIFdel{photoinoization }\DIFdelend \DIFaddbegin \DIFadd{photoionization }\DIFaddend cross-section term ($L=0, M=0$). However, since these terms are fairly simply followed algebraically in this case, via the rules inherent in the 3j product, this is not particularly insightful. These visualizations will become more useful when dealing with real sets of matrix elements, and specific polarization geometries, which will further modulate the $B_{L,M}$ terms\DIFdelbegin \DIFdel{- for }\DIFdelend \DIFaddbegin \DIFadd{. For }\DIFaddend example, in the AF $M$ is further restricted by $M = S-R_{p}$ (Eqn. \ref{eq:delta-func-defn}); in the current case with $S=0, R_p=0$ (this is typically the case for a cylindrically-symmetric experimental configuration), only $M=0$ terms will contribute.

Fig. \ref{652406} is more complicated, and illustrates the tensor product $\Lambda_{R}\otimes E_{PR}(\hat{e})\otimes \Delta_{L,M}(K,Q,S)\otimes A^{K}_{Q,S}(t)$, expanded over all quantum numbers.
%(see [full definition here](https://epsproc.readthedocs.io/en/dev/methods/geometric_method_dev_pt3_AFBLM_090620_010920_dev_bk100920.html#\beta_{L,M}^{AF}-rewrite)). 
This term, therefore, incorporates all of the dependence (or response) of the AF-$\beta_{LM}$s on the polarisation state, and the axis distribution. In this case, it's clear that there's a significant response to the alignment in the $L=0,2$ terms, some response in $L=4$ and - for the most part - no significant contribution from higher-order terms (threshold of 0.01), for the selected set of ADMs. This visualisation is potentially useful for planning measurements sensitive to certain properties, for example, in this case the $L=6$ term is significant only over a small $t$-range, so this region could be targeted experimentally to obtain data more sensitive to higher-order $l$-wave term couplings (per Fig. \ref{776753}). Conversely, the $L=0,2$ response terms are quite symmetric over the half-revival, so making experimental measurements at $t$-points symmetrically over this feature will provide redundant, but not additional, information content to the dataset for matrix-element retrieval. Also of note is the opposite response of the $\mu=\mu'=0$ terms and $\mu\neq\mu'$ (with $\mu=\pm1$, $\mu'=\mp1$) to the alignment, indicating different response and sensitivities in the polarization projections. This is particularly apparent in the $L=6$ term, where the $\mu\neq\mu'$ terms drop below threshold.
% $\sigma$ ($\mu=0$) and $\pi$ ($\mu=\pm1$) continua.
% Also of particular note here is NOTE ON S-Rp term and implications.

Finally, Fig. \ref{676540} illustrates the full AF channel (response) function $\varUpsilon_{L,M}^{u,\zeta\zeta'}$ (Eqns. \ref{eqn:channel-fns}, \ref{eq:channel-func-defn-AF}), which is essentially the complete geometric basis set,
%([give or take a phase term or two](https://epsproc.readthedocs.io/en/dev/methods/geometric_method_dev_pt3_AFBLM_090620_010920_dev_bk100920.html#\beta_{L,M}^{AF}-rewrite)), 
hence equivalent to the AF-$\beta_{LM}$ (Eqn. \ref{eq:BLM-tensor-AF}) if the ionization matrix elements were set to unity. This illustrates not only the coupling of the geometric terms into the observable $L,M$, but also how the partial wave $|l,m\rangle$ terms map to the observables. %There's a lot of information here. 
A few observations in this case:

\begin{itemize}
\item The largest \DIFdelbegin \DIFdel{reponse }\DIFdelend \DIFaddbegin \DIFadd{response }\DIFaddend is in the total cross-section ($\beta_{0,0}$), which is ~2 times larger than any other term; 
\item this response is similar for both the $l=1$ and $l=3$ contributions, and all $m$, hence we expect similar sensitivity to both partial cross-sections (continua) in this case.
\item For $L>0$, $l\neq l'$ are present, indicative of the sensitivity of the PADs to cross-terms (interferences).
\item The response is, as might be expected, distinct for terms with $l=l'$ and $l\neq l'$, and as a function of $L,l,l'$.
% % and $S-Rp = 0$, 
% there is only a significant (above threshold) response around the centre of the selected time window, hence the main dip in the ADMs, corresponding to anti-alignment in this case.
\item The parameters indicate enhanced sensitivity to higher-order terms ($L=6$) just after the main revival feature. This was already apparent in Fig. \ref{652406}, and is a consequence of the larger $K=4,6$ terms in the ADMs in this region (see Fig. \ref{720080}). In the current case this is not particularly important for the matrix element retrieval, but in general may be significant in more complex cases with larger $l$ present.

\end{itemize}

These results demonstrate the high level of detail that can be obtained from a set of channel functions, and how such a basis set can aid in both planning and interpretation of experimental measurements in terms of the sensitivity to given channels. Many outstanding questions remain, in particular general metrics of total information content are not yet defined, nor are general methods for determination of a sufficient information content for retrieval in a given case. Such exploration is currently a topic of ongoing research, although it is also of note that some authors have previously explored related issues (see, for example, Refs. \cite{Schmidtke2000,Ramakrishna2012}).


% TODO: More to say on terms $S-Rp != 0$? Check formalism - may have some inconsistency in $M$ definition here too?
% TODO: information content from these results? Currently just sensitivity really.
% TODO: 09/08/22 updated figs, still could do with better cmap and layout.


\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/basisPlots_090822_BLMtable.png}
\caption{Matrix element geometric coupling term \(B_{L,M}\). (Terms \(\ge0.001\) only.)\label{776753}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/basisPlots_090822_polProd_M0.png}
\caption{Polarisation \& ADM product term, tensor product \(\Lambda_{R}\otimes E_{PR}(\hat{e})\otimes\Delta_{L,M}(K,Q,S)\otimes
A^{K}_{Q,S}(t)\).     (Terms \(\ge0.001\) only.)\label{652406}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/basisPlots_090822_response_M0.png}
\caption{Full channel (response) functions \(\varUpsilon_{L,M}^{u,\zeta\zeta'}\).     (Terms \(\ge0.001\) only.)\label{676540}}
\end{center}
\end{figure}

% *** Now above, and skip noise-free case
% \subsubsection{Bootstrapping basics: noisy data}

% To investigate the effects of noise, fitting was repeated for the same set of data-points, but with increasing amounts of white/pink-noise added.

% TODO





% \subsubsection{Further bootstrapping: sub-sample size \& fiedelity}

% In cases with noisy data, and/or where uncertainties in fitted parameters remain large, fitting to larger and/or alternative sub-sets of the data may be pursued.

% TODO

\subsubsection{Further bootstrapping: sub-sample size \& fidelity}

In cases with noisy data, and/or where uncertainties in fitted parameters remain large, fitting to larger and/or alternative sub-sets of the data may be pursued.
An obvious route to improvement of the retrieved matrix elements is via the inclusion of additional data points. In the original experimental demonstration \cite{marceau2017MolecularFrameReconstruction}, after an initial 10-point fit, further data was included\DIFaddbegin \DIFadd{, }\DIFaddend up to 89 \DIFdelbegin \DIFdel{$\beta_{LM}(t)$ }\DIFdelend \DIFaddbegin \DIFadd{data points, }\DIFaddend to minimise uncertainties in the retrieved matrix elements.\footnote{This procedure was only tested for the X-state in the experimental case, not for the A or B-state datasets. %See ref. \cite{marceau2017MolecularFrameReconstruction}
and especially the supplementary materials for more details.} Another, similar, route is via traditional statistical bootstrapping, in which fitting is tested for various randomly-selected sub-sets of the data (but the size of the fitted data set is not varied). Additionally, if the channel functions (fitting basis set) are investigated (see Sect. \ref{sec:bootstrapping-info-sensitivity}), additional data points may be selected to enhance the sensitivity to certain partial wave components.

In the current case, work is ongoing, %with the PEMtk codebase, 
but some effort has been made to investigate sampling strategies. In particular, preliminary work using different sample sizes plus additional statistical weightings (statistical bootstrapping) has yielded very promising results. For example, a dataset of 30 t-points equally spaced over the range 3.5~-~4.5~ps (as compared to 4~-~5~ps in the previous demonstration above), with random (\DIFdelbegin \DIFdel{Poissionian}\DIFdelend \DIFaddbegin \DIFadd{Poissonian}\DIFaddend ) statistical weightings additionally applied, yielded:

\begin{itemize}
\item 30~\% convergence (best $\chi^2$) in 100 test fits.
\item Standard deviations on the retrieved parameters of $<10^{-4}$ (cf. Table \ref{tab:matE}).
\item \DIFdelbegin \DIFdel{Fideleities }\DIFdelend \DIFaddbegin \DIFadd{Fidelities }\DIFaddend on retrieved parameters typically $<10\%$.
\end{itemize}

However, whilst this appears promising, it is of note that the trends in the fidelity of the retrieved matrix element remained similar to those shown in Table \ref{tab:matE}, with the $l=3$ cases less well-defined\DIFdelbegin \DIFdel{, indicating }\DIFdelend \DIFaddbegin \DIFadd{. This indicates that }\DIFaddend a more fundamental information-content limitation remained\DIFdelbegin \DIFdel{; additionally}\DIFdelend \DIFaddbegin \DIFadd{. Additionally}\DIFaddend , other tests with the same initial dataset but different statistical weightings did not yield the same high percentage of converged fits with low standard deviation (hence retrieval quality), indicating that more careful and methodical work is required here, perhaps with more sophisticated statistical techniques applied.





\subsubsection{Bootstrapping technique outlook \& future directions}

In the current case, it is clear that the bootstrapping methodology for obtaining full photoionization matrix elements from time-domain, AF datasets, works well. The current numerical routines in the PEMtk package (and back-end libraries) are relatively stable and fast, and amenable to detailed inspection. However, a range of outstanding questions and routes of investigation remain, for instance:

\begin{itemize}
\item Scaling to larger problems (larger molecules, more matrix elements). This is currently under investigation, but - based on previous work \cite{hockett2009RotationallyResolvedPhotoelectron, hockett2018QMP2} - it is anticipated that small polyatomic molecules should be tractable to the basic approach. 
\item More sophisticated approaches, for instance careful sub-selection of data based on the channel functions, data obtained for additional polarization geometries or with shaped laser pulses \cite{hockett2014CompletePhotoionizationExperiments, hockett2015CoherentControlPhotoelectron, hockett2015CompletePhotoionizationExperiments,hockett2018QMP1}. Such approaches may be expected to yield higher fidelity reconstructions for small polyatomic systems, and may be required for more complex cases.
\item Faster numerical routines, in particular via GPU-based numerics.
\item Implementation of additional fitting routines, both from standard numerical methods, and also from related specialised domain problems, for example phase-retrieval methods developed for optical interferograms and spectrograms (e.g. general FROG-type retrieval methods \cite{trebino2000FrequencyResolvedOpticalGating}, ptychography/holographic techniques \cite{Spangenberg2015b, Spangenberg2015c}) and homotopy \cite{Sommese2005} approaches may be applicable.
\item Correlations and overlaps with other related/emerging photoionization techniques may also prove fruitful\DIFdelbegin \DIFdel{: for }\DIFdelend \DIFaddbegin \DIFadd{. For }\DIFaddend instance, photoionization matrix elements are of interest in high-harmonic spectroscopy schemes \cite{Lock2012}, angle-resolved RABBITT \cite{hockett2017AngleresolvedRABBITTTheory,villeneuve2017CoherentImagingAttosecond} and general attosecond ``clocking" and time-delay measurement techniques\DIFdelbegin \DIFdel{- in }\DIFdelend \DIFaddbegin \DIFadd{. In }\DIFaddend many cases these methods are also directly sensitive to the energy-dependence of the matrix elements, thus providing additional information relative to a basic 1-photon ionization study (albeit with additional complexity), and have recently been of great theoretical interest in the \textit{ab initio} photoionization community \cite{Feist2014,benda2022AnalysisRABITTTime}.

\end{itemize}

%DIF >  In future it will also be interesting to consider 
\DIFaddbegin \DIFadd{Machine learning (ML), and particularly recent ``deep learning" techniques (often also generically referred to as AI), are currently in vogue and evolving rapidly. Such approaches may also present interesting opportunities for MF retrieval problems. Perhaps the main strength of these methods is that, in favourable cases, very complex problems may be treated without complete computation and/or understanding of the underlying physics (e.g. the recent success of DeepMind/AlphaFold in protein folding \mbox{%DIFAUXCMD
\cite{eisenstein2021ArtificialIntelligencePowers,jumper2021HighlyAccurateProtein}}\hspace{0pt}%DIFAUXCMD
); the use of ML/AI may, therefore, be particularly interesting for cases which are otherwise intractable to a full }\textit{\DIFadd{ab initio}} \DIFadd{analysis, e.g. complicated molecular dynamics or strongly-coupled light-matter systems, where the step-wise and separable approaches detailed herein will currently fail, and closed-form equations/solutions do not exist. A secondary use may be as fast fitting algorithms for cases of the type discussed herein, where the physics is understood, albeit complicated. This is much less interesting scientifically since it does not present a ``new" capability, although may still prove fruitful if the increase in speed (or robustness) is significant compared to current methods, e.g. to allow for real-time analysis during experimental runs. Furthermore, use in this vein, but with the aim of solving a fully coupled problem without the necessity of a bootstrapping or multi-step type of analysis (i.e. combining the various stages illustrated in Figs. \ref{807606}, \ref{731792} into a single ML-based routine) is certainly worth pursuing, with the potential to create a method that simultaneously retrieves both the alignment and photoelectron properties from experimental data without additional researcher intervention. The difficulty in all cases will likely be the generation of a suitable data set for the ML/AI training procedure, which is required before the routines can be deployed on new problems. Significant introductory and general discussion to the (rapidly evolving) topic can be found online and, for example, in Refs. \mbox{%DIFAUXCMD
\cite{LeCun2015,carleo2019MachineLearningPhysical,davies2021AdvancingMathematicsGuiding}}\hspace{0pt}%DIFAUXCMD
. Some recent use of ML/AI in the AMO context has proved successful, e.g. Refs. \mbox{%DIFAUXCMD
\cite{he2022FilmingMoviesAttosecond,hegazy2022BayesianInferencingDeterministic} }\hspace{0pt}%DIFAUXCMD
tackle specific data-analysis and reconstruction type problems; Refs. \mbox{%DIFAUXCMD
\cite{lu2022FastInitioPotential,nandi2021DmachineLearningPotential} }\hspace{0pt}%DIFAUXCMD
examine ML for }\textit{\DIFadd{ab initio}} \DIFadd{computation of potential energy surfaces; Ref. \mbox{%DIFAUXCMD
\cite{carleo2019MachineLearningPhysical} }\hspace{0pt}%DIFAUXCMD
provides a broad review of ML in the physical sciences, including quantum state reconstruction, as well as particle physics, cosmology and materials science.
%DIF > ; significant introductory and general discussion to the (rapidly evolving) topic can be found online and, for example, in Refs. \cite{LeCun2015,davies2021AdvancingMathematicsGuiding}.
}

%DIF >  TO add: protein folding refs, ref Isaac for quantum stuff? More outlook? Also ref citation, https://www.nature.com/articles/s41467-022-32313-0
%DIF >  Per VM: https://www.nature.com/articles/s41586-021-04086-x
%DIF >  Robustness as well as speed to mention?
%DIF >  09/03/23: added some more notes and refs, now completed.

\DIFaddend \subsection{MF reconstruction via matrix inversion\label{sec:Matrix-inversion-example}}

The key aspects of this method involve first fitting out the ADMs $A^K_{QS}(t)$ from measured $\bar{\beta}^u_{LM}(t)$ in \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eqn:beta-convolution-C} to retrieve the $\bar{C}^{LM}_{KQS}$ (the vector $\mathbf{C}^{lab}$), and construction of the matrix $\mathbf{{G}}^{LMP\Delta q }_{L'M'KS}$ which facilitates the extraction of the molecular frame coefficients $C^{LM}_{P\Delta q}$ (the vector $\mathbf{C}^{mol}$). The steps in the process are depicted in Fig.~\ref{731792}, which label's primary inputs as the `AF/LF measurements', referring to the $\bar{\beta}^u_{LM}(t)$, and the ADMs $A^K_{QS}(t)$ calculated for a grid of fluence and temperature values by solving the TDSE using the appropriate Hamiltonian for impulsive alignment~\cite{hasegawa2015NonadiabaticMolecularAlignment, koch2019QuantumControlMolecular}. 
The `Alignment Retrieval' process requires solving the linear equations \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eqn:beta-convolution-C} for the \DIFdelbegin \DIFdel{$C^{LM}_{P\Delta q}$ }\DIFdelend \DIFaddbegin \DIFadd{$\bar{C}^{LM}_{KQS}$ }\DIFaddend using these primary inputs over the entire gird of ADMs, and comparing to the measured data to find the bets fit solution. This provides the vector $\mathbf{C}^{lab}$ needed for the next step - solving the linear equations \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eq:basic}. This also requires that the matrix $\mathbf{{G}}^{LMP\Delta q }_{L'M'KS}$ be invertable. This matrix therefore encodes the uniquely accessible MF information in the experiment. Specifically, rows in the matrix link the LF parameter $\bar{\beta}^u_{LM}(t)$  to an MF beta parameter $\beta_{LM}(\theta,\chi)$ that can be used to construct the MFPADs, $\theta$ and $\chi$ being polar and azimuthal angles of the laser polarization in the MF. Specifically, a particular row, or set of rows, being entirely zero may indicate that certain MF $\beta_{LM}$ are inaccessible by the set of LF measurements. For instance, in~\cite{gregory2021MolecularFramePhotoelectron} the $\mathbf{{G}}^{LMP\Delta q }_{L'M'KS}$ matrix for the $N_2(X^{1}\Sigma^{+}_{g}) \rightarrow N^+_2(X^{2}\Sigma^{+}_{g})$ ionization of N$_2$ with a single photon, from a RWP excited by a linearly polarized pulse was computed. The results are reproduced herein for reference, see Fig. \ref{931809}, and this can be considered as an indicator of sensitivity in a somewhat analogous fashion to the channel functions shown in Figs. \ref{776753} - \ref{676540}. Rows with $M = 1$ were all determined to be identically zero, therefore only allowing the retrieval of MFPADs with the ionizing field parallel and perpendicular to the molecular axis. In this case, the partial wave analysis involved in the previously described method, along with the non-linear fitting \DIFdelbegin \DIFdel{necessarry to retireve }\DIFdelend \DIFaddbegin \DIFadd{necessary to retrieve }\DIFaddend the radial dipole matrix elements is avoided. However, only two of the MFPADs shown in Fig.~\ref{731792} extracted by bootstrapping are retrieved by this method.\\

The utility of this method is better demonstrated by application to a polyatomic molecule of $D_{nh}$ symmetry. Gregory et al.~\cite{gregory2021MolecularFramePhotoelectron} also compute the $\mathbf{{G}}^{LMP\Delta q }_{L'M'KS}$ matrix for $C_2H_4(^1A_g) \rightarrow C_2H_4^+(^2B_{3u})$ ionization of $C_2H_4$, with $D_{2h}$ symmetry, from a RWP excited by linearly polarized light. In contrast with $N_2$, all rows of the $\mathbf{{G}}^{LMP\Delta q }_{L'M'KS}$ are non-zero for $C_2H_4$, but the system of linear equations is inconsistent since there are more MF parameters (in the vector $\mathbf{C}^{mol}$) than LF measurements (in the vector $\mathbf{C}^{lab}$). Nonetheless, the solution selected by Gregory et al. minimizes the retrieved vector $\mathbf{C}^{mol}$ and correctly reproduce the MFPADs for any orientation. The basic $(x,y,z)$ cases are reproduced herein as Fig. \ref{584598}, indicating the high fidelity of the reconstructions (for arbitrary polarization geometries see Fig. 5 of Ref. \cite{gregory2021MolecularFramePhotoelectron}). This `extra' information available in the LF measurement for $C_2H_4$ compared to $N_2$ can be traced back to the fact that the RWP is 2D for an asymmetric top excited by linearly \DIFdelbegin \DIFdel{polaized }\DIFdelend \DIFaddbegin \DIFadd{polarized }\DIFaddend light(cf. \DIFdelbegin \DIFdel{Eq}\DIFdelend \DIFaddbegin \DIFadd{Eqn}\DIFaddend .~\ref{eq:mfrealsig}). While this method does not directly provide radial dipole matrix elements, the MFPADs produced can potentially be used as a constraint, along with additional experimental data, to determine these from a non-linear fit (see Sect. \ref{sec:recon-from-MFPADs}). 

\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/GFinalplot.png}
\caption{\(\) Values of \(\mathbf{G}^{LMP\Delta q }_{L'M'KS}\) for \(N_2(X^{1}\Sigma^{+}_{g}) \rightarrow N^+_2(X^{2}\Sigma^{+}_{g})\). Figure reproduced from Ref. \cite{gregory2021MolecularFramePhotoelectron}.\label{931809}}
\end{center}
\end{figure}


\begin{figure}[]
\begin{center}
\includegraphics[width=\textwidth,height=\dimexpr\textheight-4\baselineskip-\abovecaptionskip-\belowcaptionskip\relax,keepaspectratio]{figures/D2h1.png}
\caption{Calculated (a,b,c) and Retrieved (d,e,f) MFPADs for \(C_2 H_4(^1A_g) \rightarrow C_2H_4^+(^2B_{3u})\) for \((x,y,z)\) polarization geometries. Figure reproduced from Ref. \cite{gregory2021MolecularFramePhotoelectron}.\label{584598}}
\end{center}
\end{figure}

\subsection{Matrix element retrieval from MFPADs\label{sec:recon-from-MFPADs}}

To complete the circle, one can also consider whether MFPADs - either directly measured or reconstructed via matrix inversion - contain sufficient information to retrieve the underlying matrix elements.  The former case has already been the subject of several studies, for instance \DIFdelbegin \DIFdel{refs}\DIFdelend \DIFaddbegin \DIFadd{Refs}\DIFaddend . \cite{Gessner2002a,Lebech2003,Cherepkov2005, Yagishita2005}, and shown to work well for at least homo and hetero nuclear diatomics. In a sense the latter case can be considered as (yet another) bootstrapping-type scheme - MFPADs are obtained via a minimum effort/information route, then leveraged to obtain underlying properties. 

Fitting for MFPADs is currently implemented in the PEMtk suite in a similar manner to the AF fitting detailed in Sect. \ref{sec:bootstrapping}, based on the tensor formalism detailed in Sect. \ref{sec:tensor-formulation}. An extensive numerical example is not presented herein, but in testing for the $N_{2}$ example case, e.g. using MFPADs as shown in Fig. \ref{454268}, matrix element retrieval was found to be possible in general. However, in line with previous observations for other methods (and the underlying physics), the fidelity and retrievable relations again depend on the exact nature and quality - generally the information content - of the MFPAD dataset (or, equivalently, the set of measured $\beta_{L,M}$). In testing, a number of different datasets were trialed, and some notes and observations are given below.

\begin{itemize}
\item MFPADs were tested at single $\epsilon$ only, as a function of polarization geometry, cf. the MFPADs as shown in Fig. \ref{454268}.
\item Data for fitting therefore consisted of parameters $\beta_{L,M}(\epsilon,R_{\hat{n}})$, with $L_{max}=6$.
\item For fitting intensity-normalised MFPADs (i.e. $\beta_{0,0}=1$), for single or multiple polarization geometries from the ($x,y,z$) set:
\begin{itemize}
\item This was found to be sufficient to determine the corresponding continuum matrix elements in this case, i.e. $z$ polarization corresponds to the $\sigma_u$ continuum, and $x,y$ to the $\pi_u$ continuum. (This separation may not be so clean in other cases, depending on the symmetry of the system.)
\item Matrix elements were constrained as \DIFdelbegin \DIFdel{expect}\DIFdelend \DIFaddbegin \DIFadd{expected}\DIFaddend , with only \textit{relative} magnitudes and phases obtained (per continuum) in this manner.
\item Similarly, due to a lack of cross-terms between continua in this case, the phase relations between the $\sigma_u$ and $\pi_u$ continua were also \DIFdelbegin \DIFdel{underfined }\DIFdelend \DIFaddbegin \DIFadd{undefined }\DIFaddend in this case.
\item In line with the AF reconstruction procedure, the sign of the phases was also undefined in this case.
\item Similarly, the fidelity on the retrieved matrix elements (for defined relations), was on the order of the uncertainties in the fitted dataset.
\end{itemize}
\item For determination of additional matrix element relations, additional data can be incorporated in the fitting.
\begin{itemize}
\item Incorporating absolute magnitudes ($\beta_{0,0}=\sigma$) allows for the relative magnitudes of the continua to be determined.
\item Incorporating additional suitable interferences, e.g. diagonal polarization (cf. Fig. \ref{454268}), in the dataset allows for additional relative phase relationships to be determined, e.g. between the $\sigma_u$ and $\pi_u$ continua.
% \item Use of circular polarization further provides information on the sign of the phases. [cf. Reid 1991? Discussed previously. HAVEN'T TESTED THIS]
\end{itemize}
\item Retrieval of matrix elements vs. $\epsilon$ is also possible; however, it is again constrained by the presence (or otherwise) of interferences. In the basic case, each energy is treated independently, and relative phases as a function of energy are undefined. However, these may be approximately defined by imposing an energy constraint, e.g. defining that the phases are smooth vs. energy or follow a certain functional form (see, for an example, Ref. \cite{Yagishita2005}). % DIDN'T TEST THIS AS YET, is discussed above somewhere.
\end{itemize}

In general, an MF fitting procedure, whether from directly measured MFPADs, or reconstructed MFPADs, may be expected to work generally in principle, with similar caveats to the full AF-bootstrapping methodology of Sect. \ref{sec:bootstrapping} (and the existing literature, see Sect. \ref{sec:CompleteLit}). Both methodologies are constrained by the symmetry of the system, and general information content. Notable differences are the implicit presence of cross-terms between continua in the AF case (Eqn. \ref{eq:BLM-tensor-AF}), which may be missing in the MF case (Eqn. \ref{eq:BLM-tensor-MF}), depending on the choice of polarization geometries.
Outstanding questions remain similar for both cases, namely the fidelity of reconstruction, and the ability to scale-up to more complex cases (larger molecules, dynamic systems) and concomitant information content requirements, and are a subject of ongoing research.


%UPDATE 18/08/22: basic numerical testing complete, added notes above. Still need to look at the stats, but basically works as expected.
% UPDATE: stats look good, basically similar to AF case for 10pc noise tests

% TODO - computational example from perfect \& reconstructed MFPADs, and compare fidelity.


% Literature review
% [May be integrated above?]
% Recent developments
% Outlook
% Resources

\section{Summary \& Outlook \label{sec:summary-outlook}}

From this topical review, it is hoped that the reader has gained a solid grounding in photoionization physics, and general reconstruction methods, for both MF observable reconstruction and full matrix element retrieval (``complete" photoionization or quantum tomography treatments), and that a suitable toolkit and platform for interested researchers has been developed. 

Over the last decade or two, such experiments, as well as theoretical treatments and unified data-analysis techniques have developed significantly, and become more accessible to non-specialists. It is our hope 
%that this trend continues, and 
that the new platform and tools discussed herein (Sect. \ref{sec:resources}) will prove useful, and help photoionization (and related) studies involving MF and full matrix element retrieval to (continue to) become more routine and successful. Whilst significant new work has been presented herein, development work is ongoing, with aims to make the code-base more robust and user-friendly, test new cases - particularly for more complex molecular systems, and dynamical cases - and implement new features, such as metrics for information content for a given basis set that will aid experimental planning, and further density-matrix based analysis methods. As well as publication in the literature, new developments and results will also be made available via the open-source platform, and it is hoped that other researchers will also contribute to grow these efforts over time.

Meanwhile, experimental methodologies continue to improve and grow in sophistication, allowing more routes, and often more direct routes, to high information-content observables, whether in the lab or molecular frame, in a range of interactions and scenarios, including for larger molecules and probing dynamical effects. 

% [Something on recent pubs/demonstrations here?]

Recent work in this vein from the current authors and coworkers includes (atomic) matrix element retrieval from photoelectron imaging measurements with polarization multiplexing (via shaped laser pulses) \cite{hockett2014CompletePhotoionizationExperiments, hockett2015MaximuminformationPhotoelectronMetrology,hockett2015CoherentControlPhotoelectron, hockett2015CompletePhotoionizationExperiments}, (hyperfine) quantum beat spectroscopy from time-resolved photoelectron imaging experiments \cite{forbes2018QuantumbeatPhotoelectronimagingSpectroscopy}, and quantum tomographic determination of (LF) density matrices including electronic dynamics - theory \cite{gregory2022LaboratoryFrameDensity} and application to $NH_3$ (manuscript in preparation). These types of investigations indicate the potential for further general developments, and the utility of the MF retrieval and reconstruction techniques discussed herein as a foundation for a broader range of problems in molecular photoionization and dynamics, ultimately building to a class of molecular quantum state retrieval methods from photoelectron measurements \cite{hockett2018QMP1, hockett2018QMP2}. 





\section{Acknowledgements}

The authors would like to thank the JPB editors - particularly A. Stolow - for inviting this submission, their encouragement, and their extreme patience during its (rather lengthy) preparation. Special thanks also to R. Boll, D. Rolles and A. Rudenko for comments \& discussion on an early version of the manuscript, and technical notes on the state-of-the-art in coincidence measurements\DIFaddbegin \DIFadd{; M. Schuurman for general discussion; the referees for close-reading of the manuscript, and helpful suggestions for improvements and additional references}\DIFaddend .
\section{Resources\label{sec:resources}}

The following online resources are available, and it is hoped that interested readers will find these useful, and contribute.

\begin{itemize}
\item \DIFdelbegin \DIFdel{Manuscipt }\DIFdelend \DIFaddbegin \DIFadd{Manuscript }\DIFaddend text, live \href{https://www.authorea.com/users/71114/articles/447808-extracting-molecular-frame-photoionization-dynamics-from-experimental-data}{on Authorea (includes interactive figures)} and \href{https://github.com/phockett/Extracting-Molecular-Frame-Photoionization-Dynamics-from-Experimental-Data}{Github}. Post-publication reader comments \& suggestions can be added directly via the web.
\item \href{https://www.zotero.org/groups/4733878/molecular_frame_pads_measurements_and_reconstruction}{Full bibliography, via a Zotero group \textit{``Molecular Frame PADs Measurements and Reconstruction"}} \cite{hockettZoteroGroupsMolecular}. Additional references and suggestions can be added to the group, and it is hoped that this will grow to provide a useful community resource.
\item Code for AF computation and matrix element retrieval, as illustrated in Sect. \ref{sec:Recon}. 
\begin{itemize}
\item Full Jupyter notebooks and source data are \href{http://dx.doi.org/10.6084/m9.figshare.20293782}{available on Figshare, DOI: 10.6084/m9.figshare.20293782}. This also includes a complete archive of the python software releases and environment used during this work \cite{hockett2022MFreconFigshare}.
\item The open-source python libraries \href{https://epsproc.readthedocs.io}{ePSproc} \cite{ePSprocAuthorea,ePSprocGithub,ePSprocDocs} and \href{https://pemtk.readthedocs.io}{PEMtk} \cite{hockett2021PEMtkDocs, hockett2021PEMtkGithub} developed for these problems. (See Sects. \ref{sec:numerics-intro}, \ref{sec:numerical-notes} for further discussion.)
\end{itemize}
\item Discussion forum at \href{https://amoopenscience.femtolab.ca/}{AMO Open Science}. We hope interested readers will use this forum for general discussion on the topic, if only to suggest other venues for discussion.
\item A Docker-based distribution of various codes for tackling photoionization problems is also available from the \href{https://github.com/phockett/open-photoionization-docker-stacks}{Open Photoionization Docker Stacks} project, which aims to make these tools more accessible to interested researchers \cite{hockettOpenPhotoionizationDocker}.
\end{itemize}



% TODO: add a plain-text landing page for all of the above (OSF/Figshare?) to ensure it's visible in PDF/print versions.
\section{Appendix A - Further reading\label{sec:Appendix-A}}

The following sections provide further reading on specific topics for interested readers. In line with the aims of this manuscript, these sections are (very) far from comprehensive, but aim to provide a jumping-off point for the topics; it is hoped that a more comprehensive, crowd-sourced and ongoing listing will be generated via the \href{https://www.zotero.org/groups/4733878/molecular_frame_pads_measurements_and_reconstruction}{\textit{``Molecular Frame PADs Measurements and Reconstruction"}} online bibliography on Zotero \cite{hockettZoteroGroupsMolecular}.

\subsection{MF experimental literature sample\label{appendix:MF-expt}}

Reviews covering this class of experiment can be found in  \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{Yagishita2005,Reid2012,dowek2012PhotoionizationDynamicsPhotoemission,Yagishita2015, jahnke2022PhotoelectronDiffraction}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{Yagishita2005,Reid2012,dowek2012PhotoionizationDynamicsPhotoemission,Yagishita2015, jahnke2022PhotoelectronDiffraction, dowek2022TrendsAngleresolvedMolecular}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend ; some (representative) examples from the literature include:

\begin{itemize}
\item MFPADs for N2 core ionization \cite{Shigemasa1995}
\item MFPADs from various diatomics with coincidence velocity-map imaging \cite{Eland2000} \cite{Hikosaka2000}
\item MFPADs from CO K-shell photoionization \cite{motoki2000KshellPhotoionizationCO} and matrix element retrieval \cite{Cherepkov2000}.
\item MFPADs and matrix element retrieval for N2 \cite{Gessner2002a}
\item MFPADs and matrix element retrieval for NO inner-valence ionization \cite{Lucchese2002,Lebech2003} (this makes use of a general $F_{LN}(\theta_e)$ \DIFdelbegin \DIFdel{parametrized }\DIFdelend \DIFaddbegin \DIFadd{parameterized }\DIFaddend treatment of the MFPADs (see also \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{Lafosse2002}), which provides a suitable reduction method for experimental data analysis for RF and MFPADs, and the potential for matrix element retrieval, in a somewhat similar manner to the tensor approach discussed herein). % TO consider futher - just a reparametrization of the usual stuff, plus some special cases.
% \item MFPADs review \cite{Yagishita2005} % \cite{Cherepkov2005, Yagishita2005}
\item NO2 RFPADs \cite{Toffoli2007}.
\item NO MFPADs (1s channels) \cite{Li2007}.
\item Interference and entanglement in H2 double ionization in the MF \cite{Akoury2007}.
\item General discussion of multi-particle imaging with COLTRIMS \cite{Trinter2012a}.
\item Imaging methane MFPADs with electron-ion-ion coincidences \cite{Williams2012, Williams2012a}.
\item MFPADs from naphthalene ($C_{10}H_{8}$) via alignment and tomographic imaging \cite{Maurer2012}.
\item MFPADs from H2 and D2 at ~30eV photon energies (HHG source) \cite{Billaud2012a}.
\item MFPADs via alignment for Auger-Meitner electrons \cite{Cryan2010,Cryan2012a}.
% \footnote{See ref. \cite{matsakis2019RenamingProposalAuger} } % Rendering issue again.
\item MFPADs from core ionization of carbon tetrafluoride ($CF_4$), ethane ($C_2H_6$) and 1,1-difluoroethylene ($C_2 H_2 F_2$)\cite{Menssen2016}.
\end{itemize}

% UPDATED 12/07/22, and Zotero folders updated.
% LIST IN PROGRESS 03/09/21 
% NOTE: doesn't currently include any dynamical cases.
% TO CONSIDER: move to end as supplementals, and link to Zotero library for "ongoing" version?
\subsection{Theory literature sample\label{sec:theory-lit}}

A number of authors have developed relevant theory for photoionization problems. Whilst the fundamentals are similar, different formalisms have been derived for various specific cases, or to emphasize particular aspects of the problem. A few notable examples are listed here.

\begin{itemize}
\item Early derivations for atomic PADs \cite{Cherepkov1979,Cooper1968,Cooper1969}
\item Early derivations for molecular (LF)PADs \cite{Tully1968}, rotationally-resolved cases \cite{Buckingham1970}, and optically-active cases \cite{Ritchie1976}
\item Angular momentum transfer in LF and MFPADs \cite{Fano1972} 
\item General MFPAD (``fixed-molecule") derivation \cite{Dill1976}
\item Atomic PADs and spin polarization \cite{Klar1982}
\item Resonant multiphoton PADs \cite{Dixit1983}
\item Molecular orbital continuum decomposition \cite{Park1996}
\item A simple-model description for MFPADs, including $F_{LN}$ function decomposition \cite{Lucchese2004}
\item Matrix element retrieval from time-resolved photoelectron imaging experiments \cite{Suzuki2007}.
\item Time-resolved PADs and dynamics (including molecular alignment) \cite{Underwood2000,Seideman2001,Stolow2008}
\item LF, RF and MFPADs theory and determination (review article) \cite{dowek2012PhotoionizationDynamicsPhotoemission}
\item Photoionization with a focus on alignment/RWP effects, including numerical studies \cite{Ramakrishna2012, Ramakrishna2013,hockett2015GeneralPhenomenologyIonization}, and MFPAD case-study \cite{reid2018AccessingMolecularFramea}.
\item LF and MFPADs theory review and tutorials (with numerical examples) \cite{hockett2018QMP1}
\end{itemize}
% 12/07/22 - started, but ran out of steam - might skip it?
\subsection{Complete experiments literature sample\label{sec:CompleteLit}}

% 12/07/22 - started, but ran out of steam - might skip it? (Mainly pulling from QMet Vol. 2 Chpt. 8)

The topic of complete photoionization experiments has been recently reviewed in \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{kleinpoppen2013perfect,hockett2018QMP2}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{kleinpoppen2013perfect, hockett2018QMP2}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , see also older review articles \cite{Becker1998,Reid2003,Kleinpoppen2005}. Some representative and noteworthy examples are also listed below (see also Sect. \ref{appendix:MF-expt} above for cases involving MF measurements).

\begin{itemize}
\item First experimental demonstration for photoionization of an atomic target by Berry and coworkers \cite{Duncanson1976}, who studied
$Na(^{2}P_{1/2},\,^{2}P_{3/2})$.
\item First molecular demonstration for $NO$, from the Zare group, with state-resolved LF measurements including linear and circularly polarized fields \cite{Reid1992} (see also prior work \cite{Allendorf1989,Leahy1991,Reid1991}).
\item General theoretical discussion on complete experiments in atoms and molecules \cite{Cherepkov2005}.
\item Time-resolved rotational-wavepacket methods applied to $NO$ (narrow wavepacket) \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{Tsubouchi2004,Tang2010}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{Tsubouchi2004, Tang2010}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , see also Refs. \cite{Suzuki2006} (review) and \cite{Suzuki2007} (theory \& analysis).
\item Non-linear polyatomic demonstration with state-resolved LF measurements ($NH_3$) \cite{hockett2009RotationallyResolvedPhotoelectron}.
\item Theoretical investigation of matrix element retrieval for photoelectron imaging experiments \cite{Ramakrishna2012} (see also \cite{Ramakrishna2013} for rotational wavepacket reconstruction from complementary methods including high-harmonic generation).  
\item Complete experiments with polarization shaping \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{hockett2014CompletePhotoionizationExperiments,hockett2015CompletePhotoionizationExperiments}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{hockett2014CompletePhotoionizationExperiments, hockett2015CompletePhotoionizationExperiments}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend .
\item Time-resolved rotational-wavepacket method applied to $N_2$ (broad wavepacket) and bootstrap technique development \cite{marceau2017MolecularFrameReconstruction} (as per Sect. \ref{sec:bootstrapping} herein.)
\end{itemize} 
\section{Appendix B - Further formalism\label{sec:Appendix-B}}

A complete accounting of the formalism used herein is given in the following sections, expanding on the brief introduction of Sect. \ref{sec:tensor-formulation}, along with some additional notes for interested readers.

\subsection{Full Photoionization Formalism \label{appendix:formalism}}

% [NOTE: text here \href{https://epsproc.readthedocs.io/en/dev/methods/ePSproc_geom_methods_summary_190821-v1-tidy.html}{from main ePSproc docs} via Pandoc, needs some editing.]

The equations for the \(\beta_{LM}\) parameters, in the molecular and
lab frames (MF \& AF respectively), written in terms of geometric
tensor parameters, are given in Sect. \ref{sec:full-tensor-expansion}. The necessary tensor components are further detailed below. For further discussion and derivations see Refs. \cite{Reid2000,Underwood2000,Stolow2008}, and Ref. \cite{hockett2018QMP1} for a summary including various different formalisms; further examples can also be found in the ePSproc documentation \cite{ePSprocDocs}. For general discussion on tensor methods in atomic and molecular spectroscopy and related problems, see Refs. \cite{BlumDensityMat,zareAngMom}. 

Note, also, that several equivalent formalisms have been presented in the literature (Sect. \ref{sec:theory-lit}), often specialised to a particular problem or choice of phase conventions. In the following the equations are general, although the phase conventions are chosen to match those used in ePolyScat (Sect. \ref{sec:mat-ele-conventions}), hence the numerics for the analysis presented herein. In practice the ePSproc codes allow the user to set these conventions as desired. %[More on phase conventions - choice of harmonics, symmetrization etc...? Refs?]

% For the MF, denoted \(\beta_{LM}\)
% (\href{https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_pt2_170320_v140420.html}{full
% development notes here}):

% \begin{eqnarray}
% \beta_{L,-M}^{\mu_{i},\mu_{f}}(E) & = & (-1)^{M}\sum_{P,R',R}(2P+1)^{\frac{1}{2}}{E_{P-R}(\hat{e};\mu_{0})}\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}{\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')B_{L,-M}(l,l',m,m')}I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(E)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(E)
% \end{eqnarray}

% For the AF, denoted \(\bar{\beta}_{LM}\)
% (\href{https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_pt3_AFBLM_090620_010920_dev_bk100920.html}{full
% development notes here}):

% \begin{eqnarray}
% \bar{\beta}_{L,-M}^{\mu_{i},\mu_{f}}(E,t) & =(-1)^{M} & \sum_{P,R',R}{[P]^{\frac{1}{2}}}{E_{P-R}(\hat{e};\mu_{0})}\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}{\Lambda_{R'}(\mu,P,R')B_{L,S-R'}(l,l',m,m')}I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(E)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(E)\sum_{K,Q,S}\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)\label{eq:BLM-tidy-prod-2}
% \end{eqnarray}

% Where \(I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(E)\) are the (radial)
% dipole ionization matrix elements, as a function of energy \(E\),
% obtained from an
% \href{https://epsproc.readthedocs.io/en/latest/ePS_ePSproc_tutorial/ePS_tutorial_080520.html\#Theoretical-background}{ePolyScat
% (or other) calculation}, defined by a set of partial-waves \(\{l,m\}\),
% for polarizations \(\mu\) and channels (symmetries) labelled by initial
% and final state indexes \({p_{i}\mu_{i},p_{f}\mu_{f}}\).

% In both cases a set of geometric tensor terms are required, defined
% below. Note that, in this case, time-dependence arises purely from the
% \(A_{Q,S}^{K}(t)\) terms in the AF case, and the electric field term
% currently describes only the photon angular momentum coupling,
% time-dependent/shaped fields are not yet supported (as of v1.3.0, but
% will be soon). Similarly, a time-dependent initial state
% (e.g.~vibrational wavepacket) could also describe a time-dependent MF
% case, but is currently not included here.

\subsubsection{Electric field term}\label{electric-field-term}

The
\href{https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_260220_090420_tidy.html\#E_\% 7BP,R\%7D-tensor}{coupling
of two 1-photon terms can be written as a tensor contraction} \cite{BlumDensityMat,zareAngMom}:

\begin{equation}
E_{P,R}(\hat{e})=[e\otimes e^{*}]_{R}^{P}=[P]^{\frac{1}{2}}\sum_{p}(-1)^{R}\left(\begin{array}{ccc}
1 & 1 & P\\
p & R-p & -R
\end{array}\right)e_{p}e_{R-p}^{*}
\label{eq:EPR-defn-1}
\end{equation}

Where \(e_{p}\) and \(e_{R-p}\) define the field strengths for the
polarizations \(p\) and \(R-p\), which are coupled into the spherical
tensor \(E_{PR}\). For the simplest case of a linearly-polarized field, $p=0$, and only terms $P=0,2$ with $R=0$ (i.e. $E_{0,0}$ and $E_{2,0}$) are non-zero.

Note this notation implicitly describes only the time-independent photon angular momentum coupling,
but time-dependent/shaped laser fields can be readily incorporated by allowing for time-dependent fields $e_{p}(t)$ (see, for instance, Ref. \cite{hockett2015CompletePhotoionizationExperiments}).
% are not yet supported (as of v1.3.0, but will be soon).

\subsubsection{\texorpdfstring{\(B_{L,M}\)
term}{B\_\{L,M\} term}}\label{b_lm-term}

The coupling of the partial wave pairs, \(|l,m\rangle\) and
\(|l',m'\rangle\), into the observable set of \(\{L,M\}\) is
\href{https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_260220_090420_tidy.html\#B_\% 7BL,M\%7D-term}{defined
by a tensor contraction with two 3j terms} \cite{zareAngMom}.

\begin{equation}
B_{L,M}=(-1)^{m}\left(\frac{(2l+1)(2l'+1)(2L+1)}{4\pi}\right)^{1/2}\left(\begin{array}{ccc}
l & l' & L\\
0 & 0 & 0
\end{array}\right)\left(\begin{array}{ccc}
l & l' & L\\
-m & m' & M
\end{array}\right)
\label{eq:BLM-func-defn}
\end{equation}

Note for the AF case the terms may be reindexed by $M=S-R'$ (see below). This allows for all MF projections to contribute, rather than a single specified polarization geometry.

\subsubsection{\texorpdfstring{\(\Lambda\)
Term}{\textbackslash{}Lambda term}}\label{lambda-term}

A general geometric projection term can be defined in the MF and AF.
For the \href{https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_260220_090420_tidy.html\#/Lambda-Term}{MF
projection term}, \(\Lambda_{R',R}(R_{\hat{n}})\):

\begin{equation}
\Lambda_{R',R}(R_{\hat{n}})=(-1)^{(R')}\left(\begin{array}{ccc}
1 & 1 & P\\
\mu & -\mu' & R'
\end{array}\right)D_{-R',-R}^{P}(R_{\hat{n}})
\label{eq:lambda-func-defn-MF}
\end{equation}

This is similar to the $E_{P,R}$ term, and essentially rotates the field defined in the LF into
the MF by a set of rotations (Euler angles) defined by $R_{\hat{n}}=\{\chi,\Theta,\Phi\}$.

For
\href{https://epsproc.readthedocs.io/en/latest/methods/geometric_method_dev_pt3_AFBLM_090620_010920_dev_bk100920.html\#/beta_\% 7BL,M\%7D\%5E\%7BAF\%7D-rewrite}{the
AF case}, a simplified form can be used, since there is no single
orientation/rotation defined in relation to the MF, and the relations are defined by the
molecular axis distribution (see below). 

\begin{equation}
\bar{\Lambda}_{R'}=(-1)^{(R')}\left(\begin{array}{ccc}
1 & 1 & P\\
\mu & -\mu' & R'
\end{array}\right)\equiv\Lambda_{R',R'}(R_{\hat{n}}=0)
\label{eq:lambda-func-defn-AF}
\end{equation}

The notation here implies that the electric field and axis distributions are expanded about the same axis ($R_{\hat{n}}=0$), which corresponds to the simplest parallel align-probe field geometry. Additional frame rotation(s) may be applied in some cases (e.g. for crossed-polarization of the alignment and probe fields).

\subsubsection{Alignment term\label{alignment-term}}

The axis distribution moments (ADMs) define the LF in this case, and are given above as a set of parameters $A_{Q,S}^{K}(t)$. These give rise to couplings which can be written as:

\begin{equation}
\Delta_{L,M}(K,Q,S)=(2K+1)^{1/2}(-1)^{K+Q}\left(\begin{array}{ccc}
P & K & L\\
R & -Q & -M
\end{array}\right)\left(\begin{array}{ccc}
P & K & L\\
R' & -S & S-R'
\end{array}\right)
\label{eq:delta-func-defn}
\end{equation}

Hence the coupling between the LF and MF is, effectively, defined by the final term in the AF observable (Eqn. \ref{eq:BLM-tensor-AF}):

\begin{equation}
\sum_{K,Q,S}\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)
\end{equation}

And the observable is restricted to $L_{max}=|P+K|$, and $M=0$ only if  $Q=S=R=0$ (the usual cylindrically symmetric case).
% [TODO: still need to test/verify this for some other cases in the current codes - only used for Q=S=0 cases so far]

\subsubsection{Dipole matrix elements and conventions\label{sec:mat-ele-conventions}}

% TODO - wavefunction conventions, symmetrized harmonics.

Herein the numerical form of the dipole matrix elements is chosen to match the definitions used by ePolyScat \cite{Gianturco1994,Natalense1999,Toffoli2007}. In the notation of Ref. \cite{Toffoli2007}:

\begin{equation}
I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)=\langle\Psi_{i}^{p_{i},\mu_{i}}|\hat{d_{\mu}}|\Psi_{f}^{p_{f},\mu_{f}}\varphi_{klm}^{(-)}\rangle\label{eq:eps-I}
\end{equation}

\begin{equation}
T_{\mu_{0}}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\theta_{\hat{k}},\phi_{\hat{k}},\theta_{\hat{n}},\phi_{\hat{n}})=\sum_{l,m,\mu}I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)Y_{lm}^{*}(\theta_{\hat{k}},\phi_{\hat{k}})D_{\mu,\mu_{0}}^{1}(R_{\hat{n}})\label{eq:eps-TMF}
\end{equation}

\begin{equation}
I_{\mu_{0}}(\theta_{\hat{k}},\phi_{\hat{k}},\theta_{\hat{n}},\phi_{\hat{n}})=\frac{4\pi^{2}\epsilon}{cg_{p_{i}}}\sum_{\mu_{i},\mu_{f}}|T_{\mu_{0}}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\theta_{\hat{k}},\phi_{\hat{k}},\theta_{\hat{n}},\phi_{\hat{n}})|^{2}\label{eq:eps-MFPAD}
\end{equation}

In this formalism:
\begin{itemize}
\item $I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)$ is the radial part of the dipole matrix element (as per Eqns. \ref{eq:r-kllam}, \ref{eqn:I-zeta} herein), determined from the initial and final state electronic wavefunctions $\Psi_{i}^{p_{i},\mu_{i}}$and $\Psi_{f}^{p_{f},\mu_{f}}$,
and the radial part of the photoelectron wavefunction $\varphi_{klm}^{(-)}$ (cf. $\phi_{lm}(k)$ in Eqn. \ref{eq:r-kllam}, and where $^{(-)}$ denotes outgoing wave normalisation) and dipole operator $\hat{d_{\mu}}$. Here the wavefunctions are indexed by irreducible representation (i.e. symmetry) by the labels $p_{i}$ and $p_{f}$, with components $\mu_{i}$ and $\mu_{f}$ respectively; $l,m$ are angular momentum components, $\mu$ is the projection of the polarization into the MF. Each energy and irreducible representation corresponds to a calculation in ePolyScat.
\item $T_{\mu_{0}}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\theta_{\hat{k}},\phi_{\hat{k}},\theta_{\hat{n}},\phi_{\hat{n}})$
is the full matrix element (expanded in polar coordinates) in the
MF, where $\hat{k}$ denotes the direction of the photoelectron $\mathbf{k}$-vector, and $\hat{n}$ the direction of the polarization vector $\mathbf{n}$ of the ionizing light. This is equivalent to the full photoelectron wavefunction denoted $\Psi_e(\mathbf{k})$ in Sect. \ref{sec:dynamics-intro}.
\item $Y_{lm}^{*}(\theta_{\hat{k}},\phi_{\hat{k}})$ is a spherical harmonic. Note the conjugate form here.
\item $D_{\mu,-\mu_{0}}^{1}(R_{\hat{n}})$ is a Wigner rotation matrix element, with a set of Euler angles $R_{\hat{n}}=(\phi_{\hat{n}},\theta_{\hat{n}},\chi_{\hat{n}})$, which rotates/projects the polarization into the MF .
\item $I_{\mu_{0}}(\theta_{\hat{k}},\phi_{\hat{k}},\theta_{\hat{n}},\phi_{\hat{n}})$ is the final (observable) MFPAD, for a polarization $\mu_{0}$ and summed over all symmetry components of the initial and final states, $\mu_{i}$ and $\mu_{f}$. Note that this sum can be expressed as an incoherent summation, since these components are (by definition) orthogonal.
\item $g_{p_{i}}$ is the degeneracy of the state $p_{i}$.
\end{itemize}

As noted previously, in general there are multiple equivalent definitions for these terms used by different authors; the ePolyScat definitions above apply to the test matrix elements used herein (e.g. Table \ref{tab:inputMatE}), which lists $I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(\epsilon)$ for continuum symmetry components $p_f=\sigma_u,\pi_u$. These matrix elements are normalised to the total cross-section (in Mb), and include symmetrization. 

% In the ePSproc codebase, various switches can also be set to define alternative choices, e.g. conjugate forms, use of real harmonics etc., for computation of observables and matrix element retrieval. By default the following conventions/libraries are used:

% \begin{itemize}
% \item Angular momentum functions (Wigner D and 3js) are currently implemented directly, or via the Spherical Functions library \cite{boyle2022SphericalFunctions}, and have been tested for consistency with the definitions in Zare (for details see \href{https://epsproc.readthedocs.io/en/latest/tests/Spherical_function_testing_Aug_2019.html}{the ePSproc docs} \cite{hockett2020EPSprocPostprocessingEPolyScat}).
% \item Spherical harmonics are defined with the usual physics conventions: orthonormalised, and including the Condon-Shortley phase. Numerically they are implemented directly or via SciPy's \verb+sph_harm+ function (see \href{https://docs.scipy.org/doc/scipy/reference/generated/scipy.special.sph_harm.html}{the SciPy docs for details} \cite{SciPyDocumentation}. Further manipulation and conversion between different normalisations can be readily implemented with the SHtools library \cite{wieczorek2018SHToolsToolsWorking,SHtoolsGithub}.
% \item General tensor 
% \end{itemize}

For cases where symmetrization is not included in the matrix elements directly, it can be addressed via the use of symmetrized (or generalised) harmonics, which essentially provide correctly symmetrized expansions of spherical harmonics for a given irreducible representation, $\Gamma$. These can be defined by linear combinations of spherical harmonics (see Refs.\cite{Altmann1963a,Altmann1965,Chandra1987} for more):

\begin{equation}
X_{hl}^{\Gamma\mu*}(\theta,\phi)=\sum_{\lambda}b_{hl\lambda}^{\Gamma\mu}Y_{l,\lambda}(\theta,\phi)\label{eq:symm-harmonics}
\end{equation}


where: 

\begin{itemize}
\item $\Gamma$ is an irreducible representation, 
\item ($l$, $\lambda$) define the usual spherical harmonic indicies (rank, order)
\item $b_{hl\lambda}^{\Gamma\mu}$ are symmetrization coefficients, 
\item index $\mu$ allows for indexing of degenerate components,
\item $h$ \DIFdelbegin \DIFdel{indexs }\DIFdelend \DIFaddbegin \DIFadd{indexes }\DIFaddend cases where multiple components are required with all other quantum numbers identical. 
\end{itemize}

The exact form of these coefficients will depend on the point-group of the system, see, e.g. Refs. \cite{Chandra1987,Reid1994}; for numerical implementation notes in PEMtk see Sect. \ref{sec:numerical-notes}.
% Computation of $X_{hl}^{\Gamma\mu*}(\theta,\phi)$ is currently implemented in the PEMtk codebase, making use of libmsym \cite{johansson2017AutomaticProcedureGeneratinga,johansson2022LibmsymGithub} (symmetry coefficients) and SHtools \cite{wieczorek2018SHToolsToolsWorking,SHtoolsGithub} (general spherical harmonic handling and conversion). For worked examples, see \href{https://pemtk.readthedocs.io/en/latest/sym/pemtk_symHarm_demo_160322_tidy.html}{the PEMtk docs} \cite{hockett2021PEMtkDocs}.

% \textbf{Refs for the full AF-PAD formalism above:}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% % \tightlist
% \item
%   Reid, Katharine L., and Jonathan G. Underwood. ``Extracting Molecular
%   Axis Alignment from Photoelectron Angular Distributions.'' The Journal
%   of Chemical Physics 112, no. 8 (2000): 3643.
%   https://doi.org/10.1063/1.480517.
% \item
%   Underwood, Jonathan G., and Katharine L. Reid. ``Time-Resolved
%   Photoelectron Angular Distributions as a Probe of Intramolecular
%   Dynamics: Connecting the Molecular Frame and the Laboratory Frame.''
%   The Journal of Chemical Physics 113, no. 3 (2000): 1067.
%   https://doi.org/10.1063/1.481918.
% \item
%   Stolow, Albert, and Jonathan G. Underwood. ``Time-Resolved
%   Photoelectron Spectroscopy of Non-Adiabatic Dynamics in Polyatomic
%   Molecules.'' In Advances in Chemical Physics, edited by Stuart A.
%   Rice, 139:497--584. Advances in Chemical Physics. Hoboken, NJ, USA:
%   John Wiley \& Sons, Inc., 2008.
%   https://doi.org/10.1002/9780470259498.ch6.
% \end{enumerate}

% Where {[}3{]} has the version as per the full form above (full
% asymmetric top alignment distribution expansion).
% 02/08/22 - tidied up, most now in main text

% 14/09/21 - some additional formalism dev in progress (from local Lyx doc notes).

% See \href{https://epsproc.readthedocs.io/en/dev/methods/ePSproc_geom_methods_summary_190821-v1-tidy.html}{https://epsproc.readthedocs.io/en/dev/methods/ePSproc\_geom\_methods\_summary\_190821-v1-tidy.html} 

% \section{Matrix elements}

% Matrix element square (ePS notation):

% \begin{equation}
% I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(E)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(E)
% \end{equation}

% Rewrite as single (tensor) term:

% \begin{equation}
% \mathbb{I}_{lm\mu,l'm'\mu'}^{\Gamma,\Gamma'}=I_{l,m,\mu}^{\Gamma}(E)I_{l',m',\mu'}^{\Gamma'*}(E)
% \end{equation}

% And the symmetry/channel indices are denoted by $\Gamma,\Gamma'$
% for brevity (in general, $\Gamma=\Gamma'$ since the continua are
% orthogonal).

% (TODO: decide on notation here - $I$ following ePS notation, $D$
% following old notation (+ Jon), or $R$ for radial...?)

% This is effectively a density matrix (?) (see \href{https://epsproc.readthedocs.io/en/dev/methods/ePSproc_geom_methods_summary_190821-v1-tidy.html}{density mat dev notes}).

% \begin{equation}
% \mathbb{I}_{lm\mu,l'm'\mu'}^{\Gamma,\Gamma'}\equiv\mathbf{\rho}_{lm\mu,l'm'\mu'}^{\Gamma,\Gamma'}
% \end{equation}

% Where the matrix elements are:

% \begin{equation}
% \mathbf{\rho}_{lm\mu,l'm'\mu'}^{\Gamma,\Gamma'}=I_{l,m,\mu}^{p_{i}\mu_{i},p_{f}\mu_{f}}(E)I_{l',m',\mu'}^{p_{i}\mu_{i},p_{f}\mu_{f}*}(E)
% \end{equation}

% Rewrite MF eqn with new term:

% \begin{equation}
% \beta_{L,-M}^{\Gamma,\Gamma'}(E)=(-1)^{M}\sum_{P,R',R}(2P+1)^{\frac{1}{2}}E_{P-R}(\hat{e};\mu_{0})\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')B_{L,-M}(l,l',m,m')\mathbb{I}_{lm\mu,l'm'\mu'}^{\Gamma,\Gamma'}(E)
% \end{equation}

% And AF:

% \begin{equation}
% \bar{\beta}_{L,-M}^{\Gamma,\Gamma'}(E,t)=(-1)^{M}\sum_{P,R',R}[P]^{\frac{1}{2}}E_{P-R}(\hat{e};\mu_{0})\sum_{l,m,\mu}\sum_{l',m',\mu'}(-1)^{(\mu'-\mu_{0})}\bar{\Lambda}_{R'}(\mu,P,R')B_{L,S-R'}(l,l',m,m')\mathbb{I}_{lm\mu,l'm'\mu'}^{\Gamma,\Gamma'}(E)\sum_{K,Q,S}\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)
% \end{equation}

% In this case, $F_{LS}(q,q')\approx\sum_{\Gamma,\Gamma'}\sum_{l,m,\mu}\sum_{l',m',\mu'}B_{L,S-R'}(l,l',m,m')\mathbb{I}_{lm\mu,l'm'\mu'}^{\Gamma,\Gamma'}(E)$,
% where $F_{LS}(q,q')$ is from Jon's derivation (eqn. 46), except his
% also includes $\varepsilon(\epsilon)$ field term (this is the field
% averaged FT/envelope). Note also that the $A_{Q,S}^{K}$ (ADMs) are
% generally defined by rotational state populations as per eqn. 47.

\subsection{Channel functions expansion\label{sec:channel-funs-full}}

Following the tensor components detailed above, the full form of the channel functions can be written as:

% \begin{equation}
% \beta_{L,M}^{u}=\sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\Lambda^{\zeta\zeta'}
% \end{equation}

% and 

% \begin{equation}
% \Lambda^{\zeta\zeta'}=\sum_{\Gamma,\Gamma'}\sum_{\mu,\mu'}\sum_{h,h'}b_{hl\lambda}^{\Gamma\mu*}b_{h'l'\lambda'}^{\Gamma'\mu'}\boldsymbol{D}_{hl}^{\Gamma\mu*}(q,\,k)\boldsymbol{D}_{h'l'}^{\Gamma'\mu'}(q',\,k)
% \end{equation}

% In the current notation, this can be written as:

% \begin{equation}
% \beta_{L,M}^{u}=\sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbb{I}_{\zeta\zeta'}^{\Gamma,\Gamma'}=\sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbb{I}^{\zeta\zeta'}\equiv\sum_{\zeta,\zeta'}\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbf{\rho}^{\zeta\zeta'}
% \end{equation}

% This is basically the convolution form with channel functions, for
% a given ``experiment'' $u$, summed over all terms $\zeta,\zeta'$
% (the 2nd form assumes that the symmetries are lost in here too, the
% 3rd just rewrites as a density matrix).

% The full forms are, therefore:

\begin{equation}
\varUpsilon_{L,M}^{u,\zeta\zeta'}=(-1)^{M}(2P+1)^{\frac{1}{2}}E_{P-R}(\hat{e};\mu_{0})(-1)^{(\mu'-\mu_{0})}\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')B_{L,-M}(l,l',m,m')
\label{eq:channel-func-defn-MF}
\end{equation}

\begin{equation}
\bar{\varUpsilon}_{L,M}^{u,\zeta\zeta'}=(-1)^{M}[P]^{\frac{1}{2}}E_{P-R}(\hat{e};\mu_{0})(-1)^{(\mu'-\mu_{0})}\bar{\Lambda}_{R'}(\mu,P,R')B_{L,S-R'}(l,l',m,m')\Delta_{L,M}(K,Q,S)A_{Q,S}^{K}(t)
\label{eq:channel-func-defn-AF}
\end{equation}




\subsection{Final state density matrix\label{sec:density-mat-full}}

% Write the full final state as a density matrix:

% \begin{equation}
% \mathbf{\bar{\rho}}_{L,M}^{\zeta\zeta'}=\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbf{\rho}^{\zeta\zeta'}
% \end{equation}

% Here the density matrix can be interpreted as the final, LF/AF or
% MF density matrix, incorporating both the intrinsic and extrinsic
% effects (i.e. all channel couplings and radial matrix elements for
% the given measurement). The $L,M$notation indicates here that these
% dimensions should not be summed over, hence we can still write the
% tensor coupling into the $\beta_{L,M}^{u}$ parameters:

% \begin{equation}
% \beta_{L,M}^{u}=\sum_{\zeta,\zeta'}\mathbf{\bar{\rho}}_{L,M}^{\zeta\zeta'}
% \end{equation}

% [02/08/22 - moved text from main section. Keep that simple, more details here]

% \textbf{I don't think I fully understand this section. In the partial wave basis, wouldn't the density operator be,}
% \begin{equation}
% \rho(t) =\sum_{LM}\sum_{KQS}A^{K}_{QS}(t)\sum_{\zeta\zeta^{\prime}}\Gamma^{\zeta\zeta^{\prime}LM}_{KQS}|\zeta,\Psi_+\rangle\langle\zeta,\Psi_+|\mu_q\rho_i\mu_{q\prime}^{*}|\zeta^{\prime},\Psi_+\rangle\langle\zeta^{\prime},\Psi_+|
% \end{equation}
% \textbf{with} $\rho_i = |\Psi_i\rangle\langle\Psi_i|$\textbf{ ? It's likely I'm not fully understanding the notation here, because I'm used the notation in MG 2021. Either way, maybe we don't need to include the density matrix version here? Eq.~\ref{eq:cstate} is intended to drive home the quantum tomography perspective.}\\

As introduced in Sect. \ref{sec:density-mat-basic}, the (radial) density matrix can be expressed as the outer-product of the (radial) matrix elements. Following the channel function notation, it is also trivial to write the radial matrix elements in density matrix form in the $\zeta\zeta'$ representation:

\begin{equation}
\mathbf{\rho}^{\zeta\zeta'} = |\zeta\rangle\langle\zeta'| \equiv \mathbb{I}^{\zeta,\zeta'}
\end{equation}

And the full final continuum state as a density matrix in the $\zeta\zeta'$ representation (with the observable dimensions $L,M$ explicitly included in the density matrix), which will also be dependent on the choice of channel functions ($u$):

\begin{equation}
\mathbf{\rho}_{L,M}^{u,\zeta\zeta'}=\varUpsilon_{L,M}^{u,\zeta\zeta'}\mathbb{I}^{\zeta,\zeta'}
\end{equation}

Here the density matrix can be interpreted as the final, LF/AF or
MF density matrix (depending on the channel functions used), incorporating both the intrinsic and extrinsic
effects (i.e. all channel couplings and radial matrix elements for
the given measurement), with dimensions dependent on the unique sets of quantum numbers required - in the simplest case, this will just be a set of partial waves $\zeta = (l,m)$. Note that this final state is distinct from the ``radial" density matrix (Eqn. \ref{eqn:radial-density-mat}), which encodes purely intrinsic (molecular scattering) photoionization dynamics (thus characterises the scattering event). The $L,M$ notation indicates here that these dimensions should not be summed over, hence the tensor coupling into the $\beta_{L,M}^{u}$ parameters can also be written in terms of the density matrix:

\begin{equation}
\beta_{L,M}^{u}=\sum_{\zeta,\zeta'}\mathbf{\rho}_{L,M}^{u,\zeta\zeta'}
\end{equation}

In fact, this form arises naturally since the $\beta_{L,M}^{u}$ terms are the state multipoles (geometric tensors) defining the system, which can be thought of as a coupled basis equivalent of the density matrix representations (see, e.g., \DIFdelbegin \DIFdel{ref}\DIFdelend \DIFaddbegin \DIFadd{Ref}\DIFaddend . \cite{BlumDensityMat}, Chpt. 4.).

In a more traditional notation (cf. Eqn. \ref{eq:cstate}, see also Refs. \cite{gregory2021MolecularFramePhotoelectron} 
%[plus VM electron coherences? And some older refs]
), the density operator can be expressed as:

% \begin{equation}
% \rho(t) =\sum_{LM}\sum_{KQS}A^{K}_{QS}(t)\sum_{\zeta\zeta^{\prime}}\Gamma^{\zeta\zeta^{\prime}LM}_{KQS}|\zeta,\Psi_+\rangle\langle\zeta,\Psi_+|\mu_q\rho_i\mu_{q\prime}^{*}|\zeta^{\prime},\Psi_+\rangle\langle\zeta^{\prime},\Psi_+|
% \end{equation}


\begin{equation}
\rho(t) =\sum_{LM}\sum_{KQS}A^{K}_{QS}(t)\sum_{\zeta\zeta^{\prime}}\varUpsilon_{L,M}^{u,\zeta\zeta'}|\zeta,\Psi_+\rangle\langle\zeta,\Psi_+|\mu_q\rho_i\mu_{q\prime}^{*}|\zeta^{\prime},\Psi_+\rangle\langle\zeta^{\prime},\Psi_+|
\end{equation}


with $\rho_i = |\Psi_i\rangle\langle\Psi_i|$. This is, effectively, equivalent to an expansion in the various tensor operators defined above, in a state-vector notation.


% TODO: confirm notation here, may want to include more discussion from Blum? (See Fig. \ref{998904} for results, should also confirm representation here from outer product case, maybe plot LM representation too - see \href{https://epsproc.readthedocs.io/en/dev/methods/density_mat_notes_demo_300821.html}{ePSproc density matrix notes} esp. \href{https://epsproc.readthedocs.io/en/dev/methods/density_mat_notes_demo_300821.html#Density-matrix-from-geometric-tensors}{Density matrix from geometric tensors section}.)


\subsection{Matrix inversion formalism\label{app:mat-inversion}}

% As discussed in Sect. \ref{sec:matrix-inv-intro}, following Gregory et. al. \cite{gregory2021MolecularFramePhotoelectron}, the formalism can also be rewritten with
% the ADMs separate (see also Reid \& Underwood convolution form, \cite{Reid2000}), and the LF/AF given as (cf. Eqn. \ref{eq:BLM-tensor-AF}):

% \begin{equation}
% \bar{\beta}_{L,M}(E,t)=\sum_{K,Q,S}C_{K,Q,S}^{L,M}(E)A_{Q,S}^{K}(t)
% \end{equation}

% % ($Q=0$ only in Gregory et. al., don't recall if this is general limitation however - may be symmetry and/or dimensionality related?)
% (Note that $Q=0$ only for the derivations in Gregory et. al. \cite{gregory2021MolecularFramePhotoelectron}, although the results should generalise - see discussion therein for details, particularly Sect. 3.2 and the appendices.)

% And the MF (cf. Eqn. \ref{eq:BLM-tensor-MF}):

% \begin{equation}
% \beta_{L,M}(E,\Omega)=\sum_{P,R,\Delta q}C_{P,R}^{L,M}(E,\Delta q)D_{R,\Delta q}^{P}(\Omega)
% \end{equation}

% In the original notation, the transformation can be written:

% \begin{equation}
% \mathbf{C}^{mol}=\mathbf{G}\mathbf{C}^{lab},
% \end{equation}

% \begin{equation}
% C_{P,0}^{L,M}(E,\Delta q)=\hat{G}_{L'0KS}^{LMP\Delta q}\bar{C}_{K,0,S}^{L',0}(E)
% \end{equation}

% % (Here $M'=Q=R=0$, again not sure if this is required.)

% And

% \begin{equation}
% \mathbf{G}_{L'M'KS}^{LMP\Delta q}=\mathbf{\Gamma}_{P0\Delta q}^{\zeta\zeta'LM}(\mathbf{\Gamma}_{K0S}^{\zeta\zeta'L^{\prime}M^{\prime}})^{+}
% \end{equation}

% Where $+$ denotes the Moore-Penrose inverse matrix.

% \begin{equation}
% \bar{C}_{KQS}^{LM}(\epsilon)=\sum_{\zeta\zeta'}d_{\zeta\zeta'}(\epsilon)\Gamma_{KQS}^{\zeta\zeta'LM}
% \end{equation}

% \begin{equation}
% C_{PR}^{LM}(\epsilon,\Delta q)=\sum_{\zeta\zeta'}d_{\zeta\zeta'}(\epsilon)\Gamma_{PR\Delta q}^{\zeta\zeta'LM}
% \end{equation}

% \begin{equation}
% D_{\zeta}(\epsilon)D_{\zeta'}^{*}(\epsilon)=d_{\zeta\zeta'}(\epsilon)
% \end{equation}

As discussed in Sect. \ref{sec:matrix-inv-intro}, and following Gregory et. al. \cite{gregory2021MolecularFramePhotoelectron}, the general formalism can also be rewritten with the ADMs separate (see also Reid \& Underwood convolution form, \cite{Reid2000}), and the LF/AF given as per Eqn. \ref{eqn:beta-convolution-C} (cf. Eqn. \ref{eq:BLM-tensor-AF}). Herein, the notation from Gregory et. al. \cite{gregory2021MolecularFramePhotoelectron} is rewritten slightly, as per Eqns. \ref{eq:basic} - \ref{eq:MPinversion}.

In the current notation, the full expressions are written as per Eqn. \ref{eqn:beta-convolution-C} for the LF/AF (cf. Eqn. \ref{eq:BLM-tensor-AF}):

\begin{equation}
\bar{\beta}_{L,M}(E,t)=\sum_{K,Q,S}C_{K,Q,S}^{L,M}(E)A_{Q,S}^{K}(t)
\end{equation}

% ($Q=0$ only in Gregory et. al., don't recall if this is general limitation however - may be symmetry and/or dimensionality related?)
% (Note that $Q=0$ only for the derivations in Gregory et. al. \cite{gregory2021MolecularFramePhotoelectron}, although the results should generalise - see discussion therein for details, particularly Sect. 3.2 and the appendices.)

And for the MF (cf. Eqn. \ref{eq:BLM-tensor-MF}):

\begin{equation}
\beta_{L,M}(E,\Omega)=\sum_{P,R,\Delta q}C_{P,R}^{L,M}(E,\Delta q)D_{R,\Delta q}^{P}(\Omega)
\end{equation}

And the required coefficients defined as:

\begin{equation}
\bar{C}_{KQS}^{LM}(\epsilon)=\sum_{\zeta\zeta'}\mathbb{I}_{\zeta\zeta'}^{\Gamma,\Gamma'}(\epsilon)\Gamma_{KQS}^{\zeta\zeta'LM}
\end{equation}

\begin{eqnarray}
\Gamma_{KQS}^{\zeta\zeta'LM} & = & (-1)^{M}[P]^{\frac{1}{2}}E_{P-R}(\hat{e};\mu_{0})(-1)^{(\mu'-\mu_{0})}\bar{\Lambda}_{R'}(\mu,P,R')B_{L,S-R'}(l,l',m,m')\Delta_{L,M}(K,Q,S)\\
 & = & \bar{\varUpsilon}_{L,M}^{u,\zeta\zeta'}/A_{Q,S}^{K}(t)
\end{eqnarray}

\begin{equation}
C_{PR}^{LM}(\epsilon,\Delta q)=\sum_{\zeta\zeta'}\mathbb{I}_{\zeta\zeta'}^{\Gamma,\Gamma'}(\epsilon)\Gamma_{PR\Delta q}^{\zeta\zeta'LM}
\end{equation}

\begin{equation}
\Gamma_{PR\Delta q}^{\zeta\zeta'LM}=(-1)^{M}(2P+1)^{\frac{1}{2}}E_{P-R}(\hat{e};\mu_{0})(-1)^{(\mu'-\mu_{0})}\bar{\Lambda}_{\Delta q}(\mu,P,\Delta q)B_{L,-M}(l,l',m,m')
\end{equation}

Where it is assumed that $R'=\Delta q$, and that the rotational matrix element $D_{R,\Delta q}^{P}(\Omega)$
is computed independently (note that the current numerical function $\Lambda_{R',R}(R_{\hat{n}};\mu,P,R,R')$
could possibly be used directly here, but this version keeps the angle-dependence
separate as per the matrix inversion formalism).
%; \textcolor{red}{alternatively a new function might be used here?}).

Note also that $Q=0$ only for the derivations in Gregory et. al. \cite{gregory2021MolecularFramePhotoelectron}, and the the inverse matrix as given in Eqn. \ref{eq:MPinversion}, although the results should generalise - see discussion in Ref. \cite{gregory2021MolecularFramePhotoelectron} for details, particularly Sect. 3.2 and the appendices.
\subsection{Numerical implementation in ePSproc and PEMtk\label{sec:numerical-notes}}

\subsubsection{\DIFdelbegin \DIFdel{Photoionizaion }\DIFdelend \DIFaddbegin \DIFadd{Photoionization }\DIFaddend calculations with ePSproc}

The ePSproc codebase \cite{ePSprocAuthorea, ePSprocGithub, ePSprocDocs} aims to provide methods for post-processing with ePolyScat matrix elements (or equivalent matrix elements from other sources), including computation of AF and MF observables. The numerical implementation thus follows the conventions of ePolyScat, as given in Sect. \ref{sec:mat-ele-conventions}. Additionally, various switches can also be set to define alternative choices, e.g. conjugate forms, use of real harmonics etc., for computation of observables. Since the code is open-source Python, users may also swap libraries/conventions to their preference. By default the following conventions/libraries are used:

\begin{itemize}
\item Angular momentum functions (Wigner D and 3js) are currently implemented directly, or via the Spherical Functions library \cite{boyle2022SphericalFunctions}, and have been tested for consistency with the definitions in Zare (for details see \href{https://epsproc.readthedocs.io/en/latest/tests/Spherical_function_testing_Aug_2019.html}{the ePSproc docs} \cite{ePSprocDocs}).\cite{ePSprocDocs}).\cite{ePSprocDocs}).
\item Spherical harmonics are defined with the usual physics conventions: orthonormalised, and including the Condon-Shortley phase. Numerically they are implemented directly or via SciPy's \verb+sph_harm+ function (see \href{https://docs.scipy.org/doc/scipy/reference/generated/scipy.special.sph_harm.html}{the SciPy docs for details} \cite{SciPyDocumentation}. Further manipulation and conversion between different normalisations can be readily implemented with the SHtools library \cite{wieczorek2018SHToolsToolsWorking,SHtoolsGithub}.
\item General tensor handling and manipulation makes use of the Xarray library \cite{hoyer2017XarrayNDLabeled,XarrayDocumentation}.
\end{itemize}


\subsubsection{Data handling and fitting with PEMtk}

The Photoelectron Metrology Toolkit (PEMtk) codebase \cite{hockett2021PEMtkDocs, hockett2021PEMtkGithub} aims to provide various general data handling routines for photoionization problems. At the time of writing, only fitting routines are implemented, along with some basic utility functions, and backend functionality from ePSproc. Further details can be found in the \href{https://pemtk.readthedocs.io/en/latest/about.html}{PEMtk documentation} \cite{hockett2021PEMtkDocs}.

The results presented in Sect. \ref{sec:bootstrapping} make use of PEMtk routines, including functions provided to wrap matrix elements and ePSproc observable calculations for fitting, and analysis routines for identifying candidate matrix elements. The full analysis notebooks are available in the \href{http://dx.doi.org/10.6084/m9.figshare.20293782}{Figshare repository for this article} \cite{hockett2022MFreconFigshare}.

Non-linear optimization (fitting) is handled via the \href{https://lmfit.github.io/lmfit-py/index.html}{lmfit library}, which implements and/or wraps a range of non-linear fitting routines in Python \cite{LMFITDocumentation, newville2014LMFITNonLinearLeastSquare}; for the Levenberg-Marquardt least-squares minimization method used herein this wraps 
% \href{https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.least_squares.html}{Scipy's \verb+least_squares+ functionality}
% Removed \verb - OK in Authorea, but breaks in other places.
\href{https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.least_squares.html}{Scipy's \texttt{least\_squares} functionality}, which therefore constituted the core minimization routine \cite{SciPyDocumentation} for the demonstration case.

Although not demonstrated herein, computation of $X_{hl}^{\Gamma\mu*}(\theta,\phi)$ (Eqn. \ref{eq:symm-harmonics}) is also currently implemented in the PEMtk codebase, making use of libmsym \cite{johansson2017AutomaticProcedureGeneratinga, johansson2022LibmsymGithub} (symmetry coefficients) and SHtools \cite{wieczorek2018SHToolsToolsWorking,SHtoolsGithub} (general spherical harmonic handling and conversion). For worked examples, see \href{https://pemtk.readthedocs.io/en/latest/sym/pemtk_symHarm_demo_160322_tidy.html}{the PEMtk docs} \cite{hockett2021PEMtkDocs}. It is hoped that this will be a useful tool for tackling photoionization problems more generally, without \textit{a priori} knowledge of the matrix elements for a given system.

% Use Bibtex or BibLaTex? (Set in preamble)
% \bibliography{bibliography/biblio}{}

\printbibliography[heading=bibintoc]

\end{document}

